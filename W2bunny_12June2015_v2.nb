(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
<<<<<<< HEAD
NotebookDataLength[    256415,       6045]
NotebookOptionsPosition[    247671,       5784]
NotebookOutlinePosition[    248064,       5801]
CellTagsIndexPosition[    248021,       5798]
=======
NotebookDataLength[    255863,       6003]
NotebookOptionsPosition[    247050,       5739]
NotebookOutlinePosition[    247439,       5756]
CellTagsIndexPosition[    247396,       5753]
>>>>>>> origin/master
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["W2_bunny_June12_v2.nb ", "Section",
 CellChangeTimes->{{3.5054085872672462`*^9, 3.505408612829509*^9}, {
   3.505410310351451*^9, 3.505410328379615*^9}, {3.505474075433158*^9, 
   3.505474085474203*^9}, {3.5062589046288433`*^9, 3.506258959361998*^9}, {
   3.506630653800515*^9, 3.50663069306489*^9}, {3.507315239073552*^9, 
   3.507315260275161*^9}, {3.5077150911524677`*^9, 3.507715119133374*^9}, {
   3.6401110266476107`*^9, 3.6401110436827593`*^9}, 3.640111076937566*^9, {
   3.641240967876574*^9, 3.64124097973888*^9}, 3.641293239892025*^9, 
   3.641472382517745*^9, 3.641577212061426*^9, 3.641644308317298*^9, {
   3.641833491075897*^9, 3.641833494674094*^9}, {3.64294103325708*^9, 
   3.6429410426549892`*^9}, 3.6430136128564167`*^9, {3.643132422075859*^9, 
   3.64313242862605*^9}, {3.643388155594236*^9, 3.643388158992393*^9}, {
   3.643388274409205*^9, 3.6433882748233643`*^9}, {3.6445751068288603`*^9, 
   3.644575107459482*^9}, {3.64587064983641*^9, 3.645870657919821*^9}, 
   3.64587075409555*^9, {3.645957534318388*^9, 3.645957534601274*^9}, 
   3.6459577377697487`*^9, {3.646048387144507*^9, 3.646048390126768*^9}, {
   3.646131810827278*^9, 3.646131812673398*^9}, {3.646662705899171*^9, 
   3.646662710945319*^9}, {3.647081518841339*^9, 3.647081524111508*^9}, {
   3.64746383009803*^9, 3.6474638375756693`*^9}, {3.647760479863155*^9, 
   3.6477604817318974`*^9}, {3.647858182542474*^9, 3.647858193676387*^9}, {
   3.64848696550525*^9, 3.6484869744820213`*^9}, {3.649442355945868*^9, 
   3.6494423562322197`*^9}, {3.650191102203347*^9, 3.6501911085450497`*^9}, {
   3.6502802512942343`*^9, 3.650280254364504*^9}, 3.651345164897313*^9, {
   3.6522044084402523`*^9, 3.6522044092522297`*^9}, {3.652204467300482*^9, 
   3.6522044728744707`*^9}, 3.652536223173424*^9, {3.6630915915042963`*^9, 
   3.663091653614847*^9}, {3.6714623909324703`*^9, 3.6714624114103003`*^9}, {
   3.6762911089974194`*^9, 3.676291109331431*^9}}],

Cell["\<\

see elog:  \[NonBreakingSpace]Wed Jul 22 07:26:21 2015  for details about the \
expt.  W2_bunny uses 0.50 micro steps.\
\>", "Text",
 CellChangeTimes->{{3.676291111451768*^9, 3.6762911410050287`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Step 1:  Define functions", "Section",
 CellChangeTimes->{{3.5033167061859503`*^9, 3.503316719635662*^9}, {
   3.50331674973533*^9, 3.503316754268928*^9}, {3.5033374747215557`*^9, 
   3.503337480080407*^9}, {3.503339142667317*^9, 3.5033391448651657`*^9}, {
   3.504730372452002*^9, 3.504730377984919*^9}, {3.507715381523715*^9, 
   3.507715399273287*^9}, {3.640111094694233*^9, 3.640111100667691*^9}, {
   3.640111518458076*^9, 3.640111535919319*^9}, 3.6402196556029873`*^9, {
   3.640219727445634*^9, 3.640219746025066*^9}, 3.6407127833693037`*^9, {
   3.640877835712092*^9, 3.640877845007203*^9}, 3.640941766414694*^9, 
   3.640956657458598*^9, {3.640964712550826*^9, 3.6409647211418133`*^9}, {
   3.640993195605362*^9, 3.6409932107178183`*^9}, {3.6410545089880657`*^9, 
   3.641054514538434*^9}, {3.641241003572548*^9, 3.641241014771098*^9}, {
   3.6429427969837027`*^9, 3.6429428069906273`*^9}, {3.642993682725779*^9, 
   3.642993698792001*^9}, {3.643013605244755*^9, 3.643013627605424*^9}}],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"pathRoot", " ", "=", " ", 
  "\"\</Volumes/Backup/BunnyData_MeleteMirror/feetdown_Hgrating/\>\""}]}], \
"Input",
 CellChangeTimes->{{3.670256628379346*^9, 3.6702566300885267`*^9}, 
   3.671464702777789*^9, {3.6714647587811403`*^9, 3.6714647614826517`*^9}, {
   3.671465127838586*^9, 3.671465134004086*^9}}],

Cell[CellGroupData[{

Cell["\<\
1-1. Functions for reading file, finding number of groups of reference files \
and sample files\
\>", "Subsection",
 CellChangeTimes->{{3.643014196850205*^9, 3.64301420693437*^9}, {
  3.643014258301813*^9, 3.643014298868284*^9}, {3.670256606541574*^9, 
  3.670256613428899*^9}}],

Cell[TextData[{
 "funcReadPilatusFile[filename_] This will read data from a Pilatus \
integer-32 TIFF file.  The standard ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 " Import[filename] cannot read integer-32 TIFF.\n\
funcFindReferenceTIFFfiles[pathTIFF_]  Finds files based on \
\[OpenCurlyDoubleQuote].white.\[CloseCurlyDoubleQuote] and orders the list \
based on the image sequence number.\nfuncFindSampleTIFFfiles[pathTIFF_]  \
Finds files based on \[OpenCurlyDoubleQuote].raw.\[CloseCurlyDoubleQuote] and \
orders the list based on the image sequence number.\n\
funcFindReferenceGroups[] Based on sequence number, finds the grouping of the \
reference files.\nfuncFindSampleGroups[] Based on sequence number, finds the \
grouping of the sample files."
}], "Text",
 CellChangeTimes->{{3.64301364727151*^9, 3.643013743277955*^9}, {
  3.6430144351983643`*^9, 3.6430145466799107`*^9}, {3.643014592023138*^9, 
  3.643014620931099*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcReadPilatusFile", "[", "filename_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"rows", ",", "columns", ",", "stream", ",", "data"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rows", ",", "columns"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{"195", ",", "487"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"stream", " ", "=", " ", 
       RowBox[{"OpenRead", "[", 
        RowBox[{"filename", ",", 
         RowBox[{"BinaryFormat", "\[Rule]", "True"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"SetStreamPosition", "[", 
       RowBox[{"stream", ",", "30"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"BinaryReadList", "[", 
        RowBox[{"stream", ",", "\"\<Character8\>\"", ",", "19", ",", 
         RowBox[{"ByteOrdering", "\[Rule]", 
          RowBox[{"-", "1"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"year", " ", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Take", "[", 
         RowBox[{"data", ",", 
          RowBox[{"1", ";;", "4"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"month", " ", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Take", "[", 
         RowBox[{"data", ",", 
          RowBox[{"6", ";;", "7"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"day", " ", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Take", "[", 
         RowBox[{"data", ",", 
          RowBox[{"9", ";;", "10"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"hour", " ", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Take", "[", 
         RowBox[{"data", ",", 
          RowBox[{"12", ";;", "13"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"minute", " ", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Take", "[", 
         RowBox[{"data", ",", 
          RowBox[{"15", ";;", "16"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"second", " ", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"Take", "[", 
         RowBox[{"data", ",", 
          RowBox[{"18", ";;", "19"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"timeImage", " ", "=", " ", 
       RowBox[{"ToExpression", "[", 
        RowBox[{"{", 
         RowBox[{
         "year", ",", "month", ",", "day", ",", "hour", ",", "minute", ",", 
          " ", "second"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"SetStreamPosition", "[", 
       RowBox[{"stream", ",", "4096"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"data", " ", "=", " ", 
       RowBox[{"BinaryReadList", "[", 
        RowBox[{"stream", ",", "\"\<Integer32\>\"", ",", 
         RowBox[{"(", 
          RowBox[{"rows", "*", "columns"}], ")"}], ",", 
         RowBox[{"ByteOrdering", "\[Rule]", 
          RowBox[{"-", "1"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "stream", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Partition", "[", 
       RowBox[{"data", ",", "columns"}], "]"}]}]}], " ", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{
  3.6473718311493597`*^9, {3.647420569780156*^9, 3.647420574827324*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcFindReferenceTIFFfiles", "[", "pathTIFF_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"filenamesReference", " ", "=", " ", 
       RowBox[{"FileNames", "[", 
        RowBox[{"\"\<*.white.*.tif*\>\"", ",", "pathTIFF"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"numberOfReferenceFiles", " ", "=", 
       RowBox[{"Length", "[", "filenamesReference", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"listReferenceSequenceNumbers", " ", "=", "  ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{
           RowBox[{"StringSplit", "[", 
            RowBox[{
             RowBox[{"Last", "[", 
              RowBox[{"FileNameSplit", "[", 
               RowBox[{"filenamesReference", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
             "\"\<.\>\""}], "]"}], "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberOfReferenceFiles"}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"listReferenceIndexSequenceGratingNumbers", " ", "=", "  ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"ToExpression", "[", 
            RowBox[{
             RowBox[{"StringSplit", "[", 
              RowBox[{
               RowBox[{"Last", "[", 
                RowBox[{"FileNameSplit", "[", 
                 RowBox[{"filenamesReference", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
               "\"\<.\>\""}], "]"}], "[", 
             RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ToExpression", "[", 
            RowBox[{
             RowBox[{"StringSplit", "[", 
              RowBox[{
               RowBox[{"Last", "[", 
                RowBox[{"FileNameSplit", "[", 
                 RowBox[{"filenamesReference", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
               "\"\<.\>\""}], "]"}], "[", 
             RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberOfReferenceFiles"}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"indexOrdering", " ", "=", " ", 
       RowBox[{"Ordering", "[", "listReferenceSequenceNumbers", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"filenamesReference", " ", "=", " ", 
       RowBox[{"filenamesReference", "[", 
        RowBox[{"[", "indexOrdering", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"listReferenceIndexSequenceGratingNumbers", " ", "=", "  ", 
       RowBox[{"listReferenceIndexSequenceGratingNumbers", "[", 
        RowBox[{"[", "indexOrdering", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"numberOfReferenceFiles", " ", "=", 
       RowBox[{"Length", "[", "filenamesReference", "]"}]}], ";"}]}], "  ", 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.643013846307295*^9, 3.643013905147277*^9}, {
  3.64302585127417*^9, 3.643025935401846*^9}, {3.643026009731629*^9, 
  3.643026032204685*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcFindSampleTIFFfiles", "[", "pathTIFF_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"filenamesSample", " ", "=", "  ", 
       RowBox[{"FileNames", "[", 
        RowBox[{"\"\<*.raw.*.tif*\>\"", ",", "pathTIFF"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"numberOfSampleFiles", " ", "=", 
       RowBox[{"Length", "[", "filenamesSample", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"listSampleSequenceNumbers", " ", "=", "  ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{
           RowBox[{"StringSplit", "[", 
            RowBox[{
             RowBox[{"Last", "[", 
              RowBox[{"FileNameSplit", "[", 
               RowBox[{"filenamesSample", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
             "\"\<.\>\""}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberOfSampleFiles"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"indexOrdering", " ", "=", " ", 
       RowBox[{"Ordering", "[", "listSampleSequenceNumbers", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"filenamesSample", " ", "=", " ", 
       RowBox[{"filenamesSample", "[", 
        RowBox[{"[", "indexOrdering", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"numberOfSampleFiles", " ", "=", 
       RowBox[{"Length", "[", "filenamesSample", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"rawNameStr", " ", "=", " ", 
       RowBox[{"Last", "[", 
        RowBox[{"FileNameSplit", "[", 
         RowBox[{"First", "[", "filenamesReference", "]"}], "]"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"rawNameStr", " ", "=", " ", 
       RowBox[{
        RowBox[{"StringSplit", "[", 
         RowBox[{"rawNameStr", ",", "\"\<.white.\>\""}], "]"}], "//", 
        "First"}]}], ";"}]}], "  ", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.643013911460308*^9, 3.6430139243100348`*^9}, {
  3.6717014746273727`*^9, 3.671701477725608*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcFindReferenceGroups", "[", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"listReferenceSequenceNumbers", " ", "=", "  ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{
           RowBox[{"StringSplit", "[", 
            RowBox[{
             RowBox[{"Last", "[", 
              RowBox[{"FileNameSplit", "[", 
               RowBox[{"filenamesReference", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
             "\"\<.\>\""}], "]"}], "[", 
           RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberOfReferenceFiles"}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"listReferenceSequenceNumbersGroups", "=", 
       RowBox[{"Split", "[", 
        RowBox[{"listReferenceSequenceNumbers", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#2", "-", "#1"}], "\[Equal]", "1"}], "&"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"numberOfReferenceGroups", " ", "=", " ", 
       RowBox[{
        RowBox[{
        "Dimensions", "[", "listReferenceSequenceNumbersGroups", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"listReferenceSequenceNumbersGroupsBounds", " ", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"listReferenceSequenceNumbersGroups", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
           RowBox[{"Last", "[", 
            RowBox[{"listReferenceSequenceNumbersGroups", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{
            RowBox[{
            "Dimensions", "[", "listReferenceSequenceNumbersGroups", "]"}], 
            "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}]}], "  ",
     "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.643013972381323*^9, 3.643014049655201*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcFindSampleGroups", "[", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"listSampleAnglesAll", " ", "=", "  ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"angleBeforeDecimalPoint", "=", 
           RowBox[{
            RowBox[{"StringSplit", "[", 
             RowBox[{
              RowBox[{"Last", "[", 
               RowBox[{"FileNameSplit", "[", 
                RowBox[{"filenamesSample", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
              "\"\<.\>\""}], "]"}], "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"angleAfterDecimalPoint", "=", 
           RowBox[{
            RowBox[{"StringSplit", "[", 
             RowBox[{
              RowBox[{"Last", "[", 
               RowBox[{"FileNameSplit", "[", 
                RowBox[{"filenamesSample", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
              "\"\<.\>\""}], "]"}], "[", 
            RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"angle", " ", "=", " ", 
           RowBox[{"ToExpression", "[", 
            RowBox[{
            "angleBeforeDecimalPoint", "<>", "\"\<.\>\"", "<>", 
             "angleAfterDecimalPoint"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberOfSampleFiles"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"listSampleAngles", " ", "=", "  ", 
       RowBox[{"Union", "[", "listSampleAnglesAll", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"listSampleSequenceNumbers", " ", "=", "  ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{
           RowBox[{"StringSplit", "[", 
            RowBox[{
             RowBox[{"Last", "[", 
              RowBox[{"FileNameSplit", "[", 
               RowBox[{"filenamesSample", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
             "\"\<.\>\""}], "]"}], "[", 
           RowBox[{"[", "5", "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberOfSampleFiles"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"listSampleIndexSequenceAngleGratingNumbers", " ", "=", "  ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"listSampleSequenceNumbers", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"listSampleAnglesAll", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ToExpression", "[", 
            RowBox[{
             RowBox[{"StringSplit", "[", 
              RowBox[{
               RowBox[{"Last", "[", 
                RowBox[{"FileNameSplit", "[", 
                 RowBox[{"filenamesSample", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
               "\"\<.\>\""}], "]"}], "[", 
             RowBox[{"[", "6", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberOfSampleFiles"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"listSampleSequenceNumbersGroups", "=", 
       RowBox[{"Split", "[", 
        RowBox[{"listSampleSequenceNumbers", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#2", "-", "#1"}], "\[Equal]", "1"}], "&"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"numberOfSampleGroups", " ", "=", " ", 
       RowBox[{
        RowBox[{"Dimensions", "[", "listSampleSequenceNumbersGroups", "]"}], 
        "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"listSampleSequenceNumbersGroupsBounds", " ", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"First", "[", 
            RowBox[{"listSampleSequenceNumbersGroups", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
           RowBox[{"Last", "[", 
            RowBox[{"listSampleSequenceNumbersGroups", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{
            RowBox[{
            "Dimensions", "[", "listSampleSequenceNumbersGroups", "]"}], "[", 
            
            RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}]}], "  ",
     "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.643014061690824*^9, 3.643014079903895*^9}, {
  3.643033013429309*^9, 3.643033069214209*^9}, {3.643033194749892*^9, 
  3.643033343655643*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["1-2. Functions for interferometry", "Subsection",
 CellChangeTimes->{{3.643014196850205*^9, 3.64301420693437*^9}, {
  3.643014258301813*^9, 3.643014298868284*^9}, {3.643024555909604*^9, 
  3.643024558764586*^9}, {3.6702566151489363`*^9, 3.670256623698016*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"funcPrepareBvectorEvenSteps", "=", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"numberGratingSteps", ",", "_Integer"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"pg", ",", "_Real"}], "}"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "b1", ",", "b2", ",", "b3"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"x", "=", 
          RowBox[{"Range", "[", "numberGratingSteps", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"b1", " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{"1", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "numberGratingSteps"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"b2", " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Sin", "[", 
              RowBox[{"2", " ", "\[Pi]", " ", 
               RowBox[{
                RowBox[{"x", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "/", "pg"}]}], "]"}], "//", 
             "N"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "x"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"b3", " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Cos", "[", 
              RowBox[{"2", " ", "\[Pi]", " ", 
               RowBox[{
                RowBox[{"x", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "/", "pg"}]}], "]"}], "//", 
             "N"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "x"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Chop", "[", " ", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"b1", ",", "b2", ",", "b3"}], "}"}], " ", "]"}], 
          "]"}]}]}], "]"}]}], "]"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.543494103512597*^9, 3.543494184526606*^9}, {
   3.543494720170412*^9, 3.543494720515257*^9}, {3.56671854718894*^9, 
   3.566718550250146*^9}, 3.5667189244799137`*^9, {3.586190404721512*^9, 
   3.5861904351146793`*^9}, {3.5861904701644983`*^9, 3.586190497357341*^9}, {
   3.586190623315487*^9, 3.586190659444502*^9}, 3.586190693845993*^9, {
   3.5861907772904577`*^9, 3.586190883163597*^9}, {3.586197565270492*^9, 
   3.5861976190000467`*^9}, {3.586199831185211*^9, 3.586199836480752*^9}, {
   3.586209670715122*^9, 3.586209671073443*^9}, 3.606817081318272*^9, {
   3.6068211211344423`*^9, 3.606821123309841*^9}, {3.615722999437482*^9, 
   3.615723006628598*^9}, 3.6429945348212957`*^9, {3.642994574952653*^9, 
   3.642994590917289*^9}, {3.643024594605772*^9, 3.6430245965496073`*^9}, {
   3.643025314218669*^9, 3.643025319570011*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcPrepareBvectorArbitrarySteps", "[", 
    RowBox[{"gratingPeriodMicrons_", ",", "listGratingStepsMicrons_"}], "]"}],
    ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"b1", ",", "b2", ",", "b3", ",", "numberGratingSteps"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"xExpt", " ", "=", "listGratingStepsMicrons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b1", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"xExpt", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "/", "gratingPeriod"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "xExpt", "]"}]}], "}"}]}], "]"}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"numberGratingSteps", "=", 
       RowBox[{"Length", "[", "listGratingStepsMicrons", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b1", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"1", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberGratingSteps"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b2", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"2", " ", "\[Pi]", " ", 
            RowBox[{
             RowBox[{"listGratingStepsMicrons", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "/", "gratingPeriodMicrons"}]}],
            "]"}], "//", "N"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberGratingSteps"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b3", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{"2", " ", "\[Pi]", " ", 
            RowBox[{
             RowBox[{"listGratingStepsMicrons", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "/", "gratingPeriodMicrons"}]}],
            "]"}], "//", "N"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "numberGratingSteps"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Chop", "[", " ", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"b1", ",", "b2", ",", "b3"}], "}"}], " ", "]"}], "]"}]}]}], 
    " ", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6430246960807343`*^9, 3.643024747141973*^9}, 
   3.643024803656888*^9, {3.643025099631792*^9, 3.643025136319763*^9}, {
   3.643025208155863*^9, 3.643025272555606*^9}, {3.6430253222591*^9, 
   3.6430253268977633`*^9}, {3.643481324492137*^9, 3.643481385498057*^9}, {
   3.643481488519561*^9, 3.643481492163871*^9}, {3.647464328924095*^9, 
   3.647464416160322*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"funcPrepareAllVectors", "[", 
   RowBox[{
   "gratingPeriodMicrons_", ",", "listGratingStepsMicrons_", ",", "rows_", 
    ",", "columns_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"bVector", " ", "=", 
      RowBox[{"funcPrepareBvectorArbitrarySteps", "[", 
       RowBox[{"gratingPeriodMicrons", ",", "listGratingStepsMicrons"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"aVector", " ", "=", " ", 
      RowBox[{"cVector", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", 
           RowBox[{"rows", "*", "columns"}]}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"aMatrix", " ", "=", "  ", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"rows", ",", "columns", ",", "3"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"visibility", " ", "=", " ", 
      RowBox[{"phi", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"rows", ",", "columns"}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"gMatrix", " ", "=", " ", 
      RowBox[{
       RowBox[{"Inverse", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", "bVector", "]"}], " ", ".", " ", 
         "bVector"}], "]"}], " ", ".", " ", 
       RowBox[{"Transpose", "[", "bVector", "]"}]}]}], ";"}]}], "  ", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.643014791052432*^9, 3.643014873344695*^9}, 
   3.643024600256572*^9, {3.6430253402883883`*^9, 3.643025395034272*^9}, {
   3.643048072768824*^9, 3.6430480754628353`*^9}, 3.6433564985810213`*^9, {
   3.647464296480287*^9, 3.647464344267518*^9}, {3.6474644297608852`*^9, 
   3.647464439431128*^9}, {3.6474653184317217`*^9, 3.647465318839211*^9}, 
   3.647465367811371*^9, {3.647465407624255*^9, 3.6474654095175133`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcReadOneInterferogram", "[", 
    RowBox[{
    "listFilenamesOneInterferogram_", ",", "rows_", ",", "columns_", ",", 
     "listGratingStepsMicrons_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"filename", ",", "intensity"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"numberGratingSteps", "=", 
       RowBox[{"Length", "[", "listGratingStepsMicrons", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"allData", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"{", 
          RowBox[{"rows", ",", "columns", ",", "numberGratingSteps"}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"index", "=", "1"}], ",", 
        RowBox[{"index", "<=", "numberGratingSteps"}], ",", 
        RowBox[{"index", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"filename", "=", 
          RowBox[{"listFilenamesOneInterferogram", "[", 
           RowBox[{"[", "index", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"intensity", " ", "=", " ", 
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"funcReadPilatusFile", "[", "filename", "]"}], ",", 
            "cropRows", ",", "cropColumns"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"allData", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "All", ",", "index"}], "]"}], "]"}], "=", 
          "intensity"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", "  ", 
      "\[IndentingNewLine]", "allData"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6430191931088953`*^9, 3.6430191939945602`*^9}, {
   3.6474644919733152`*^9, 3.647464497367736*^9}, 3.647465708601987*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcCalculateTransmissionVisibilityPhi", "[", "data_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"transmission", ",", "visibility", ",", "phi"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cVector", "=", 
       RowBox[{"Transpose", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"data", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"aVector", "=", 
       RowBox[{"gMatrix", ".", "cVector"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"aMatrix", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", "aVector", "]"}], ",", "columns"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"transmission", "=", 
       RowBox[{"aMatrix", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"visibility", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"aMatrix", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "^", "2"}], 
         "+", 
         RowBox[{
          RowBox[{"aMatrix", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "All", ",", "3"}], "]"}], "]"}], "^", "2"}]}],
         " ", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"phi", " ", "=", " ", 
       RowBox[{"ArcTan", "[", 
        RowBox[{
         RowBox[{"aMatrix", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], ",", " ", 
         RowBox[{"aMatrix", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "3"}], "]"}], "]"}]}], " ", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"transmission", ",", "visibility", ",", "phi"}], "}"}]}]}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6068271319639997`*^9, 3.606827171793481*^9}, {
   3.606827216682045*^9, 3.6068272222172728`*^9}, {3.606827279672332*^9, 
   3.6068272801549473`*^9}, {3.606827316319539*^9, 3.606827316769446*^9}, {
   3.606827714704852*^9, 3.606827776191091*^9}, 3.606827812861165*^9, {
   3.6070348647111797`*^9, 3.6070349347063932`*^9}, {3.6071002515947247`*^9, 
   3.607100278140011*^9}, {3.615673680645699*^9, 3.6156736972077723`*^9}, {
   3.615673828068041*^9, 3.615673874653026*^9}, 3.61567391324685*^9, {
   3.6157232874088707`*^9, 3.615723296947983*^9}, {3.643019614682379*^9, 
   3.643019753466815*^9}, {3.643019958988155*^9, 3.643019963856319*^9}, 
   3.643024067974895*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcCorrectForZeroValuePixels", "[", "dataOriginal_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "coordinatesZeroIntensityPixels", ",", "dataCorrected", ",", 
       "dataMedianFilter", ",", "r", ",", "c"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"coordinatesZeroIntensityPixels", " ", "=", " ", 
       RowBox[{"Position", "[", 
        RowBox[{"dataOriginal", ",", 
         RowBox[{"p_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "\[Equal]", "0"}], "&"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "coordinatesZeroIntensityPixels", "]"}], ">", 
         "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dataCorrected", " ", "=", " ", "dataOriginal"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"dataMedianFilter", "=", 
             RowBox[{"MedianFilter", "[", 
              RowBox[{"dataOriginal", ",", "1"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"index", "=", "1"}], ",", 
              RowBox[{"index", "\[LessEqual]", 
               RowBox[{
               "Length", "[", "coordinatesZeroIntensityPixels", "]"}]}], ",", 
              
              RowBox[{"index", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"r", ",", "c"}], "}"}], "=", 
                RowBox[{"coordinatesZeroIntensityPixels", "[", 
                 RowBox[{"[", "index", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"dataCorrected", "[", 
                 RowBox[{"[", 
                  RowBox[{"r", ",", "c"}], "]"}], "]"}], " ", "=", " ", 
                RowBox[{"dataMedianFilter", "[", 
                 RowBox[{"[", 
                  RowBox[{"r", ",", "c"}], "]"}], "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], " ", 
          "\[IndentingNewLine]", "]"}], ";"}]}], "  ", "\[IndentingNewLine]", 
       "]"}], ";", "  ", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "coordinatesZeroIntensityPixels", "]"}], ">", 
         "0"}], ",", " ", "dataCorrected", ",", " ", "dataOriginal"}], 
       "]"}]}]}], " ", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.643061154113339*^9, 3.6430611936298037`*^9}, {
  3.643374108904148*^9, 3.6433741588794327`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcCorrectLargeDPCvalue", "[", "data_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "coordinatesLargeDPC", ",", "dataCorrected", ",", "r", ",", "c"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dataCorrected", " ", "=", " ", "data"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"coordinatesLargeDPC", " ", "=", " ", 
       RowBox[{"Position", "[", 
        RowBox[{"data", ",", 
         RowBox[{"p_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", ">", "\[Pi]"}], "&"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "coordinatesLargeDPC", "]"}], ">", "0"}], ",",
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"index", "=", "1"}], ",", 
              RowBox[{"index", "\[LessEqual]", 
               RowBox[{"Length", "[", "coordinatesLargeDPC", "]"}]}], ",", 
              RowBox[{"index", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"r", ",", "c"}], "}"}], "=", 
                RowBox[{"coordinatesLargeDPC", "[", 
                 RowBox[{"[", "index", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"dataCorrected", "[", 
                 RowBox[{"[", 
                  RowBox[{"r", ",", "c"}], "]"}], "]"}], " ", "=", " ", 
                RowBox[{
                 RowBox[{"data", "[", 
                  RowBox[{"[", 
                   RowBox[{"r", ",", "c"}], "]"}], "]"}], "-", 
                 RowBox[{"2", "\[Pi]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], " ", "\[IndentingNewLine]", "]"}], ";"}]}], "  ",
        "\[IndentingNewLine]", "]"}], ";", "  ", "\[IndentingNewLine]", 
      RowBox[{"coordinatesLargeDPC", " ", "=", " ", 
       RowBox[{"Position", "[", 
        RowBox[{"data", ",", 
         RowBox[{"p_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "<", 
             RowBox[{"-", "\[Pi]"}]}], "&"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "coordinatesLargeDPC", "]"}], ">", "0"}], ",",
         "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"index", "=", "1"}], ",", 
              RowBox[{"index", "\[LessEqual]", 
               RowBox[{"Length", "[", "coordinatesLargeDPC", "]"}]}], ",", 
              RowBox[{"index", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"r", ",", "c"}], "}"}], "=", 
                RowBox[{"coordinatesLargeDPC", "[", 
                 RowBox[{"[", "index", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"dataCorrected", "[", 
                 RowBox[{"[", 
                  RowBox[{"r", ",", "c"}], "]"}], "]"}], " ", "=", " ", 
                RowBox[{
                 RowBox[{"data", "[", 
                  RowBox[{"[", 
                   RowBox[{"r", ",", "c"}], "]"}], "]"}], "+", 
                 RowBox[{"2", "\[Pi]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], " ", "\[IndentingNewLine]", "]"}], ";"}]}], "  ",
        "\[IndentingNewLine]", "]"}], ";", " ", "\[IndentingNewLine]", 
      "dataCorrected"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.643061466004243*^9, 3.643061569333609*^9}, {
  3.643061613237577*^9, 3.6430616459594793`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
1-3. Functions for finding correct files for a given rotation angle\
\>", "Subsection",
 CellChangeTimes->{{3.643014196850205*^9, 3.64301420693437*^9}, {
  3.643014258301813*^9, 3.643014298868284*^9}, {3.643024555909604*^9, 
  3.643024558764586*^9}, {3.643025613152287*^9, 3.643025626407337*^9}, {
  3.670256618300494*^9, 3.67025662458025*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"funcGetSampleFilenamesForSpecificAngle", "[", "angle_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"indexAngle", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"listSampleIndexSequenceAngleGratingNumbers", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", " ", 
           RowBox[{"p_", "?", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"#", "\[Equal]", "angle"}], " ", "&"}], ")"}]}]}], 
          "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"indexFilename", " ", "=", " ", 
        RowBox[{"listSampleIndexSequenceAngleGratingNumbers", "[", 
         RowBox[{"[", 
          RowBox[{"indexAngle", ",", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"listSampleFilenamesAtThatAngle", " ", "=", " ", 
        RowBox[{"filenamesSample", "[", 
         RowBox[{"[", "indexFilename", "]"}], "]"}]}]}]}], "  ", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
   "funcGetSampleMininumSeqenceNumberForSpecificAngle", "[", "angle_", "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"indexAngle", " ", "=", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"listSampleIndexSequenceAngleGratingNumbers", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", " ", 
          RowBox[{"p_", "?", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "\[Equal]", "angle"}], " ", "&"}], ")"}]}]}], "]"}],
         "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sequenceNumber", " ", "=", " ", 
       RowBox[{"listSampleIndexSequenceAngleGratingNumbers", "[", 
        RowBox[{"[", 
         RowBox[{"indexAngle", ",", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Min", "[", "sequenceNumber", "]"}]}]}], "  ", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.643025651050439*^9, 3.643025675848792*^9}, {
  3.643033395861149*^9, 3.6430335321888638`*^9}, {3.6430335853093033`*^9, 
  3.643033626476893*^9}, {3.643033922160017*^9, 3.643033954181999*^9}, {
  3.643033988810198*^9, 3.643034040766204*^9}, {3.643034185704152*^9, 
  3.643034252814745*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcGetReferenceFilenamesforSpecficAngle", "[", "angle_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sequenceNumberSampleMinimum", " ", "=", 
       RowBox[{
       "funcGetSampleMininumSeqenceNumberForSpecificAngle", "[", "angle", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"listFilenamesAtSpecificAngle", " ", "=", 
       RowBox[{
       "funcGetSampleFilenamesForSpecificAngle", "[", "angle", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"groupNumberReference", " ", "=", 
       RowBox[{
        RowBox[{"Last", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"listReferenceSequenceNumbersGroups", ",", " ", 
           RowBox[{"p_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"#", "\[LessEqual]", "sequenceNumberSampleMinimum"}], 
              " ", "&"}], ")"}]}]}], "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"indexReferenceSeqenceNumbers", " ", "=", 
       RowBox[{"listReferenceSequenceNumbersGroups", "[", 
        RowBox[{"[", 
         RowBox[{"groupNumberReference", ",", "All"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"indexReferenceFilenames", " ", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"listReferenceIndexSequenceGratingNumbers", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", " ", 
            RowBox[{"indexReferenceSeqenceNumbers", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "indexReferenceSeqenceNumbers", "]"}]}], 
           "}"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"filenamesReference", "[", 
       RowBox[{"[", "indexReferenceFilenames", "]"}], "]"}]}]}], "  ", 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.643034052258018*^9, 3.6430340899941874`*^9}, {
   3.643034261729363*^9, 3.643034267606612*^9}, {3.6430420086269407`*^9, 
   3.643042033116912*^9}, {3.643042065500942*^9, 3.643042140344061*^9}, {
   3.643042241702157*^9, 3.643042321683508*^9}, 3.643042645417329*^9, {
   3.64304267844982*^9, 3.643042716325856*^9}, 3.643042750743671*^9, {
   3.6430428160321407`*^9, 3.643042892302236*^9}, {3.643043109926733*^9, 
   3.6430431546321983`*^9}, {3.643043190618244*^9, 3.643043234458426*^9}, {
   3.643043706085314*^9, 3.643043794688031*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["1-4. Plot functions for interferometry results", "Subsection",
 CellChangeTimes->{{3.643014196850205*^9, 3.64301420693437*^9}, {
  3.643014258301813*^9, 3.643014298868284*^9}, {3.643024555909604*^9, 
  3.643024558764586*^9}, {3.643025613152287*^9, 3.643025626407337*^9}, {
  3.643051416636918*^9, 3.643051424716065*^9}, {3.670256621036878*^9, 
  3.67025662499656*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcPlotTransmissionVisbilityPhiFit", "[", 
    RowBox[{
    "testPoint_", ",", "plotLabel_", ",", "transmissionMatrix_", ",", 
     "visbilityMatrix_", ",", "phiMatrix_", ",", "interferogram_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"gReferenceTransmission", " ", "=", " ", 
       RowBox[{"ArrayPlot", "[", 
        RowBox[{"transmissionMatrix", ",", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"All", ",", "All", ",", "climTrans"}], "}"}]}], ",", 
         RowBox[{"ColorFunction", "\[Rule]", "\"\<GrayTones\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ClippingStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"Black", ",", "White"}], "}"}]}], ",", 
         RowBox[{"Frame", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"plotLabel", "<>", "\"\< transmission, \[Theta]=\>\"", "<>", 
           RowBox[{"ToString", "[", "angle", "]"}], "<>", 
           "\"\<, test point=\>\"", "<>", 
           RowBox[{"ToString", "[", "testPointOne", "]"}]}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", 
          RowBox[{"rows", "/", "columns"}]}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "300"}], ",", "\[IndentingNewLine]", 
         
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"Placed", "[", 
            RowBox[{
             RowBox[{"BarLegend", "[", 
              RowBox[{"{", 
               RowBox[{"\"\<GrayTones\>\"", ",", "climTrans"}], "}"}], "]"}], 
             ",", "Right"}], "]"}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Epilog", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"PointSize", "\[Rule]", "Large"}], ",", 
            RowBox[{"Point", "[", 
             RowBox[{"{", "testPoint", "}"}], "]"}]}], "}"}]}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"gReferenceVisibility", " ", "=", " ", 
       RowBox[{"ArrayPlot", "[", 
        RowBox[{"visbilityMatrix", ",", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"All", ",", "All", ",", "climVis"}], "}"}]}], ",", 
         RowBox[{"ColorFunction", "\[Rule]", "\"\<GrayTones\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ClippingStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"Black", ",", "White"}], "}"}]}], ",", 
         RowBox[{"Frame", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"plotLabel", "<>", "\"\< visibility\>\""}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", 
          RowBox[{"rows", "/", "columns"}]}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "300"}], ",", "\[IndentingNewLine]", 
         
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"Placed", "[", 
            RowBox[{
             RowBox[{"BarLegend", "[", 
              RowBox[{"{", 
               RowBox[{"\"\<GrayTones\>\"", ",", "climVis"}], "}"}], "]"}], 
             ",", "Right"}], "]"}], "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"gReferencePhi", " ", "=", " ", 
       RowBox[{"ArrayPlot", "[", 
        RowBox[{"phiMatrix", ",", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"All", ",", "All", ",", "climPhi"}], "}"}]}], ",", 
         RowBox[{"ColorFunction", "\[Rule]", "\"\<GrayTones\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ClippingStyle", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"Black", ",", "White"}], "}"}]}], ",", 
         RowBox[{"Frame", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
         RowBox[{"PlotLabel", "\[Rule]", 
          RowBox[{"plotLabel", "<>", "\"\< phi\>\""}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", 
          RowBox[{"rows", "/", "columns"}]}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "300"}], ",", "\[IndentingNewLine]", 
         
         RowBox[{"PlotLegends", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"Placed", "[", 
            RowBox[{
             RowBox[{"BarLegend", "[", 
              RowBox[{"{", 
               RowBox[{"\"\<GrayTones\>\"", ",", "climPhi"}], "}"}], "]"}], 
             ",", "Right"}], "]"}], "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"yExpt", " ", "=", " ", 
       RowBox[{"interferogram", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"testPointOne", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"testPointOne", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "All"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xExpt", " ", "=", "listGratingStepsMicrons"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"transmission", "=", 
       RowBox[{"transmissionMatrix", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"testPoint", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"testPoint", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"visibility", "=", 
       RowBox[{"visbilityMatrix", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"testPoint", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"testPoint", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"visibilityPercentTestPoint", " ", "=", "  ", 
       RowBox[{"Round", "[", 
        RowBox[{
         RowBox[{"100", "*", 
          RowBox[{"visibility", "/", "transmission"}]}], ",", "0.1"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"phi", "=", 
       RowBox[{"phiMatrix", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"testPoint", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", 
          RowBox[{"testPoint", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"yCalc", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"transmission", "+", 
          RowBox[{"visibility", " ", 
           RowBox[{"Sin", "[", 
            RowBox[{
             RowBox[{"2", " ", "\[Pi]", " ", 
              RowBox[{
               RowBox[{"xExpt", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "/", 
               "gratingPeriodMicrons"}]}], "+", "phi"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "[", "xExpt", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sigma", "=", 
       RowBox[{
        RowBox[{"Sqrt", "[", "yExpt", "]"}], "//", "N"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"chi", "=", 
       RowBox[{
        RowBox[{"(", 
         FractionBox["1", 
          RowBox[{"numberGratingSteps", "-", "1"}]], ")"}], 
        RowBox[{"Total", "[", 
         SuperscriptBox[
          RowBox[{"(", 
           FractionBox[
            RowBox[{"yExpt", "-", " ", "yCalc"}], "sigma"], ")"}], "2"], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"plotString", "=", 
       RowBox[{"\"\<transmission=\>\"", "<>", 
        RowBox[{"ToString", "[", "transmission", "]"}], "<>", "\"\<\\n\>\"", "<>",
         "\[IndentingNewLine]", "\"\<visibility=\>\"", "<>", 
        RowBox[{"ToString", "[", "visibilityPercentTestPoint", "]"}], "<>", 
        "\"\<% \\n\>\"", "<>", "\[IndentingNewLine]", "\"\<phi=\>\"", "<>", 
        RowBox[{"ToString", "[", "phi", "]"}], "<>", "\"\< rad;   \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{"Round", "[", 
          RowBox[{"phi", "*", 
           RowBox[{"180", "/", "Pi"}]}], "]"}], "]"}], "<>", 
        "\"\<\[Degree]\\n\>\"", "<>", "\[IndentingNewLine]", 
        "\"\< \!\(\*SuperscriptBox[SubscriptBox[\(\[Chi]\), \(v\)], \(2\)]\)=\
\>\"", "<>", " ", 
        RowBox[{"ToString", "[", "chi", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"g1", "=", 
       RowBox[{"ListPlot", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"xExpt", ",", "yExpt"}], "}"}], "]"}], ",", 
         RowBox[{"Joined", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Frame", "\[Rule]", "True"}], ",", 
         RowBox[{"FrameLabel", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<intensity\>\"", ",", "\"\<\>\""}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"\"\<grating position/\[Mu]m\>\"", ",", 
              RowBox[{"plotLabel", "<>", "\"\<, test point=\>\"", "<>", 
               RowBox[{"ToString", "[", "testPoint", "]"}]}]}], "}"}]}], 
           "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Epilog", "\[Rule]", 
          RowBox[{"Inset", "[", 
           RowBox[{
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{"Text", "[", "plotString", "]"}], ",", "12"}], "]"}], 
            ",", 
            RowBox[{"Scaled", "[", 
             RowBox[{"{", 
              RowBox[{"0.4", ",", "0.75"}], "}"}], "]"}]}], "]"}]}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"g2", "=", " ", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"transmission", " ", "+", " ", 
          RowBox[{"visibility", " ", 
           RowBox[{"Sin", "[", 
            RowBox[{
             RowBox[{"2", " ", "\[Pi]", " ", 
              RowBox[{"x", "/", "gratingPeriodMicrons"}]}], "+", " ", "phi"}],
             " ", "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", 
           RowBox[{"Min", "[", "listGratingStepsMicrons", "]"}], ",", 
           RowBox[{"Max", "[", "listGratingStepsMicrons", "]"}]}], "}"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gFitReference", " ", "=", 
       RowBox[{"Show", "[", 
        RowBox[{"{", 
         RowBox[{"g1", ",", "g2"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gAllReference", " ", "=", " ", 
       RowBox[{"Grid", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"gReferenceTransmission", ",", "gReferenceVisibility"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"gReferencePhi", ",", "gFitReference"}], "}"}]}], "}"}], 
        "]"}]}]}]}], " ", "]"}]}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.643048159537216*^9, 3.643048615210067*^9}, 
   3.643048701203915*^9, {3.643050046196045*^9, 3.643050058200883*^9}, {
   3.6430500939263897`*^9, 3.643050214421069*^9}, {3.643050296369854*^9, 
   3.643050369673362*^9}, {3.643050431633266*^9, 3.6430504737850523`*^9}, 
   3.643050632240827*^9, {3.643051060159045*^9, 3.6430512789172688`*^9}, {
   3.643051340959538*^9, 3.6430513806926947`*^9}, {3.643051603055573*^9, 
   3.643051672787051*^9}, {3.643147433005711*^9, 3.643147463988842*^9}, {
   3.643235720427829*^9, 3.6432357211713543`*^9}, 3.6432357530420523`*^9, {
   3.6432359281198883`*^9, 3.643235948661955*^9}, {3.647467123117434*^9, 
   3.64746712723796*^9}, {3.6762929497068253`*^9, 3.676292950057374*^9}, {
   3.676292981002962*^9, 3.676292981427388*^9}, 3.676293028881014*^9, {
   3.676293079376354*^9, 3.676293121396294*^9}, {3.676293166935812*^9, 
   3.6762931788765163`*^9}, {3.676293423730908*^9, 3.676293439123247*^9}, 
   3.676293530136982*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"funcPlotAbsorptionDPCDarkField", "[", 
   RowBox[{
   "plotLabel_", ",", "absorptionMatrix_", ",", "dpcMatrix_", ",", 
    "darkfieldMatrix_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"gAbsorption", " ", "=", " ", 
      RowBox[{"ArrayPlot", "[", 
       RowBox[{"absorptionMatrix", ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"All", ",", "All", ",", "climAbs"}], "}"}]}], ",", 
        RowBox[{"ColorFunction", "\[Rule]", "\"\<GrayTones\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"ClippingStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Black", ",", "White"}], "}"}]}], ",", 
        RowBox[{"Frame", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotLabel", "\[Rule]", 
         RowBox[{"\"\<absorption, \[Theta]=\>\"", "<>", 
          RowBox[{"ToString", "[", "angle", "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Axes", "\[Rule]", "True"}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", 
         RowBox[{"rows", "/", "columns"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "300"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotLegends", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"BarLegend", "[", 
             RowBox[{"{", 
              RowBox[{"\"\<GrayTones\>\"", ",", "climAbs"}], "}"}], "]"}], 
            ",", "Right"}], "]"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"gDPC", " ", "=", " ", 
      RowBox[{"ArrayPlot", "[", 
       RowBox[{"dpcMatrix", ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"All", ",", "All", ",", "climDPC"}], "}"}]}], ",", 
        RowBox[{"ColorFunction", "\[Rule]", "\"\<GrayTones\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"ClippingStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Black", ",", "White"}], "}"}]}], ",", 
        RowBox[{"Frame", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotLabel", "\[Rule]", 
         RowBox[{"\"\<DPC, \[Theta]=\>\"", "<>", 
          RowBox[{"ToString", "[", "angle", "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Axes", "\[Rule]", "True"}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", 
         RowBox[{"rows", "/", "columns"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "300"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotLegends", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"BarLegend", "[", 
             RowBox[{"{", 
              RowBox[{"\"\<GrayTones\>\"", ",", "climDPC"}], "}"}], "]"}], 
            ",", "Right"}], "]"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"gDarkField", "=", " ", 
      RowBox[{"ArrayPlot", "[", 
       RowBox[{"darkfieldMatrix", ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"All", ",", "All", ",", "climDarkField"}], "}"}]}], ",", 
        RowBox[{"ColorFunction", "\[Rule]", "\"\<GrayTones\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"ClippingStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Black", ",", "White"}], "}"}]}], ",", 
        RowBox[{"Frame", "\[Rule]", "False"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotLabel", "\[Rule]", 
         RowBox[{"\"\<dark-field, \[Theta]=\>\"", "<>", 
          RowBox[{"ToString", "[", "angle", "]"}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Axes", "\[Rule]", "True"}], ",", 
        RowBox[{"AspectRatio", "\[Rule]", 
         RowBox[{"rows", "/", "columns"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "300"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotLegends", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Placed", "[", 
           RowBox[{
            RowBox[{"BarLegend", "[", 
             RowBox[{"{", 
              RowBox[{"\"\<GrayTones\>\"", ",", "climDarkField"}], "}"}], 
             "]"}], ",", "Right"}], "]"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"x", "=", 
      RowBox[{"Range", "[", "rows", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"listColumns", " ", "=", " ", 
      RowBox[{"Range", "[", 
       RowBox[{"50", ",", 
        RowBox[{"columns", "-", "50"}], ",", "50"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"numberOfColumns", " ", "=", " ", 
      RowBox[{"Length", "[", "listColumns", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lineProbeVertical", " ", "=", " ", 
      RowBox[{"Take", "[", 
       RowBox[{"absorptionMatrix", ",", "All", ",", 
        RowBox[{"{", 
         RowBox[{"50", ",", 
          RowBox[{"columns", "-", "50"}], ",", "50"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"gAbsorptionLineProbe", "=", 
      RowBox[{"ListPlot", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"i", "-", "1"}], ")"}], "*", 
               RowBox[{"Max", "[", "climAbs", "]"}]}], "+", 
              RowBox[{"lineProbeVertical", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "i"}], "]"}], "]"}]}]}], "}"}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "numberOfColumns"}], "}"}]}], "]"}], ",", 
        RowBox[{"Joined", "\[Rule]", "True"}], ",", 
        RowBox[{"Frame", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
        RowBox[{"FrameLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\"\<absorption\>\"", ",", "\"\<\>\""}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<column\>\"", ",", "plotLabel"}], "}"}]}], "}"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Epilog", "\[Rule]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"listColumns", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"10", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], "*", 
                  RowBox[{"Max", "[", "climAbs", "]"}]}]}], "}"}]}], "]"}], 
             ",", "12", ",", 
             RowBox[{"Background", "\[Rule]", "White"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "numberOfColumns"}], "}"}]}], "]"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lineProbeVertical", " ", "=", " ", 
      RowBox[{"Take", "[", 
       RowBox[{"dpcMatrix", ",", "All", ",", 
        RowBox[{"{", 
         RowBox[{"50", ",", 
          RowBox[{"columns", "-", "50"}], ",", "50"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"gDPCLineProbe", "=", 
      RowBox[{"ListPlot", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"i", "-", "1"}], ")"}], "*", 
               RowBox[{"Max", "[", "climDPC", "]"}]}], "+", 
              RowBox[{"lineProbeVertical", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "i"}], "]"}], "]"}]}]}], "}"}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "numberOfColumns"}], "}"}]}], "]"}], ",", 
        RowBox[{"Joined", "\[Rule]", "True"}], ",", 
        RowBox[{"Frame", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
        RowBox[{"FrameLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\"\<DPC\>\"", ",", "\"\<\>\""}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<column\>\"", ",", "plotLabel"}], "}"}]}], "}"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Epilog", "\[Rule]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"listColumns", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"10", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], "*", 
                  RowBox[{"Max", "[", "climDPC", "]"}]}]}], "}"}]}], "]"}], 
             ",", "12", ",", 
             RowBox[{"Background", "\[Rule]", "White"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "numberOfColumns"}], "}"}]}], "]"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lineProbeVertical", " ", "=", " ", 
      RowBox[{"Take", "[", 
       RowBox[{"darkfieldMatrix", ",", "All", ",", 
        RowBox[{"{", 
         RowBox[{"50", ",", 
          RowBox[{"columns", "-", "50"}], ",", "50"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"gDarkFieldLineProbe", "=", 
      RowBox[{"ListPlot", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"i", "-", "1"}], ")"}], "*", 
               RowBox[{"Max", "[", "climDarkField", "]"}]}], "+", 
              RowBox[{"lineProbeVertical", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "i"}], "]"}], "]"}]}]}], "}"}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "numberOfColumns"}], "}"}]}], "]"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"All", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "+", "numberOfColumns"}], ")"}], "*", 
            RowBox[{"Max", "[", "climDarkField", "]"}]}]}], "}"}]}], ",", 
        RowBox[{"Joined", "\[Rule]", "True"}], ",", 
        RowBox[{"Frame", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
        RowBox[{"FrameLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\"\<dark-field\>\"", ",", "\"\<\>\""}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<column\>\"", ",", "plotLabel"}], "}"}]}], "}"}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Epilog", "\[Rule]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"listColumns", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"10", ",", 
                 RowBox[{
                  RowBox[{"(", "i", ")"}], "*", 
                  RowBox[{"Max", "[", "climDarkField", "]"}]}]}], "}"}]}], 
              "]"}], ",", "12", ",", 
             RowBox[{"Background", "\[Rule]", "White"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "numberOfColumns"}], "}"}]}], "]"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"gAllAbsDPCDarkField", " ", "=", " ", 
      RowBox[{"Grid", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"gAbsorption", ",", "gDPC", ",", "gDarkField"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
          "gAbsorptionLineProbe", ",", "gDPCLineProbe", ",", 
           "gDarkFieldLineProbe"}], "}"}]}], "}"}], "]"}]}]}]}], "   ", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.643099603920944*^9, 3.643099690232655*^9}, {
   3.643099721296193*^9, 3.643099731884212*^9}, 3.643150877432077*^9, {
   3.6513461544739103`*^9, 3.6513461657944717`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["1-5. Functions for tomography", "Subsection",
 CellChangeTimes->{{3.643014196850205*^9, 3.64301420693437*^9}, {
  3.643014258301813*^9, 3.643014298868284*^9}, {3.643024555909604*^9, 
  3.643024558764586*^9}, {3.643025613152287*^9, 3.643025626407337*^9}, {
  3.643051416636918*^9, 3.643051424716065*^9}, {3.670256621036878*^9, 
  3.67025662499656*^9}, {3.6714658936661882`*^9, 3.671465908826537*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcFilterRawImages", "[", "raw_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "anyZeros", ",", "filtered", ",", "r", ",", "c", ",", 
       "medianFiltered"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"filtered", "=", "raw"}], ";", "\[IndentingNewLine]", 
      RowBox[{"anyZeros", "=", " ", 
       RowBox[{"Position", "[", 
        RowBox[{"raw", ",", " ", 
         RowBox[{"p_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "\[LessEqual]", "0"}], " ", "&"}], ")"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"medianFiltered", " ", "=", " ", 
       RowBox[{"MedianFilter", "[", 
        RowBox[{"raw", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "anyZeros", "]"}], ">", "0"}], ",", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", " ", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "<=", 
             RowBox[{"Length", "[", "anyZeros", "]"}]}], ",", 
            RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"r", ",", "c"}], "}"}], "=", 
              RowBox[{"anyZeros", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"filtered", "[", 
               RowBox[{"[", 
                RowBox[{"r", ",", "c"}], "]"}], "]"}], " ", "=", " ", 
              RowBox[{"medianFiltered", "[", 
               RowBox[{"[", 
                RowBox[{"r", ",", "c"}], "]"}], "]"}]}], ";"}]}], "  ", 
           "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "filtered"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.671214051091303*^9, 3.671214129632346*^9}, {
  3.671214196843514*^9, 3.671214217699003*^9}, {3.671214297487451*^9, 
  3.6712143438694487`*^9}, {3.6712146397128773`*^9, 3.671214682262487*^9}, {
  3.67121488387843*^9, 3.671214889989427*^9}, {3.671215091375135*^9, 
  3.671215096407832*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcFilterAttenuation", "[", 
    RowBox[{"data_", ",", "upperLimit_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "anyZeros", ",", "anyZingers", ",", "filtered", ",", "r", ",", "c", ",",
        "medianFiltered"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"filtered", "=", "data"}], ";", "\[IndentingNewLine]", 
      RowBox[{"anyZeros", "=", " ", 
       RowBox[{"Position", "[", 
        RowBox[{"data", ",", " ", 
         RowBox[{"p_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "\[LessEqual]", "0"}], " ", "&"}], ")"}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"medianFiltered", " ", "=", " ", 
       RowBox[{"MedianFilter", "[", 
        RowBox[{"data", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "anyZeros", "]"}], ">", "0"}], ",", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", " ", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "<=", 
             RowBox[{"Length", "[", "anyZeros", "]"}]}], ",", 
            RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"r", ",", "c"}], "}"}], "=", 
              RowBox[{"anyZeros", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"filtered", "[", 
               RowBox[{"[", 
                RowBox[{"r", ",", "c"}], "]"}], "]"}], " ", "=", " ", 
              RowBox[{"medianFiltered", "[", 
               RowBox[{"[", 
                RowBox[{"r", ",", "c"}], "]"}], "]"}]}], ";"}]}], "  ", 
           "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"anyZingers", "=", " ", 
       RowBox[{"Position", "[", 
        RowBox[{"data", ",", " ", 
         RowBox[{"p_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", ">", "upperLimit"}], " ", "&"}], ")"}]}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "anyZingers", "]"}], ">", "0"}], ",", 
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", " ", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "<=", 
             RowBox[{"Length", "[", "anyZingers", "]"}]}], ",", 
            RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"r", ",", "c"}], "}"}], "=", 
              RowBox[{"anyZingers", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"filtered", "[", 
               RowBox[{"[", 
                RowBox[{"r", ",", "c"}], "]"}], "]"}], " ", "=", " ", 
              RowBox[{"medianFiltered", "[", 
               RowBox[{"[", 
                RowBox[{"r", ",", "c"}], "]"}], "]"}]}], ";"}]}], "  ", 
           "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "filtered"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6712880843542128`*^9, 3.671288213364456*^9}, {
  3.671290357437093*^9, 3.671290362678831*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcShiftSinogram", "[", 
    RowBox[{
    "sinogram_", ",", "shift_", ",", "numberColumns_", ",", 
     "numberOfAngles_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "rInitial", ",", "cInitial", ",", "rFinal", ",", "cFinal", ",", 
       "sinoShifted"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rInitial", ",", "cInitial"}], "}"}], "=", 
       RowBox[{"Dimensions", "[", "sinogram", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"shift", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"sinoShifted", " ", "=", " ", 
         RowBox[{"Transpose", "[", 
          RowBox[{"PadRight", "[", 
           RowBox[{
            RowBox[{"Take", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", "sinogram", "]"}], ",", "All", ",", 
              RowBox[{"{", 
               RowBox[{"shift", ",", "numberColumns"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"numberOfAngles", ",", "numberColumns"}], "}"}], ",", 
            "0"}], "]"}], " ", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"shift", "<", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"sinoShifted", " ", "=", " ", 
         RowBox[{"Transpose", "[", 
          RowBox[{"PadLeft", "[", 
           RowBox[{
            RowBox[{"Take", "[", 
             RowBox[{
              RowBox[{"Transpose", "[", "sinogram", "]"}], ",", "All", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", 
                RowBox[{"numberColumns", "+", "shift"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"numberOfAngles", ",", "numberColumns"}], "}"}], ",", 
            "0"}], "]"}], " ", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"shift", "==", "0"}], ",", 
        RowBox[{"sinoShifted", " ", "=", "sinogram"}]}], " ", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"rFinal", ",", "cFinal"}], "}"}], "=", 
       RowBox[{"Dimensions", "[", "sinoShifted", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"error", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"rInitial", ",", "cInitial"}], "}"}], "\[Equal]", 
          RowBox[{"{", 
           RowBox[{"rFinal", ",", "cFinal"}], "}"}]}], ",", "0", ",", "1"}], 
        "]"}]}], ";", "\[IndentingNewLine]", "sinoShifted"}]}], "  ", "]"}]}],
   ";"}]], "Input",
 CellChangeTimes->{
  3.671290364350119*^9, {3.67129064361721*^9, 3.671290645432549*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcStreakRemovalFFT", "[", 
    RowBox[{"sinogram_", ",", "bandWidth_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "numberRays", ",", "numberOfAngles", ",", "streaks", ",", 
       "streaksHighPassFilter"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"numberRays", ",", "numberOfAngles"}], "}"}], "=", 
       RowBox[{"Dimensions", "[", "sinogram", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"streaks", " ", "=", " ", 
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{"sinogram", ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], "/", "numberOfAngles"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"streaksHighPassFilter", " ", "=", " ", 
       RowBox[{"HighpassFilter", "[", 
        RowBox[{"streaks", ",", "bandWidth"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sinogram", "-", "streaksHighPassFilter"}]}]}], " ", "]"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"funcUseAirRegionForOffsetSinogram", "[", 
    RowBox[{"data_", ",", "airRegionWidth_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "numberRays", ",", "numberOfAngles", ",", "airTop", ",", "airBottom", 
       ",", "tempSinogram", ",", "indexAngle", ",", "sinogram"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinogram", " ", "=", " ", "data"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"numberRays", ",", "numberOfAngles"}], "}"}], "=", 
       RowBox[{"Dimensions", "[", "data", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"indexAngle", " ", "=", "1"}], ",", " ", 
        RowBox[{"indexAngle", "\[LessEqual]", "numberOfAngles"}], ",", 
        RowBox[{"indexAngle", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"airTop", " ", "=", " ", 
          RowBox[{"Median", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Take", "[", 
             RowBox[{"sinogram", ",", " ", 
              RowBox[{"{", 
               RowBox[{"1", ",", "airRegionWidth"}], "}"}], ",", 
              RowBox[{"{", "indexAngle", "}"}]}], "]"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"airBottom", " ", "=", "  ", 
          RowBox[{"Median", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Take", "[", 
             RowBox[{"sinogram", ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"numberRays", "-", "airRegionWidth", "+", "1"}], ",", 
                "numberRays"}], "}"}], ",", 
              RowBox[{"{", "indexAngle", "}"}]}], "]"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"sinogram", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "indexAngle"}], "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"sinogram", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "indexAngle"}], "]"}], "]"}], "-", 
           RowBox[{"Mean", "[", 
            RowBox[{"{", 
             RowBox[{"airTop", ",", "airBottom"}], "}"}], "]"}]}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "sinogram"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.671290867554008*^9, 3.6712909028839684`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["1-6 DumpSave", "Subsection",
 CellChangeTimes->{{3.671211179812208*^9, 3.671211200099522*^9}, {
   3.671211329699849*^9, 3.671211387716975*^9}, 3.6712140481610613`*^9, {
   3.6714648208218184`*^9, 3.671464821195808*^9}, 3.671465890939961*^9}],

Cell[BoxData[{
 RowBox[{"DumpSave", "[", 
  RowBox[{
   RowBox[{"pathRoot", "<>", "\"\<Step1.mx\>\""}], ",", 
   RowBox[{"{", 
    RowBox[{
    "funcReadPilatusFile", ",", "funcFindReferenceTIFFfiles", ",", 
     "funcFindSampleTIFFfiles", ",", "funcFindReferenceGroups", ",", 
     "funcFindSampleGroups", ",", "\[IndentingNewLine]", 
     "funcPrepareBvectorArbitrarySteps", ",", "funcPrepareAllVectors", ",", 
     "funcReadOneInterferogram", ",", 
     "funcCalculateTransmissionVisibilityPhi", ",", 
     "funcCorrectForZeroValuePixels", ",", "funcCorrectLargeDPCvalue", ",", 
     "\[IndentingNewLine]", "funcGetSampleFilenamesForSpecificAngle", ",", 
     "funcGetSampleMininumSeqenceNumberForSpecificAngle", ",", 
     "funcGetReferenceFilenamesforSpecficAngle", ",", 
     "funcPlotTransmissionVisbilityPhiFit", ",", "\[IndentingNewLine]", 
     "funcPlotAbsorptionDPCDarkField", ",", "\[IndentingNewLine]", 
     "funcFilterRawImages", ",", "funcFilterAttenuation", ",", 
     "funcShiftSinogram", ",", "funcStreakRemovalFFT", ",", 
     "funcUseAirRegionForOffsetSinogram"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}]}], "Input",
 CellChangeTimes->{{3.670170392983385*^9, 3.67017042465975*^9}, {
   3.671211431687812*^9, 3.671211434265087*^9}, {3.671212120717972*^9, 
   3.6712121815361853`*^9}, 3.6712127961361732`*^9, 3.67121556974704*^9, {
   3.6712882389950333`*^9, 3.671288239322644*^9}, {3.671290370544409*^9, 
   3.671290371007855*^9}, {3.6712940600693283`*^9, 3.671294063443318*^9}, 
   3.671294170100638*^9, 3.671464828172792*^9, {3.671464868418222*^9, 
   3.671465041680908*^9}, {3.6714656618633413`*^9, 3.671465665839128*^9}, {
   3.6714659389424477`*^9, 3.671465978162683*^9}, {3.671466028010076*^9, 
   3.6714660341057863`*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Step 2:  Paths, filenames, and grouping: Set interferometer steps and period\
\>", "Section",
 CellChangeTimes->{{3.5033167061859503`*^9, 3.503316719635662*^9}, {
   3.50331674973533*^9, 3.503316754268928*^9}, {3.5033374747215557`*^9, 
   3.503337480080407*^9}, {3.503339142667317*^9, 3.5033391448651657`*^9}, {
   3.504730372452002*^9, 3.504730377984919*^9}, {3.507715381523715*^9, 
   3.507715399273287*^9}, {3.640111094694233*^9, 3.640111100667691*^9}, {
   3.640111518458076*^9, 3.640111535919319*^9}, 3.6402196556029873`*^9, {
   3.640219727445634*^9, 3.640219746025066*^9}, 3.6407127833693037`*^9, {
   3.640877835712092*^9, 3.640877845007203*^9}, 3.640941766414694*^9, 
   3.640956657458598*^9, {3.640964712550826*^9, 3.6409647211418133`*^9}, {
   3.640993195605362*^9, 3.6409932107178183`*^9}, {3.6410545089880657`*^9, 
   3.641054514538434*^9}, {3.641241003572548*^9, 3.641241014771098*^9}, {
   3.6429427969837027`*^9, 3.6429428069906273`*^9}, {3.642993682725779*^9, 
   3.642993698792001*^9}, 3.643013605244755*^9, {3.6430155059889927`*^9, 
   3.643015522516122*^9}}],

Cell[BoxData[{
 RowBox[{"pathRoot", " ", "=", " ", 
  "\"\</Volumes/Backup/BunnyData_MeleteMirror/feetdown_Hgrating/\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step1.mx\>\""}], "]"}]}], "Input",
 CellChangeTimes->{{3.670256726114709*^9, 3.670256727495994*^9}, {
  3.671465068684263*^9, 3.671465082465447*^9}, {3.6714652322414494`*^9, 
  3.671465242258831*^9}, {3.6714656543671*^9, 3.671465655942252*^9}}],

Cell[BoxData[{
 RowBox[{"pathTIFF", " ", "=", " ", 
  RowBox[{"pathRoot", "<>", "\"\<w2_tiff/\>\""}]}], "\n", 
 RowBox[{
  RowBox[{"pathHDF5", " ", "=", 
   RowBox[{"pathRoot", "<>", "\"\<w2_HDF5/\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pathFITS", " ", "=", " ", 
   RowBox[{"pathRoot", "<>", "\"\<w2_FITS/\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pathSlices", " ", "=", " ", 
   RowBox[{"pathRoot", "<>", "\"\<w2_slices_muhrec/\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pathFigures", " ", "=", " ", 
   RowBox[{"pathRoot", "<>", "\"\<w2_figures/\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pathVolumes", " ", "=", " ", 
   RowBox[{"pathRoot", "<>", "\"\<w2_volumes/\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pathSino", " ", "=", " ", 
   RowBox[{"pathRoot", "<>", "\"\<w2_sinograms/\>\""}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6412410267483788`*^9, 3.6412411530761433`*^9}, 
   3.641241438471719*^9, {3.641241526758952*^9, 3.6412415462699966`*^9}, 
   3.641242005840981*^9, {3.641242175241509*^9, 3.641242183112413*^9}, {
   3.6412932042243843`*^9, 3.641293206596053*^9}, {3.641470897401794*^9, 
   3.6414709011923923`*^9}, {3.642965777786106*^9, 3.642965780001011*^9}, {
   3.6431002743554897`*^9, 3.6431003132983418`*^9}, 3.643132439356534*^9, {
   3.6432323761563883`*^9, 3.643232389043206*^9}, {3.64323243072036*^9, 
   3.643232432815547*^9}, 3.643232509297954*^9, {3.643356987714909*^9, 
   3.643357003425498*^9}, {3.643372896666563*^9, 3.643372909729096*^9}, {
   3.643388358512354*^9, 3.6433883749670057`*^9}, 3.644575136023081*^9, {
   3.647463873862268*^9, 3.647463878176405*^9}, {3.647729504074758*^9, 
   3.647729524582345*^9}, 3.647858198172729*^9, {3.6478582334211597`*^9, 
   3.647858233886075*^9}, {3.648401312369697*^9, 3.648401313249342*^9}, {
   3.648486953627236*^9, 3.648486953849443*^9}, {3.652536235153125*^9, 
   3.65253628226366*^9}, {3.6714652538986797`*^9, 3.671465274742734*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cropRows", "=", 
   RowBox[{"{", 
    RowBox[{"1", ",", "185"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cropColumns", "=", 
   RowBox[{"{", 
    RowBox[{"100", ",", "350"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"rows", ",", "columns"}], "}"}], "=", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Max", "[", "cropRows", "]"}], "-", 
      RowBox[{"Min", "[", "cropRows", "]"}], "+", "1"}], ")"}], ",", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Max", "[", "cropColumns", "]"}], "-", 
      RowBox[{"Min", "[", "cropColumns", "]"}], "+", "1"}], ")"}]}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"gratingPeriodMicrons", " ", "=", " ", 
  "4.8"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"listGratingStepsMicrons", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"i", "-", "1"}], ")"}], "*", "0.50"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "12"}], "}"}]}], "]"}]}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"doseROI", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"30", ",", "40"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"60", ",", "80"}], "}"}]}], "}"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"same", " ", "coordinates", " ", "as", " ", "Muhrec", "  ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"30", ",", "50"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"60", ",", "90"}], "}"}]}], "}"}]}], 
   "*)"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.64294328512227*^9, 3.6429432939775257`*^9}, {
   3.6429944187203293`*^9, 3.6429944191906853`*^9}, 3.642994641138324*^9, {
   3.6430151096159143`*^9, 3.643015116096696*^9}, {3.643015229586103*^9, 
   3.643015314888823*^9}, {3.64302417653303*^9, 3.643024176916209*^9}, {
   3.643024419861512*^9, 3.643024500813236*^9}, {3.643024865263294*^9, 
   3.643024907158093*^9}, {3.6430250601997766`*^9, 3.643025078894594*^9}, {
   3.64302543880155*^9, 3.643025507117313*^9}, {3.643048026633605*^9, 
   3.643048056229459*^9}, {3.643232611835*^9, 3.643232626020805*^9}, {
   3.643235208045545*^9, 3.64323535850488*^9}, {3.6445776698856573`*^9, 
   3.644577670171897*^9}, {3.647464539669132*^9, 3.6474645962902317`*^9}, {
   3.647464649238305*^9, 3.647464669572413*^9}, {3.647465237173889*^9, 
   3.647465238459799*^9}, {3.6474668236091747`*^9, 3.647466826894765*^9}, {
   3.647467481217111*^9, 3.647467500438785*^9}, {3.6478598965365458`*^9, 
   3.647859907910556*^9}, {3.6484013367142076`*^9, 3.6484013378020267`*^9}, {
   3.6484023959123297`*^9, 3.648402396141778*^9}, {3.648402753548485*^9, 
   3.648402753714714*^9}, 3.648487000012746*^9, {3.648487117161139*^9, 
   3.648487120832012*^9}, {3.648487177427369*^9, 3.648487180330043*^9}, {
   3.651518777585507*^9, 3.651518786439164*^9}, {3.6714652902123337`*^9, 
   3.671465292004055*^9}, {3.676290972526576*^9, 3.676290972660659*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"funcFindReferenceTIFFfiles", "[", "pathTIFF", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"funcFindSampleTIFFfiles", "[", "pathTIFF", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"funcFindReferenceGroups", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"funcFindSampleGroups", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
   "processedNameStr", " ", "=", " ", 
    "\"\<feetdown_horizontal_12June2015\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"TableForm", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\"\<sample name\>\"", ",", " ", "rawNameStr"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<grating period (in microns)\>\"", ",", " ", 
      "gratingPeriodMicrons"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"\"\<grating steps (in microns)\>\"", ",", 
      RowBox[{"{", "listGratingStepsMicrons", "}"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"\"\<# of grating steps\>\"", ",", " ", 
      RowBox[{"Length", "[", "listGratingStepsMicrons", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<# of reference images\>\"", ",", " ", "numberOfReferenceFiles"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<# of reference groups\>\"", ",", " ", "numberOfReferenceGroups"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<bounds: reference groups\>\"", ",", " ", 
      "listReferenceSequenceNumbersGroupsBounds"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"\"\<# of sample images\>\"", ",", " ", "numberOfSampleFiles"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"\"\<# of sample groups\>\"", ",", " ", "numberOfSampleGroups"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{
     "\"\<bounds: sample groups\>\"", ",", " ", 
      "listSampleSequenceNumbersGroupsBounds"}], "}"}]}], " ", "}"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.642942885731103*^9, 3.6429430594885187`*^9}, 
   3.642943090068169*^9, {3.642943236658193*^9, 3.642943245505887*^9}, {
   3.6429445111309834`*^9, 3.642944548442677*^9}, {3.642944732662426*^9, 
   3.6429448019560823`*^9}, {3.6429451323343773`*^9, 3.64294513519728*^9}, {
   3.642946571476441*^9, 3.642946572101372*^9}, {3.6429649009689217`*^9, 
   3.64296491706874*^9}, 3.642964949951531*^9, {3.6429650053707457`*^9, 
   3.64296516758313*^9}, {3.642965841805414*^9, 3.642965850644126*^9}, {
   3.642966365831259*^9, 3.642966368173502*^9}, 3.642966447855028*^9, {
   3.642966849623358*^9, 3.6429668550307283`*^9}, {3.642966893574869*^9, 
   3.642966962678665*^9}, 3.642966993000021*^9, {3.642967061288519*^9, 
   3.6429671889863367`*^9}, {3.642967294961987*^9, 3.6429673031544743`*^9}, {
   3.642967351930307*^9, 3.642967364177862*^9}, {3.642994431072647*^9, 
   3.642994454947701*^9}, 3.642994641148024*^9, {3.643013811595284*^9, 
   3.643013826879774*^9}, {3.6430139395700903`*^9, 3.6430139547898207`*^9}, {
   3.643014072822837*^9, 3.643014167342864*^9}, 3.643047592328546*^9, {
   3.643232493434617*^9, 3.6432325214077997`*^9}, {3.647464690832683*^9, 
   3.647464754053389*^9}, {3.647464835064664*^9, 3.647464837058404*^9}, {
   3.67146531535905*^9, 3.6714653310943813`*^9}, {3.6714653694098597`*^9, 
   3.671465387530136*^9}, {3.671701489033205*^9, 3.671701496150401*^9}, 
   3.671701544407851*^9}],

Cell[BoxData[{
 RowBox[{"listSampleAngles", " ", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"from", " ", "function", " ", "1"}], "-", "1"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"numberOfAngles", " ", "=", " ", 
  RowBox[{"Length", "[", "listSampleAngles", "]"}]}]}], "Input",
 CellChangeTimes->{{3.643189928678344*^9, 3.643189956346787*^9}, {
  3.670256896149006*^9, 3.67025690497717*^9}}],

Cell[CellGroupData[{

Cell["2- DumpSave", "Subsection",
 CellChangeTimes->{{3.671211179812208*^9, 3.671211200099522*^9}, {
   3.671211329699849*^9, 3.671211387716975*^9}, 3.6712140481610613`*^9, {
   3.6714648208218184`*^9, 3.671464821195808*^9}, 3.671465890939961*^9, {
   3.6714754450160637`*^9, 3.671475445325985*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"pathRoot", "<>", "\"\<Step2.mx\>\""}], ",", 
    RowBox[{"{", 
     RowBox[{
     "pathTIFF", ",", "pathHDF5", ",", "pathFITS", ",", "pathSlices", ",", 
      "pathFigures", ",", "pathVolumes", ",", "pathSino", ",", "cropRows", 
      ",", "cropColumns", ",", "rows", ",", "columns", ",", 
      "gratingPeriodMicrons", ",", "listGratingStepsMicrons", ",", "doseROI", 
      ",", "rawNameStr", ",", "processedNameStr", ",", " ", 
      "gratingPeriodMicrons", ",", "listGratingStepsMicrons", ",", 
      "numberOfReferenceFiles", ",", "numberOfReferenceGroups", ",", 
      "listReferenceSequenceNumbersGroupsBounds", ",", 
      "numberOfReferenceFiles", ",", "numberOfReferenceGroups", ",", 
      "listSampleSequenceNumbersGroupsBounds", ",", "listSampleAngles", ",", 
      "numberOfAngles"}], "}"}]}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.67025676462562*^9, 3.6702568505019903`*^9}, {
   3.6702569079642677`*^9, 3.670256941636639*^9}, 3.671475692647147*^9, {
   3.6717015517292833`*^9, 3.67170155940732*^9}}],

Cell[BoxData[
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.670256922408524*^9, 3.670256923743527*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Step 3:  For any angle, process reference and sample interferograms\
\>", "Section",
 CellChangeTimes->{{3.5033167061859503`*^9, 3.503316719635662*^9}, {
   3.50331674973533*^9, 3.503316754268928*^9}, {3.5033374747215557`*^9, 
   3.503337480080407*^9}, {3.503339142667317*^9, 3.5033391448651657`*^9}, {
   3.504730372452002*^9, 3.504730377984919*^9}, {3.507715381523715*^9, 
   3.507715399273287*^9}, {3.640111094694233*^9, 3.640111100667691*^9}, {
   3.640111518458076*^9, 3.640111535919319*^9}, 3.6402196556029873`*^9, {
   3.640219727445634*^9, 3.640219746025066*^9}, 3.6407127833693037`*^9, {
   3.640877835712092*^9, 3.640877845007203*^9}, 3.640941766414694*^9, 
   3.640956657458598*^9, {3.640964712550826*^9, 3.6409647211418133`*^9}, {
   3.640993195605362*^9, 3.6409932107178183`*^9}, {3.6410545089880657`*^9, 
   3.641054514538434*^9}, {3.641241003572548*^9, 3.641241014771098*^9}, {
   3.6429427969837027`*^9, 3.6429428069906273`*^9}, {3.642993682725779*^9, 
   3.642993698792001*^9}, {3.6429939923302717`*^9, 3.642993999388014*^9}, {
   3.6430171776603317`*^9, 3.6430172028153048`*^9}, {3.643044324488636*^9, 
   3.643044335744014*^9}, {3.643051971438998*^9, 3.643051976686528*^9}, {
   3.671539314649817*^9, 3.671539315514192*^9}}],

Cell[BoxData[{
 RowBox[{"pathRoot", " ", "=", " ", 
  "\"\</Volumes/Backup/BunnyData_MeleteMirror/feetdown_Hgrating/\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step1.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step2.mx\>\""}], "]"}]}], "Input",
 CellChangeTimes->{{3.670588405763463*^9, 3.670588405763843*^9}, 
   3.671475324900103*^9, {3.6714754199986277`*^9, 3.6714754232469*^9}}],

Cell[CellGroupData[{

Cell["3-1. initialize vectors used for the calculation", "Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.643052262972385*^9}, {
  3.6702570484894743`*^9, 3.670257049793559*^9}}],

Cell[BoxData[{
 RowBox[{"funcPrepareAllVectors", "[", 
  RowBox[{
  "gratingPeriodMicrons", ",", "listGratingStepsMicrons", ",", "rows", ",", 
   "columns"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Dimensions", "[", "gMatrix", "]"}], ",", 
   RowBox[{"Dimensions", "[", "bVector", "]"}], ",", 
   RowBox[{"Dimensions", "[", "aVector", "]"}], ",", 
   RowBox[{"Dimensions", "[", "aMatrix", "]"}], ",", 
   RowBox[{"Dimensions", "[", "visibility", "]"}], ",", 
   RowBox[{"Dimensions", "[", "phi", "]"}]}], "}"}]}], "Input",
 CellChangeTimes->{{3.586190989265067*^9, 3.586191146492814*^9}, {
   3.586197636565769*^9, 3.58619764497383*^9}, {3.5861998440314093`*^9, 
   3.586199848958981*^9}, {3.606817109173208*^9, 3.6068171225622387`*^9}, {
   3.615673502859898*^9, 3.6156735117803783`*^9}, 3.642994579788828*^9, 
   3.642994640059691*^9, 3.6430147625809507`*^9, {3.643015065536385*^9, 
   3.643015080149454*^9}, {3.6430153704280567`*^9, 3.643015453595624*^9}, {
   3.64746503842805*^9, 3.6474650460122147`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["3-2. set angle for calculation, find the correct filenames", \
"Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.643052291765689*^9}, {
  3.670257051761609*^9, 3.670257053185602*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"funcFindReferenceTIFFfiles", "[", "pathTIFF", "]"}], 
  RowBox[{"(*", 
   RowBox[{
   "need", " ", "call", " ", "variables", " ", "from", " ", "functions"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"funcFindSampleTIFFfiles", "[", "pathTIFF", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"funcFindReferenceGroups", "[", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"funcFindSampleGroups", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.6705884355307283`*^9, 3.6705884431360483`*^9}}],

Cell[BoxData[{
 RowBox[{"angle", " ", "=", " ", 
  RowBox[{"First", "[", "listSampleAngles", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"listFilenamesReferenceOneInterferogram", "=", " ", 
  RowBox[{
  "funcGetReferenceFilenamesforSpecficAngle", "[", "angle", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"listFilenamesSampleOneInterferogram", "=", 
  RowBox[{
  "funcGetSampleFilenamesForSpecificAngle", "[", "angle", "]"}]}]}], "Input",
 CellChangeTimes->{{3.643044354657213*^9, 3.64304443242247*^9}, 
   3.643048107215909*^9, {3.643099887470038*^9, 3.643099939056226*^9}, {
   3.6430999715034237`*^9, 3.643099971651205*^9}, {3.643100006035054*^9, 
   3.6431000061979628`*^9}, 3.643132492516058*^9, {3.643147612184771*^9, 
   3.643147615397058*^9}, {3.643147811289448*^9, 3.6431478122128363`*^9}, {
   3.643150807544746*^9, 3.643150808521676*^9}, {3.643150952612116*^9, 
   3.643150974120974*^9}, {3.643189779956792*^9, 3.643189781395287*^9}, {
   3.643211001146225*^9, 3.6432110027158003`*^9}, 3.643232580599196*^9, 
   3.643288251437036*^9, {3.6433567471288443`*^9, 3.643356751169529*^9}, {
   3.64336373369853*^9, 3.643363793916799*^9}, {3.64337293723316*^9, 
   3.6433729376270933`*^9}, {3.643373317843874*^9, 3.643373321042905*^9}, {
   3.643373533421153*^9, 3.6433735336200733`*^9}, {3.6433736770217524`*^9, 
   3.643373677220868*^9}, {3.647371995265106*^9, 3.647371995512938*^9}, 
   3.647372088448883*^9, {3.648402108876548*^9, 3.648402109323657*^9}, {
   3.648402162343268*^9, 3.648402163597801*^9}, {3.648402357101267*^9, 
   3.6484023573403*^9}, {3.6484024786421957`*^9, 3.648402478880649*^9}, 
   3.648403171162732*^9, {3.6494424428497*^9, 3.649442443000424*^9}, {
   3.650280285542219*^9, 3.6502802857406673`*^9}, 3.651345273848752*^9, 
   3.671475410878282*^9, {3.671475788636075*^9, 3.671475789777769*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
3-3. calculate transmission, visibility, and phi for reference and sample \
\>", "Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.643052325959464*^9}, {
  3.6702570544817343`*^9, 3.670257055960911*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"interferogramReference", "=", 
   RowBox[{"funcReadOneInterferogram", "[", 
    RowBox[{
    "listFilenamesReferenceOneInterferogram", ",", "rows", ",", "columns", 
     ",", "listGratingStepsMicrons"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "interferogramReference", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "referenceTransmission", ",", "referenceVisibility", ",", 
     "referencePhi"}], "}"}], "=", 
   RowBox[{
   "funcCalculateTransmissionVisibilityPhi", "[", "interferogramReference", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Dimensions", "[", "referenceTransmission", "]"}], ",", 
   RowBox[{"Min", "[", "referenceTransmission", "]"}], ",", 
   RowBox[{
    RowBox[{"Mean", "[", 
     RowBox[{"Flatten", "[", "referenceTransmission", "]"}], "]"}], "//", 
    "N"}], ",", 
   RowBox[{"Max", "[", "referenceTransmission", "]"}]}], 
  "}"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Dimensions", "[", "referenceVisibility", "]"}], ",", 
   RowBox[{"Min", "[", "referenceVisibility", "]"}], ",", 
   RowBox[{
    RowBox[{"Mean", "[", 
     RowBox[{"Flatten", "[", "referenceVisibility", "]"}], "]"}], "//", "N"}],
    ",", 
   RowBox[{"Max", "[", "referenceVisibility", "]"}]}], 
  "}"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Dimensions", "[", "referencePhi", "]"}], ",", 
   RowBox[{"Min", "[", "referencePhi", "]"}], ",", 
   RowBox[{
    RowBox[{"Mean", "[", 
     RowBox[{"Flatten", "[", "referencePhi", "]"}], "]"}], "//", "N"}], ",", 
   RowBox[{"Max", "[", "referencePhi", "]"}]}], 
  "}"}], "\[IndentingNewLine]", "timeImage"}], "Input",
 CellChangeTimes->{{3.6430192264484253`*^9, 3.6430192556693773`*^9}, {
   3.64301950118108*^9, 3.643019519989151*^9}, {3.6430197939240847`*^9, 
   3.643019842054304*^9}, {3.6430200284140863`*^9, 3.643020029551947*^9}, {
   3.64302396138021*^9, 3.6430239617328587`*^9}, {3.6473720472727633`*^9, 
   3.64737204968361*^9}, 3.6474654666762867`*^9, {3.647465731359866*^9, 
   3.647465735060459*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"interferogramSample", "=", 
   RowBox[{"funcReadOneInterferogram", "[", 
    RowBox[{
    "listFilenamesSampleOneInterferogram", ",", "rows", ",", "columns", ",", 
     "listGratingStepsMicrons"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "interferogramSample", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"sampleTransmission", ",", "sampleVisibility", ",", "samplePhi"}],
     "}"}], "=", 
   RowBox[{
   "funcCalculateTransmissionVisibilityPhi", "[", "interferogramSample", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Dimensions", "[", "sampleTransmission", "]"}], ",", 
   RowBox[{"Min", "[", "sampleTransmission", "]"}], ",", 
   RowBox[{
    RowBox[{"Mean", "[", 
     RowBox[{"Flatten", "[", "sampleTransmission", "]"}], "]"}], "//", "N"}], 
   ",", 
   RowBox[{"Max", "[", "sampleTransmission", "]"}]}], 
  "}"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Dimensions", "[", "sampleVisibility", "]"}], ",", 
   RowBox[{"Min", "[", "sampleVisibility", "]"}], ",", 
   RowBox[{
    RowBox[{"Mean", "[", 
     RowBox[{"Flatten", "[", "sampleVisibility", "]"}], "]"}], "//", "N"}], 
   ",", 
   RowBox[{"Max", "[", "sampleVisibility", "]"}]}], 
  "}"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Dimensions", "[", "samplePhi", "]"}], ",", 
   RowBox[{"Min", "[", "samplePhi", "]"}], ",", 
   RowBox[{
    RowBox[{"Mean", "[", 
     RowBox[{"Flatten", "[", "samplePhi", "]"}], "]"}], "//", "N"}], ",", 
   RowBox[{"Max", "[", "samplePhi", "]"}]}], 
  "}"}], "\[IndentingNewLine]", "timeImage"}], "Input",
 CellChangeTimes->{{3.6473720679057093`*^9, 3.6473720682898912`*^9}, 
   3.647465759362228*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
3-4. correct for bad pixels:  referenceTransmission, sampleTransmission, \
referenceVisibility \
\>", "Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.643052325959464*^9}, {
  3.6430531427520027`*^9, 3.643053158495904*^9}, {3.643061045178461*^9, 
  3.6430610879082127`*^9}, {3.6702570577532387`*^9, 3.670257058680728*^9}}],

Cell[BoxData[{
 RowBox[{"Position", "[", 
  RowBox[{"referenceTransmission", ",", 
   RowBox[{"p_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", "\[Equal]", "0"}], "&"}], ")"}]}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"referenceTransmission", "=", 
   RowBox[{
   "funcCorrectForZeroValuePixels", "[", "referenceTransmission", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Position", "[", 
   RowBox[{"referenceTransmission", ",", 
    RowBox[{"p_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", "\[Equal]", "0"}], "&"}], ")"}]}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Position", "[", 
  RowBox[{"sampleTransmission", ",", 
   RowBox[{"p_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", "\[Equal]", "0"}], "&"}], ")"}]}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sampleTransmission", "=", 
   RowBox[{
   "funcCorrectForZeroValuePixels", "[", "sampleTransmission", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Position", "[", 
   RowBox[{"sampleTransmission", ",", 
    RowBox[{"p_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"#", "\[Equal]", "0"}], "&"}], ")"}]}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Position", "[", 
  RowBox[{"referenceVisibility", ",", 
   RowBox[{"p_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", "\[Equal]", "0"}], "&"}], ")"}]}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"referenceVisibility", "=", 
   RowBox[{
   "funcCorrectForZeroValuePixels", "[", "referenceVisibility", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Position", "[", 
  RowBox[{"referenceVisibility", ",", 
   RowBox[{"p_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"#", "\[Equal]", "0"}], "&"}], ")"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.643053376307428*^9, 3.6430533915754547`*^9}, {
  3.643053521388743*^9, 3.643053526155384*^9}, {3.643060859098448*^9, 
  3.643060890864382*^9}, {3.643061093186206*^9, 3.643061148264038*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
3-5. plot transmission, visibility, and phi for reference and sample \
\>", "Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.6430523559129753`*^9}, {
  3.670257060273148*^9, 3.670257060912898*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"testPointOne", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Round", "[", 
      RowBox[{"columns", "/", "2"}], "]"}], ",", 
     RowBox[{"Round", "[", 
      RowBox[{"rows", "/", "2"}], "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"climTrans", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Min", "[", "referenceTransmission", "]"}], ",", 
     RowBox[{"Max", "[", "referenceTransmission", "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"climVis", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Min", "[", "referenceVisibility", "]"}], ",", 
     RowBox[{"Max", "[", "referenceVisibility", "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"climPhi", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Min", "[", "referencePhi", "]"}], ",", 
     RowBox[{"Max", "[", "referencePhi", "]"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"gAllReference", " ", "=", " ", 
  RowBox[{"funcPlotTransmissionVisbilityPhiFit", "[", 
   RowBox[{
   "testPointOne", ",", "\"\<ref\>\"", ",", "referenceTransmission", ",", 
    "referenceVisibility", ",", "referencePhi", ",", 
    "interferogramReference"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.6430512886069508`*^9, 3.6430513250109043`*^9}, {
  3.6430515821958723`*^9, 3.6430515838846607`*^9}, {3.64305206723639*^9, 
  3.643052071739945*^9}, {3.643147491673972*^9, 3.643147495803631*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "sampleTransmission", "]"}]], "Input",
 CellChangeTimes->{{3.643373841395535*^9, 3.643373846990034*^9}}],

Cell[BoxData[
 RowBox[{"gAllSample", " ", "=", " ", 
  RowBox[{"funcPlotTransmissionVisbilityPhiFit", "[", 
   RowBox[{
   "testPointOne", ",", "\"\<sample\>\"", ",", "sampleTransmission", ",", 
    "sampleVisibility", ",", "samplePhi", ",", "interferogramSample"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.64305152114369*^9, 3.643051536929922*^9}, {
  3.643051589379818*^9, 3.643051591772669*^9}, {3.643052079661612*^9, 
  3.64305208301245*^9}, {3.643147501691058*^9, 3.643147502571405*^9}}],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathFigures", "<>", "\"\<trans_DPC_DF_fit_\>\"", "<>", 
    RowBox[{"ToString", "[", "angle", "]"}], "<>", "\"\<.png\>\""}], ",", 
   "gAllSample", ",", "\"\<PNG\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.643356926954577*^9, 3.6433569545072727`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
3-6. calculate absorption, differential phase contrast,  dark-field, \
integrated linear diffusion coeff.\
\>", "Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.6430523559129753`*^9}, {
  3.6430523924760933`*^9, 3.643052405555376*^9}, {3.643052494008638*^9, 
  3.643052505184188*^9}, {3.6702570638253107`*^9, 3.6702570650328007`*^9}, {
  3.67629240204841*^9, 3.676292404249042*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"absorption", " ", "=", 
   RowBox[{
    RowBox[{"-", 
     RowBox[{"Log", "[", " ", 
      FractionBox["sampleTransmission", "referenceTransmission"], "]"}]}], 
    "  ", "//", "N"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Min", "[", "absorption", "]"}], ",", 
   RowBox[{"Mean", "[", 
    RowBox[{"Flatten", "[", "absorption", "]"}], "]"}], ",", 
   RowBox[{"Max", "[", "absorption", "]"}]}], "}"}]}], "Input",
 CellChangeTimes->{{3.6430525812773848`*^9, 3.6430525889503403`*^9}, {
  3.643052680638432*^9, 3.643052683314357*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"differentialPhase", " ", "=", " ", 
   RowBox[{"samplePhi", " ", "-", " ", "referencePhi"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Min", "[", "differentialPhase", "]"}], ",", 
   RowBox[{"Mean", "[", 
    RowBox[{"Flatten", "[", "differentialPhase", "]"}], "]"}], ",", 
   RowBox[{"Max", "[", "differentialPhase", "]"}]}], 
  "}"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"differentialPhase", "=", " ", 
   RowBox[{"funcCorrectLargeDPCvalue", "[", "differentialPhase", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Min", "[", "differentialPhase", "]"}], ",", 
   RowBox[{"Mean", "[", 
    RowBox[{"Flatten", "[", "differentialPhase", "]"}], "]"}], ",", 
   RowBox[{"Max", "[", "differentialPhase", "]"}]}], "}"}]}], "Input",
 CellChangeTimes->{{3.643060968582905*^9, 3.643060973590876*^9}, {
  3.643061350439266*^9, 3.643061428764351*^9}, {3.643061659609696*^9, 
  3.643061682051736*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"darkfield", " ", "=", " ", 
   FractionBox[
    RowBox[{"sampleVisibility", "/", "referenceVisibility"}], 
    RowBox[{"sampleTransmission", "/", "referenceTransmission"}]]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Min", "[", "darkfield", "]"}], ",", 
   RowBox[{"Mean", "[", 
    RowBox[{"Flatten", "[", "darkfield", "]"}], "]"}], ",", 
   RowBox[{"Max", "[", "darkfield", "]"}]}], "}"}]}], "Input",
 CellChangeTimes->{{3.643061001195939*^9, 3.643061009322452*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ILDC", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"-", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"G2gratingPeriodMicrons", "/", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Pi", "*", "distanceSampletoG2"}], "]"}]}], ")"}], "^", 
         "2"}], "/", "2"}], ")"}]}], "*", 
     RowBox[{"Log", "[", "darkfield", "]"}]}], " ", "//", "N"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Min", "[", "ILDC", "]"}], ",", 
   RowBox[{"Mean", "[", 
    RowBox[{"Flatten", "[", "ILDC", "]"}], "]"}], ",", 
   RowBox[{"Max", "[", "ILDC", "]"}]}], "}"}]}], "Input"],

Cell[TextData[{
 "The reference for integrated linear diffusion coeffient is Phys. Med. Biol. \
55 (2010) 5529\[Dash]5539\nM Bech, O Bunk, T Donath, R Feidenhans\
\[CloseCurlyQuote]l, C David and F Pfeiffer, Quantitative x-ray dark-field \
computed tomography\nSee equation 17\nILDC = ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    FractionBox[
     RowBox[{"-", 
      SuperscriptBox[
       SubscriptBox["p", "2"], "2"]}], 
     RowBox[{"2", " ", 
      SuperscriptBox["\[Pi]", "2"], 
      SuperscriptBox["d", "2"]}]], 
    RowBox[{"ln", "(", 
     RowBox[{"dark", " ", "field"}], ")"}]}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 "\n"
}], "Text",
 CellChangeTimes->{{3.676292657065805*^9, 3.676292825551914*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
3-7. plot absorption, differential phase contrast, dark-field, \
visibilityPercent, ILDC\
\>", "Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.6430523559129753`*^9}, {
  3.6430523924760933`*^9, 3.643052405555376*^9}, {3.670257066705193*^9, 
  3.670257068328642*^9}, {3.676292517334247*^9, 3.676292574167589*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"plotLabel", "=", "\"\<vertical sensitivity\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"climAbs", "=", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1.0"}], "}"}]}], ";", " ", 
  RowBox[{"climDPC", "=", 
   RowBox[{"0.5", "*", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"-", "\[Pi]"}], ",", "\[Pi]"}], "}"}]}]}], ";", 
  RowBox[{"climDarkField", "=", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"gAbsDpcDF", "=", 
  RowBox[{"funcPlotAbsorptionDPCDarkField", "[", 
   RowBox[{
   "plotLabel", ",", "absorption", ",", "differentialPhase", ",", "ILDC"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.643099748871211*^9, 3.643099791897463*^9}, {
   3.6433565869406548`*^9, 3.6433567151284924`*^9}, {3.643356843429031*^9, 
   3.6433568618047028`*^9}, {3.649501350170074*^9, 3.64950138577673*^9}, {
   3.6513460919857683`*^9, 3.651346104632182*^9}, {3.651427171400237*^9, 
   3.651427199523233*^9}, 3.676292448031086*^9}],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathFigures", "<>", "\"\<abs_DPC_DF_\>\"", "<>", 
    RowBox[{"ToString", "[", "angle", "]"}], "<>", "\"\<.png\>\""}], ",", 
   "gAbsDpcDF", ",", "\"\<PNG\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.6433568034501657`*^9, 3.6433568240366364`*^9}, 
   3.6433568739731894`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["3-8. plot doseROI", "Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.6430523559129753`*^9}, {
  3.6430523924760933`*^9, 3.643052405555376*^9}, {3.643052494008638*^9, 
  3.643052505184188*^9}, {3.647761470990769*^9, 3.647761475826824*^9}, {
  3.670257070665576*^9, 3.6702570744569073`*^9}}],

Cell[BoxData[{"doseROI", "\[IndentingNewLine]", 
 RowBox[{"columnROI", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"doseROI", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
    RowBox[{"doseROI", "[", 
     RowBox[{"[", 
      RowBox[{"2", ",", "2"}], "]"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"rowROI", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"doseROI", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
    RowBox[{"doseROI", "[", 
     RowBox[{"[", 
      RowBox[{"2", ",", "1"}], "]"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"ImageResize", "[", 
  RowBox[{
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"Image", "[", 
     RowBox[{
      RowBox[{"Take", "[", 
       RowBox[{"absorption", ",", "columnROI", ",", "rowROI"}], "]"}], ",", 
      "\"\<Real\>\""}], "]"}], "]"}], ",", "500"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"meanBackgroundAbsorptionSelectedAngle", "=", " ", 
  RowBox[{"Mean", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Take", "[", 
     RowBox[{"absorption", ",", "columnROI", ",", "rowROI"}], "]"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"meanBackgroundDPCSelectedAngle", "=", " ", 
  RowBox[{"Mean", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Take", "[", 
     RowBox[{"differentialPhase", ",", "columnROI", ",", "rowROI"}], "]"}], 
    "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"meanBackgroundDarkFieldSelectedAngle", "=", " ", 
  RowBox[{"Mean", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Take", "[", 
     RowBox[{"darkfield", ",", "columnROI", ",", "rowROI"}], "]"}], "]"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.643572022711059*^9, 3.643572255682542*^9}, {
  3.6435722897162113`*^9, 3.643572320360796*^9}, {3.643572385468945*^9, 
  3.643572625397505*^9}, {3.6435726724793777`*^9, 3.643572699349534*^9}, {
  3.6435727837651653`*^9, 3.643572795552305*^9}, {3.643572906611966*^9, 
  3.643572931773584*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["3- DumpSave", "Subsection",
 CellChangeTimes->{{3.671211179812208*^9, 3.671211200099522*^9}, {
   3.671211329699849*^9, 3.671211387716975*^9}, 3.6712140481610613`*^9, {
   3.6714648208218184`*^9, 3.671464821195808*^9}, 3.671465890939961*^9, {
   3.6714754450160637`*^9, 3.671475459376915*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"pathRoot", "<>", "\"\<Step3.mx\>\""}], ",", 
    RowBox[{"{", 
     RowBox[{
     "timeImage", ",", "referenceTransmission", ",", "referenceVisibility", 
      ",", "referencePhi", ",", "sampleTransmission", ",", "sampleVisibility",
       ",", "samplePhi", ",", "testPointOne", ",", "climTrans", ",", 
      "climVis", ",", "climPhi", ",", "absorption", ",", "differentialPhase", 
      ",", "climAbs", ",", "doseROI", ",", "columnROI", ",", "rowROI", ",", 
      "meanBackgroundAbsorptionSelectedAngle", ",", 
      "meanBackgroundDPCSelectedAngle", ",", 
      "meanBackgroundDarkFieldSelectedAngle", ",", "darkfield"}], "}"}]}], 
   "]"}], ";"}], "\n", 
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}]}], "Input",
 CellChangeTimes->{{3.670588484992837*^9, 3.67058848499339*^9}, 
   3.6706767423327713`*^9, 3.671475707791707*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Step 4:  For all angles, create sample interferograms", "Section",
 CellChangeTimes->{{3.5033167061859503`*^9, 3.503316719635662*^9}, {
   3.50331674973533*^9, 3.503316754268928*^9}, {3.5033374747215557`*^9, 
   3.503337480080407*^9}, {3.503339142667317*^9, 3.5033391448651657`*^9}, {
   3.504730372452002*^9, 3.504730377984919*^9}, {3.507715381523715*^9, 
   3.507715399273287*^9}, {3.640111094694233*^9, 3.640111100667691*^9}, {
   3.640111518458076*^9, 3.640111535919319*^9}, 3.6402196556029873`*^9, {
   3.640219727445634*^9, 3.640219746025066*^9}, 3.6407127833693037`*^9, {
   3.640877835712092*^9, 3.640877845007203*^9}, 3.640941766414694*^9, 
   3.640956657458598*^9, {3.640964712550826*^9, 3.6409647211418133`*^9}, {
   3.640993195605362*^9, 3.6409932107178183`*^9}, {3.6410545089880657`*^9, 
   3.641054514538434*^9}, {3.641241003572548*^9, 3.641241014771098*^9}, {
   3.6429427969837027`*^9, 3.6429428069906273`*^9}, {3.642993682725779*^9, 
   3.642993698792001*^9}, {3.6429939923302717`*^9, 3.642993999388014*^9}, {
   3.6430171776603317`*^9, 3.6430172028153048`*^9}, {3.643044324488636*^9, 
   3.643044335744014*^9}, {3.643051971438998*^9, 3.643051976686528*^9}, {
   3.643052135903675*^9, 3.643052143558909*^9}, {3.671539307194153*^9, 
   3.671539311168118*^9}, {3.672936869232914*^9, 3.6729368707012997`*^9}}],

Cell[BoxData[{
 RowBox[{"pathRoot", " ", "=", " ", 
  "\"\</Volumes/Backup/BunnyData_MeleteMirror/feetdown_Hgrating/\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step1.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step2.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step3.mx\>\""}], "]"}]}], "Input",
 CellChangeTimes->{{3.670588405763463*^9, 3.670588405763843*^9}, 
   3.671475324900103*^9, {3.6714754199986277`*^9, 3.6714754232469*^9}, {
   3.6714756289932337`*^9, 3.6714756319936867`*^9}}],

Cell[CellGroupData[{

Cell["4-1. initialize vectors used for the calculation", "Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.643052262972385*^9}, {
  3.670257078569461*^9, 3.6702570793530407`*^9}}],

Cell[BoxData[{
 RowBox[{"funcPrepareAllVectors", "[", 
  RowBox[{
  "gratingPeriodMicrons", ",", "listGratingStepsMicrons", ",", "rows", ",", 
   "columns"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Dimensions", "[", "gMatrix", "]"}], ",", 
   RowBox[{"Dimensions", "[", "bVector", "]"}], ",", 
   RowBox[{"Dimensions", "[", "aVector", "]"}], ",", 
   RowBox[{"Dimensions", "[", "aMatrix", "]"}], ",", 
   RowBox[{"Dimensions", "[", "visibility", "]"}], ",", 
   RowBox[{"Dimensions", "[", "phi", "]"}]}], "}"}]}], "Input",
 CellChangeTimes->{{3.586190989265067*^9, 3.586191146492814*^9}, {
   3.586197636565769*^9, 3.58619764497383*^9}, {3.5861998440314093`*^9, 
   3.586199848958981*^9}, {3.606817109173208*^9, 3.6068171225622387`*^9}, {
   3.615673502859898*^9, 3.6156735117803783`*^9}, 3.642994579788828*^9, 
   3.642994640059691*^9, 3.6430147625809507`*^9, {3.643015065536385*^9, 
   3.643015080149454*^9}, {3.6430153704280567`*^9, 3.643015453595624*^9}, {
   3.64746503842805*^9, 3.6474650460122147`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
4-2. for all angles, calculate absorption, DPC, dark-field, and percent \
visibility and store HDF5, FITS\
\>", "Subsection",
 CellChangeTimes->{{3.643052230514303*^9, 3.643052325959464*^9}, {
  3.643102053609687*^9, 3.643102069199346*^9}, {3.6702570810407753`*^9, 
  3.670257082336684*^9}, {3.671479505440336*^9, 3.671479530055942*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"funcFindReferenceTIFFfiles", "[", "pathTIFF", "]"}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
   "need", " ", "call", " ", "variables", " ", "from", " ", "functions"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"funcFindSampleTIFFfiles", "[", "pathTIFF", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"funcFindReferenceGroups", "[", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"funcFindSampleGroups", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.670588523216715*^9, 3.6705885267596273`*^9}, 
   3.671476480573617*^9}],

Cell[BoxData["listSampleAngles"], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"oldlistFilenamesReferenceOneInterferogram", " ", "=", " ", 
   RowBox[{"{", "\"\< \>\"", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"listTimeAngle", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"angle", " ", "=", " ", 
         RowBox[{"listSampleAngles", "[", 
          RowBox[{"[", "indexListAngle", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"listFilenamesReferenceOneInterferogram", "=", " ", 
         RowBox[{
         "funcGetReferenceFilenamesforSpecficAngle", "[", "angle", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"{", 
            RowBox[{"indexListAngle", ",", "\"\<# of ref images =\>\"", ",", 
             RowBox[{
             "Length", "[", "listFilenamesReferenceOneInterferogram", "]"}]}],
             "}"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "First", "[", "oldlistFilenamesReferenceOneInterferogram", "]"}], "!=", 
           RowBox[{
           "First", "[", "listFilenamesReferenceOneInterferogram", "]"}]}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"interferogramReference", "=", 
            RowBox[{"funcReadOneInterferogram", "[", 
             RowBox[{
             "listFilenamesReferenceOneInterferogram", ",", "rows", ",", 
              "columns", ",", "listGratingStepsMicrons"}], "]"}]}], ";"}]}], 
         "  ", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "referenceTransmission", ",", "referenceVisibility", ",", 
           "referencePhi"}], "}"}], "=", 
         RowBox[{
         "funcCalculateTransmissionVisibilityPhi", "[", 
          "interferogramReference", "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"listFilenamesSampleOneInterferogram", "=", 
         RowBox[{
         "funcGetSampleFilenamesForSpecificAngle", "[", "angle", "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"{", 
          RowBox[{
          "indexListAngle", ",", "\"\<# of sample images =\>\"", ",", 
           RowBox[{
           "Length", "[", "listFilenamesSampleOneInterferogram", "]"}]}], 
          "}"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"interferogramSample", "=", 
         RowBox[{"funcReadOneInterferogram", "[", 
          RowBox[{
          "listFilenamesSampleOneInterferogram", ",", "rows", ",", "columns", 
           ",", "listGratingStepsMicrons"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"{", 
            RowBox[{"indexListAngle", ",", "angle", ",", "timeImage"}], "}"}],
            "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "sampleTransmission", ",", "sampleVisibility", ",", "samplePhi"}], 
          "}"}], "=", 
         RowBox[{
         "funcCalculateTransmissionVisibilityPhi", "[", "interferogramSample",
           "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"referenceTransmission", "=", 
         RowBox[{
         "funcCorrectForZeroValuePixels", "[", "referenceTransmission", 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sampleTransmission", "=", 
         RowBox[{
         "funcCorrectForZeroValuePixels", "[", "sampleTransmission", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"referenceVisibility", "=", 
         RowBox[{
         "funcCorrectForZeroValuePixels", "[", "referenceVisibility", "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"absorption", " ", "=", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Log", "[", " ", 
            FractionBox["sampleTransmission", "referenceTransmission"], 
            "]"}]}], "  ", "//", "N"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"differentialPhase", " ", "=", " ", 
         RowBox[{"samplePhi", " ", "-", " ", "referencePhi"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"darkfield", " ", "=", " ", 
         FractionBox[
          RowBox[{"sampleVisibility", "/", "referenceVisibility"}], 
          RowBox[{"sampleTransmission", "/", "referenceTransmission"}]]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"sampleVisibilityPercent", " ", "=", " ", 
         RowBox[{"100", " ", "*", " ", 
          FractionBox["sampleVisibility", "sampleTransmission"]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"filenameHDF5", " ", "=", " ", 
         RowBox[{"processedNameStr", "<>", "\"\<_\>\"", "<>", 
          RowBox[{"IntegerString", "[", 
           RowBox[{"indexListAngle", ",", "10", ",", "5"}], "]"}], "<>", 
          "\"\<_\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"NumberForm", "[", 
            RowBox[{"angle", ",", 
             RowBox[{"{", 
              RowBox[{"6", ",", "4"}], "}"}], ",", 
             RowBox[{"NumberPadding", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<0\>\"", ",", "\"\<0\>\""}], "}"}]}]}], "]"}], 
           "]"}], "<>", "\"\<.h5\>\""}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"filenameFITSabs", "=", " ", 
         RowBox[{"processedNameStr", "<>", "\"\<_abs_\>\"", "<>", 
          RowBox[{"IntegerString", "[", 
           RowBox[{"indexListAngle", ",", "10", ",", "5"}], "]"}], "<>", 
          "\"\<.fits\>\""}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"filenameFITSdpc", "=", " ", 
         RowBox[{"processedNameStr", "<>", "\"\<_dpc_\>\"", "<>", 
          RowBox[{"IntegerString", "[", 
           RowBox[{"indexListAngle", ",", "10", ",", "5"}], "]"}], "<>", 
          "\"\<.fits\>\""}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"filenameFITSdpcCorr", "=", " ", 
         RowBox[{"processedNameStr", "<>", "\"\<_dpc_corr_\>\"", "<>", 
          RowBox[{"IntegerString", "[", 
           RowBox[{"indexListAngle", ",", "10", ",", "5"}], "]"}], "<>", 
          "\"\<.fits\>\""}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"filenameFITSdarkfield", "=", " ", 
         RowBox[{"processedNameStr", "<>", "\"\<_darkfield_\>\"", "<>", 
          RowBox[{"IntegerString", "[", 
           RowBox[{"indexListAngle", ",", "10", ",", "5"}], "]"}], "<>", 
          "\"\<.fits\>\""}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"filenameFITSsamplevisibility", "=", " ", 
         RowBox[{"processedNameStr", "<>", "\"\<_visibilityPercent_\>\"", "<>", 
          RowBox[{"IntegerString", "[", 
           RowBox[{"indexListAngle", ",", "10", ",", "5"}], "]"}], "<>", 
          "\"\<.fits\>\""}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"pathHDF5", "<>", "filenameHDF5"}], ",", 
          RowBox[{"{", 
           RowBox[{
           "absorption", ",", "differentialPhase", ",", "darkfield", ",", 
            "sampleVisibilityPercent"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"\"\<Datasets\>\"", ",", 
            RowBox[{"{", 
             RowBox[{
             "\"\<absorption\>\"", ",", "\"\<dpc\>\"", ",", 
              "\"\<darkfield\>\"", ",", "\"\<visibilityPercent\>\""}], 
             "}"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"pathFITS", "<>", "filenameFITSabs"}], ",", "absorption"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"pathFITS", "<>", "filenameFITSdpc"}], ",", 
          "differentialPhase"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"pathFITS", "<>", "filenameFITSdpcCorr"}], ",", 
          "differentialPhaseCorr"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"pathFITS", "<>", "filenameFITSdarkfield"}], ",", 
          "darkfield"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"pathFITS", "<>", "filenameFITSsamplevisibility"}], ",", 
          "sampleVisibilityPercent"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"timeImage", ",", "angle"}], "}"}]}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"indexListAngle", ",", "numberOfAngles"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"DateListPlot", "[", 
  RowBox[{"listTimeAngle", ",", 
   RowBox[{"DateTicksFormat", "->", 
    RowBox[{"{", 
     RowBox[{"\"\<Hour\>\"", ",", "\"\<:\>\"", ",", "\"\<Minute\>\""}], 
     "}"}]}], ",", 
   RowBox[{"Joined", "\[Rule]", "False"}], ",", 
   RowBox[{"Frame", "\[Rule]", "True"}], ",", 
   RowBox[{"FrameLabel", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<rotation angle\>\"", ",", "\"\<\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<24-hr time\>\"", ",", "processedNameStr"}], "}"}]}], 
     "}"}]}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.643100533182523*^9, 3.6431005975762787`*^9}, {
   3.643100637152915*^9, 3.643100730965362*^9}, {3.6431017200209427`*^9, 
   3.6431020368725452`*^9}, {3.643102139030726*^9, 3.643102147683496*^9}, {
   3.6431021779267473`*^9, 3.643102190929871*^9}, {3.643102231412622*^9, 
   3.643102243550509*^9}, {3.6431022956631527`*^9, 3.6431023876870832`*^9}, {
   3.6431899689560223`*^9, 3.643189970705975*^9}, {3.643190067585269*^9, 
   3.643190139906577*^9}, {3.643190213805756*^9, 3.643190237557234*^9}, {
   3.643190270803586*^9, 3.643190273603195*^9}, 3.643190311941759*^9, {
   3.6432206496423903`*^9, 3.643220649813493*^9}, {3.643221874844427*^9, 
   3.643221875445252*^9}, {3.6432325505994787`*^9, 3.64323255092253*^9}, 
   3.643236016761063*^9, {3.643310359180149*^9, 3.6433103597439957`*^9}, 
   3.643373018476205*^9, {3.647372130937796*^9, 3.647372195488682*^9}, {
   3.647372225547368*^9, 3.647372244081455*^9}, 3.647372344730658*^9, {
   3.647372505283555*^9, 3.647372532751726*^9}, {3.647372606296014*^9, 
   3.6473726314311666`*^9}, 3.6473727359041147`*^9, {3.647372811808443*^9, 
   3.6473728131990356`*^9}, {3.647381372957656*^9, 3.6473813745347652`*^9}, {
   3.6473814080060043`*^9, 3.6473814232866488`*^9}, {3.647381922794483*^9, 
   3.6473819316155252`*^9}, {3.6473819808480453`*^9, 3.647382017895063*^9}, {
   3.6473824555916767`*^9, 3.6473824869516153`*^9}, {3.647382672050212*^9, 
   3.6473826790887613`*^9}, {3.647382748579031*^9, 3.647382752178465*^9}, {
   3.647421469732255*^9, 3.64742147033597*^9}, {3.647467672977437*^9, 
   3.647467704389545*^9}, {3.6474677567441463`*^9, 3.647467784934381*^9}, 
   3.6474679504036922`*^9, {3.6474679914019012`*^9, 3.6474679976735353`*^9}, {
   3.6484016955680313`*^9, 3.648401701551743*^9}, {3.648401736089126*^9, 
   3.6484017611780233`*^9}, {3.648401791740177*^9, 3.6484017988024387`*^9}, {
   3.648403138694645*^9, 3.6484031436512947`*^9}, {3.6484034886363564`*^9, 
   3.648403500987612*^9}, {3.648403953380753*^9, 3.648403983642734*^9}, {
   3.648404172635792*^9, 3.6484041919462433`*^9}, {3.64840437861255*^9, 
   3.648404388652398*^9}, {3.671477192956593*^9, 3.671477214508544*^9}, {
   3.671477289109103*^9, 3.671477294131733*^9}, 3.6714773443797417`*^9, {
   3.671477378159079*^9, 3.671477400172552*^9}, {3.671477433463931*^9, 
   3.671477444078993*^9}, {3.671477572044581*^9, 3.67147759258683*^9}, 
   3.67147795026322*^9, 3.671477981140579*^9, {3.671478058681666*^9, 
   3.67147805936099*^9}, {3.6714785409331408`*^9, 3.6714786969127703`*^9}, {
   3.671530480830071*^9, 3.671530489840425*^9}, 3.671530574745368*^9, {
   3.671701644946764*^9, 3.67170167157578*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["4- DumpSave", "Subsection",
 CellChangeTimes->{{3.671211179812208*^9, 3.671211200099522*^9}, {
   3.671211329699849*^9, 3.671211387716975*^9}, 3.6712140481610613`*^9, {
   3.6714648208218184`*^9, 3.671464821195808*^9}, 3.671465890939961*^9, {
   3.6714754450160637`*^9, 3.671475459376915*^9}, 3.671476440203496*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"pathRoot", "<>", "\"\<Step4.mx\>\""}], ",", 
    RowBox[{"{", "listTimeAngle", "}"}]}], "]"}], ";"}], "\n", 
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}]}], "Input",
 CellChangeTimes->{{3.670588484992837*^9, 3.67058848499339*^9}, 
   3.6706767423327713`*^9, 3.671475683085507*^9, {3.671476443642498*^9, 
   3.671476464101886*^9}, 3.671478744435066*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Step 5:  Centering", "Section",
 CellChangeTimes->{{3.5033167061859503`*^9, 3.503316719635662*^9}, {
   3.50331674973533*^9, 3.503316754268928*^9}, {3.5033374747215557`*^9, 
   3.503337480080407*^9}, {3.503339142667317*^9, 3.5033391448651657`*^9}, {
   3.504730372452002*^9, 3.504730377984919*^9}, {3.507715381523715*^9, 
   3.507715399273287*^9}, {3.640111094694233*^9, 3.640111100667691*^9}, {
   3.640111518458076*^9, 3.640111535919319*^9}, 3.6402196556029873`*^9, {
   3.640219727445634*^9, 3.640219746025066*^9}, 3.6407127833693037`*^9, {
   3.640877835712092*^9, 3.640877845007203*^9}, 3.640941766414694*^9, 
   3.640956657458598*^9, {3.640964712550826*^9, 3.6409647211418133`*^9}, {
   3.640993195605362*^9, 3.6409932107178183`*^9}, {3.6410545089880657`*^9, 
   3.641054514538434*^9}, {3.641241003572548*^9, 3.641241014771098*^9}, {
   3.6429427969837027`*^9, 3.6429428069906273`*^9}, {3.642993682725779*^9, 
   3.642993698792001*^9}, {3.6429939923302717`*^9, 3.642993999388014*^9}, {
   3.6430171776603317`*^9, 3.6430172028153048`*^9}, {3.643044324488636*^9, 
   3.643044335744014*^9}, {3.643051971438998*^9, 3.643051976686528*^9}, {
   3.643052135903675*^9, 3.643052143558909*^9}, {3.643348365022581*^9, 
   3.643348392942012*^9}, {3.643348473098693*^9, 3.643348486300507*^9}, {
   3.64334856224571*^9, 3.643348574852208*^9}, {3.6475317579170513`*^9, 
   3.6475317855798883`*^9}, {3.6476768069750853`*^9, 3.647676827883218*^9}, 
   3.647762567995881*^9, {3.671479377426199*^9, 3.671479385128364*^9}}],

Cell[BoxData[{
 RowBox[{"pathRoot", " ", "=", " ", 
  "\"\</Volumes/Backup/BunnyData_MeleteMirror/feetdown_Hgrating/\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step1.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step2.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step3.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step4.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"grayScalePlotLimits", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.2"}], ",", "1.0"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.670588405763463*^9, 3.670588405763843*^9}, 
   3.671475324900103*^9, {3.6714754199986277`*^9, 3.6714754232469*^9}, {
   3.6714756289932337`*^9, 3.6714756319936867`*^9}, {3.6714796100538816`*^9, 
   3.671479613030121*^9}, {3.671522218555141*^9, 3.671522234961755*^9}, {
   3.671522298361421*^9, 3.6715223017777843`*^9}}],

Cell[CellGroupData[{

Cell["5-1  Read 0 to 180-\[CapitalDelta]\[Theta] absorption FITS and make \
allSinograms ", "Subsection",
 CellChangeTimes->{{3.4562833726280527`*^9, 3.456283385607916*^9}, {
   3.463555031609515*^9, 3.463555047770688*^9}, 3.463590933610998*^9, 
   3.463591573151423*^9, {3.463681205490497*^9, 3.463681218422361*^9}, {
   3.463723051179096*^9, 3.463723089887204*^9}, {3.463723208493277*^9, 
   3.463723230746255*^9}, {3.558538088340563*^9, 3.558538107308223*^9}, {
   3.559416317605693*^9, 3.559416321556931*^9}, {3.559416735103908*^9, 
   3.559416737301735*^9}, {3.6712340331354647`*^9, 3.671234065158613*^9}, {
   3.671479544314344*^9, 3.671479547960895*^9}, 3.671539341123752*^9, {
   3.671702968266173*^9, 3.671702974494631*^9}, {3.672937032646791*^9, 
   3.672937032782045*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"filenameFITS", " ", "=", " ", 
   RowBox[{"FileNames", "[", 
    RowBox[{"\"\<*_abs_*.fits\>\"", ",", "pathFITS"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", "filenameFITS", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"index0deg", "=", 
   RowBox[{"First", "[", 
    RowBox[{"Flatten", "[", 
     RowBox[{"Position", "[", 
      RowBox[{"listSampleAngles", ",", 
       RowBox[{"p_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", ">=", "0"}], "&"}], ")"}]}]}], "]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"index180deg", "=", 
   RowBox[{"Last", "[", 
    RowBox[{"Flatten", "[", 
     RowBox[{"Position", "[", 
      RowBox[{"listSampleAngles", ",", 
       RowBox[{"p_", "?", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"#", "<=", "180"}], "&"}], ")"}]}]}], "]"}], "]"}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{"listProcessedAngles", " ", "=", " ", 
  RowBox[{"listSampleAngles", "[", 
   RowBox[{"[", 
    RowBox[{"index0deg", ";;", 
     RowBox[{"(", 
      RowBox[{"index180deg", "-", "1"}], ")"}]}], "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{
  3.463723317906293*^9, {3.46372357722439*^9, 3.4637236270473337`*^9}, {
   3.463723764104*^9, 3.4637237916571608`*^9}, {3.558533302223468*^9, 
   3.55853333475248*^9}, 3.55853354513911*^9, {3.558533585388596*^9, 
   3.558533633078586*^9}, {3.558533702674754*^9, 3.5585337214906883`*^9}, {
   3.558533772307551*^9, 3.558533772897843*^9}, {3.558534291390914*^9, 
   3.558534291785593*^9}, {3.55853643267446*^9, 3.5585364362661552`*^9}, {
   3.558536472684112*^9, 3.558536476603812*^9}, {3.558536567667124*^9, 
   3.5585365708990383`*^9}, 3.569097153381545*^9, {3.671234051653967*^9, 
   3.671234085187051*^9}, {3.671234134072135*^9, 3.6712341350399647`*^9}, {
   3.6712342639354258`*^9, 3.671234301700996*^9}, {3.671234467337297*^9, 
   3.671234468454912*^9}, {3.671234696087525*^9, 3.671234696438366*^9}, {
   3.6714795846686163`*^9, 3.671479642964539*^9}, {3.6715307086980333`*^9, 
   3.671530709074697*^9}, {3.6717030477291203`*^9, 3.671703096547727*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"absorption", " ", "=", " ", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{
       RowBox[{"filenameFITS", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<RawData\>\""}], " ", "]"}], 
     "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ArrayPlot", "[", "absorption", "]"}], "\[IndentingNewLine]", 
     "imageAbs"}], "=", 
    RowBox[{
     RowBox[{"Image", "[", 
      RowBox[{"absorption", ",", "\"\<Real\>\""}], "]"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Dimensions", "[", "absorption", "]"}], "\[IndentingNewLine]", 
     RowBox[{"ImageDimensions", "[", "imageAbs", "]"}], "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"columns", ",", " ", "rows"}], "}"}], "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"NX", ",", "NY"}], "}"}]}]}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.6715321023467703`*^9, 3.6715321746645184`*^9}, {
   3.671532257843007*^9, 3.6715323084199*^9}, 3.671532449244519*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NX", " ", "=", " ", "columns"}], ";", " ", 
  RowBox[{"NY", " ", "=", " ", "rows"}], ";", "  ", 
  RowBox[{"NZ", " ", "=", " ", 
   RowBox[{"Length", "[", "listProcessedAngles", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allSinograms", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"NY", ",", "NX", ",", "NZ"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{" ", 
  RowBox[{
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"projection", " ", "=", "1"}], ",", 
     RowBox[{"projection", "\[LessEqual]", " ", "NZ"}], ",", 
     RowBox[{"projection", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"absorption", " ", "=", " ", 
       RowBox[{
        RowBox[{"Import", "[", 
         RowBox[{
          RowBox[{"filenameFITS", "[", 
           RowBox[{"[", "projection", "]"}], "]"}], ",", "\"\<RawData\>\""}], 
         " ", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "All", ",", "projection"}], "]"}], "]"}], "=", 
       "absorption"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
   ";"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"ArrayPlot", "[", 
     RowBox[{"allSinograms", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Dimensions", "[", "allSinograms", "]"}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.671234320356866*^9, 3.671234437559785*^9}, 
   3.671234702093828*^9, {3.67127539539709*^9, 3.671275398121792*^9}, {
   3.671285631227914*^9, 3.671285631834198*^9}, {3.6712899470813828`*^9, 
   3.671289949160776*^9}, {3.67147999385218*^9, 3.671480009005323*^9}, {
   3.6715212553046923`*^9, 3.671521286907638*^9}, 3.671521326928138*^9, 
   3.671522163186064*^9, {3.671532457335835*^9, 3.6715324613337593`*^9}, {
   3.671533179042924*^9, 3.671533189255734*^9}, {3.671703169656095*^9, 
   3.6717031726397343`*^9}, {3.671703530142105*^9, 3.6717035306488447`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"indexSlice", " ", "=", " ", 
   RowBox[{"Round", "[", 
    RowBox[{"0.5", "*", "rows"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gSino", "=", 
   RowBox[{"ArrayPlot", "[", " ", 
    RowBox[{
     RowBox[{"allSinograms", "[", 
      RowBox[{"[", 
       RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}], ",", " ",
      "\[IndentingNewLine]", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"All", ",", "All", ",", "grayScalePlotLimits"}], "}"}]}], ",", 
     
     RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], ",", 
     RowBox[{"ClippingStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Black", ",", "White"}], "}"}]}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<\[Theta], degrees\>\"", ",", 
          RowBox[{"\"\<slice = \>\"", "<>", 
           RowBox[{"ToString", "[", "indexSlice", "]"}]}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<columns\>\"", ",", "\"\<\>\""}], "}"}]}], "}"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"PlotLegends", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Placed", "[", 
        RowBox[{
         RowBox[{"BarLegend", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\"\<TemperatureMap\>\"", ",", "grayScalePlotLimits"}], 
            "}"}], ",", 
           RowBox[{"LegendMarkerSize", "\[Rule]", "200"}]}], "]"}], ",", 
         "Right"}], "]"}], "}"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lineProbe", " ", "=", 
   RowBox[{"allSinograms", "[", 
    RowBox[{"[", 
     RowBox[{"indexSlice", ",", 
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.1", ",", "0.5"}], "}"}], "*", "columns"}], "]"}], ",", 
      "All"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gLineProbe", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{"lineProbe", ",", " ", 
     RowBox[{"PlotRange", "\[Rule]", "grayScalePlotLimits"}], ",", " ", 
     RowBox[{"AxesOrigin", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<attenuation\>\"", ",", "\"\<\>\""}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<\[Theta], degrees\>\"", ",", 
          RowBox[{"\"\<columns \>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0.1", ",", "0.5"}], "}"}], "*", "columns"}], "]"}], 
            "]"}]}]}], "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"GridLines", "\[Rule]", "Automatic"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"gSino", ",", "gLineProbe"}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "700"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.459280374557766*^9, 3.459280410884424*^9}, {
   3.459280675395046*^9, 3.459280743320352*^9}, {3.459284168661813*^9, 
   3.459284195262405*^9}, {3.459284246841783*^9, 3.459284259639557*^9}, {
   3.459284329263711*^9, 3.459284332742413*^9}, {3.463723883550887*^9, 
   3.463723897895046*^9}, {3.463735054620751*^9, 3.4637350548186007`*^9}, {
   3.558534371026425*^9, 3.558534435980426*^9}, {3.558535891417568*^9, 
   3.5585359287133904`*^9}, 3.5585360029037037`*^9, {3.5585360373184843`*^9, 
   3.558536100648546*^9}, {3.558536132002379*^9, 3.558536270464951*^9}, {
   3.558536344445058*^9, 3.558536374309331*^9}, {3.5585371638772993`*^9, 
   3.558537192658821*^9}, {3.67128606695238*^9, 3.6712862223905163`*^9}, {
   3.671286269838119*^9, 3.671286415363947*^9}, {3.6712864494529037`*^9, 
   3.6712864544230833`*^9}, {3.6712865664956284`*^9, 
   3.6712865953888597`*^9}, {3.671522194739538*^9, 3.671522209427513*^9}, {
   3.671522339636335*^9, 3.671522357123097*^9}, {3.671522387795903*^9, 
   3.67152239835224*^9}, {3.6715224283914423`*^9, 3.6715224324488583`*^9}, 
   3.671530729813787*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["5.b. Find best center of rotation", "Subsection",
 CellChangeTimes->{{3.4562833726280527`*^9, 3.456283385607916*^9}, {
   3.463555031609515*^9, 3.463555047770688*^9}, 3.463590933610998*^9, 
   3.463591573151423*^9, {3.463681205490497*^9, 3.463681218422361*^9}, {
   3.463723051179096*^9, 3.463723089887204*^9}, {3.463723208493277*^9, 
   3.463723230746255*^9}, {3.558538088340563*^9, 3.558538132773198*^9}, {
   3.558539022074757*^9, 3.5585390331694403`*^9}, {3.558539974016464*^9, 
   3.558539982679241*^9}, {3.559416785274221*^9, 3.5594167877756977`*^9}, {
   3.6712905416584177`*^9, 3.671290542262269*^9}, {3.67129057424026*^9, 
   3.671290575712109*^9}, 3.671293124532455*^9, 3.6715393423136873`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"absorption0Deg", " ", "=", " ", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"Image", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Import", "[", 
        RowBox[{
         RowBox[{"filenameFITS", "[", 
          RowBox[{"[", "index0deg", "]"}], "]"}], ",", "\"\<RawData\>\""}], 
        " ", "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<Real\>\""}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"absorption180Deg", " ", "=", " ", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"Image", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Import", "[", 
        RowBox[{
         RowBox[{"filenameFITS", "[", 
          RowBox[{"[", "index180deg", "]"}], "]"}], ",", "\"\<RawData\>\""}], 
        " ", "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<Real\>\""}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"transformationFunction", " ", "=", " ", 
  RowBox[{"FindGeometricTransform", "[", 
   RowBox[{"absorption0Deg", ",", 
    RowBox[{"ImageReflect", "[", 
     RowBox[{"absorption180Deg", ",", 
      RowBox[{"Left", "\[Rule]", "Right"}]}], "]"}], ",", 
    RowBox[{"TransformationClass", "\[Rule]", "\"\<Translation\>\""}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"estimatedCenteringShift", " ", "=", " ", 
  RowBox[{"Round", "[", 
   RowBox[{
    RowBox[{"transformationFunction", "[", 
     RowBox[{"[", 
      RowBox[{"2", ",", "1", ",", "1", ",", "3"}], "]"}], "]"}], "/", "2"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.671287819436809*^9, 3.6712879577225924`*^9}, {
  3.671289760376684*^9, 3.671289773580069*^9}, {3.671290674671102*^9, 
  3.67129068589456*^9}, {3.6715306517438517`*^9, 3.671530659610313*^9}, {
  3.6715307498129587`*^9, 3.67153078216852*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"sinogram", "=", " ", 
    RowBox[{"allSinograms", "[", 
     RowBox[{"[", 
      RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gCenteringTest", " ", "=", " ", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"imageSlice", " ", "=", " ", 
         RowBox[{"InverseRadon", "[", 
          RowBox[{"Image", "[", 
           RowBox[{
            RowBox[{"funcShiftSinogram", "[", 
             RowBox[{"sinogram", ",", "shift", ",", "NX", ",", "NZ"}], "]"}], 
            ",", "\"\<Real\>\""}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"g1", "  ", "=", " ", 
         RowBox[{"ImageAdjust", "[", " ", 
          RowBox[{"ImageResize", "[", 
           RowBox[{"imageSlice", ",", "400"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Show", "[", 
         RowBox[{"g1", ",", 
          RowBox[{"Epilog", "\[Rule]", 
           RowBox[{"Inset", "[", 
            RowBox[{
             RowBox[{"Text", "[", 
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"\"\<shift = \>\"", "<>", 
                 RowBox[{"ToString", "[", "shift", "]"}]}], ",", "20", ",", 
                RowBox[{"Background", "\[Rule]", "White"}]}], "]"}], "]"}], 
             ",", 
             RowBox[{"Scaled", "[", 
              RowBox[{"{", 
               RowBox[{"0.8", ",", "0.8"}], "}"}], "]"}]}], "]"}]}]}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"shift", ",", 
       RowBox[{"estimatedCenteringShift", "+", 
        RowBox[{"Range", "[", 
         RowBox[{
          RowBox[{"-", "1"}], ",", "1", ",", "1"}], "]"}]}]}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsColumn", "[", "gCenteringTest", "]"}]}], "Input",
 CellChangeTimes->{{3.6712900756971827`*^9, 3.671290087168082*^9}, {
  3.671290155194151*^9, 3.67129019050135*^9}, {3.671290227225786*^9, 
  3.671290249412715*^9}, {3.671290302758904*^9, 3.671290307043273*^9}, {
  3.6712906239838533`*^9, 3.6712906303159323`*^9}, {3.6712907057236567`*^9, 
  3.671290728275056*^9}, {3.671530894180642*^9, 3.671530969398788*^9}, {
  3.671531973620804*^9, 3.6715319953804607`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["5.c  Shift all sinograms and plot a few reconstructions", "Subsection",
 CellChangeTimes->{{3.4562833726280527`*^9, 3.456283385607916*^9}, {
   3.463555031609515*^9, 3.463555047770688*^9}, 3.463590933610998*^9, 
   3.463591573151423*^9, {3.463681205490497*^9, 3.463681218422361*^9}, {
   3.463723051179096*^9, 3.463723089887204*^9}, {3.463723208493277*^9, 
   3.463723230746255*^9}, {3.558538088340563*^9, 3.558538132773198*^9}, {
   3.558539022074757*^9, 3.5585390331694403`*^9}, {3.558539215068102*^9, 
   3.558539227817025*^9}, {3.5594168311336393`*^9, 3.5594168404577312`*^9}, {
   3.671290589361055*^9, 3.6712905899849977`*^9}, {3.671291698190036*^9, 
   3.671291698753819*^9}, {3.671291737430192*^9, 3.671291746540285*^9}, 
   3.671539343929769*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bestShift", " ", "=", "estimatedCenteringShift"}], ";"}]], "Input",\

 CellChangeTimes->{{3.671291088852418*^9, 3.671291092523012*^9}, 
   3.671291702410961*^9}],

Cell[BoxData[{
 RowBox[{"Dimensions", "[", "allSinograms", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"indexSlice", " ", "=", "1"}], ",", " ", 
    RowBox[{"indexSlice", "\[LessEqual]", "NY"}], ",", 
    RowBox[{"indexSlice", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sinogram", "=", " ", 
      RowBox[{"allSinograms", "[", 
       RowBox[{"[", 
        RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sinogram", " ", "=", 
      RowBox[{"funcShiftSinogram", "[", 
       RowBox[{"sinogram", ",", "bestShift", " ", ",", "NX", ",", "NZ"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"allSinograms", "[", 
       RowBox[{"[", 
        RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}], "=", 
      "sinogram"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.671291017089218*^9, 3.671291041880803*^9}, {
   3.671532054128463*^9, 3.671532054606798*^9}, {3.6715334016773*^9, 
   3.671533401916884*^9}, 3.6715335247613087`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gSeveralSlices", "=", " ", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sinogram", "=", " ", 
         RowBox[{"allSinograms", "[", 
          RowBox[{"[", 
           RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"sinogram", "=", 
         RowBox[{"funcStreakRemovalFFT", "[", 
          RowBox[{"sinogram", ",", "0.5"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"sinogram", "=", " ", 
           RowBox[{"funcUseAirRegionForOffsetSinogram", "[", 
            RowBox[{"sinogram", ",", "2"}], "]"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"imageSlice", " ", "=", " ", 
         RowBox[{"InverseRadon", "[", 
          RowBox[{"Image", "[", 
           RowBox[{"sinogram", ",", "\"\<Real\>\""}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"g1", "  ", "=", " ", 
         RowBox[{"ImageAdjust", "[", " ", 
          RowBox[{"ImageResize", "[", 
           RowBox[{"imageSlice", ",", "400"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Show", "[", 
         RowBox[{"g1", ",", 
          RowBox[{"Epilog", "\[Rule]", 
           RowBox[{"Inset", "[", 
            RowBox[{
             RowBox[{"Text", "[", 
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"\"\<slice = \>\"", "<>", 
                 RowBox[{"ToString", "[", "indexSlice", "]"}]}], ",", "20", 
                ",", 
                RowBox[{"Background", "\[Rule]", "White"}]}], "]"}], "]"}], 
             ",", 
             RowBox[{"Scaled", "[", 
              RowBox[{"{", 
               RowBox[{"0.8", ",", "0.8"}], "}"}], "]"}]}], "]"}]}]}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"indexSlice", ",", 
       RowBox[{"Range", "[", 
        RowBox[{"20", ",", "NY", ",", "50"}], "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsColumn", "[", "gSeveralSlices", "]"}]}], "Input",
 CellChangeTimes->{{3.6712911327431927`*^9, 3.671291203057275*^9}, {
   3.6712912652652483`*^9, 3.671291277840612*^9}, {3.671291804786152*^9, 
   3.671291805248163*^9}, {3.671293782878566*^9, 3.6712937829412727`*^9}, {
   3.671533419495738*^9, 3.671533419758183*^9}, {3.671533468563278*^9, 
   3.67153347126504*^9}, {3.671533528149605*^9, 3.671533529741778*^9}, 
   3.671533573333148*^9, 3.6715336121166077`*^9, {3.671533644425544*^9, 
   3.6715337073840733`*^9}, {3.67153375025021*^9, 3.671533750399604*^9}, 
   3.671534168679303*^9, {3.671537729436245*^9, 3.671537764073319*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["5- DumpSave", "Subsection",
 CellChangeTimes->{{3.671211179812208*^9, 3.671211200099522*^9}, {
   3.671211329699849*^9, 3.671211387716975*^9}, 3.6712140481610613`*^9, {
   3.6714648208218184`*^9, 3.671464821195808*^9}, 3.671465890939961*^9, {
   3.6714754450160637`*^9, 3.671475459376915*^9}, 3.671476440203496*^9, 
   3.6715393460580378`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"pathRoot", "<>", "\"\<Step5.mx\>\""}], ",", 
    RowBox[{"{", 
     RowBox[{
     "bestShift", ",", "estimatedCenteringShift", ",", "grayScalePlotLimits", 
      ",", "listProcessedAngles"}], "}"}]}], "]"}], ";"}], "\n", 
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}]}], "Input",
 CellChangeTimes->{{3.670588484992837*^9, 3.67058848499339*^9}, 
   3.6706767423327713`*^9, 3.671475683085507*^9, {3.671476443642498*^9, 
   3.671476464101886*^9}, 3.671478744435066*^9, {3.6715393491548777`*^9, 
   3.671539379293611*^9}, {3.6717031154877567`*^9, 3.671703116090396*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Step 6:  Make sinograms for Mathematica InverseRadon", "Section",
 CellChangeTimes->{{3.5033167061859503`*^9, 3.503316719635662*^9}, {
   3.50331674973533*^9, 3.503316754268928*^9}, {3.5033374747215557`*^9, 
   3.503337480080407*^9}, {3.503339142667317*^9, 3.5033391448651657`*^9}, {
   3.504730372452002*^9, 3.504730377984919*^9}, {3.507715381523715*^9, 
   3.507715399273287*^9}, {3.640111094694233*^9, 3.640111100667691*^9}, {
   3.640111518458076*^9, 3.640111535919319*^9}, 3.6402196556029873`*^9, {
   3.640219727445634*^9, 3.640219746025066*^9}, 3.6407127833693037`*^9, {
   3.640877835712092*^9, 3.640877845007203*^9}, 3.640941766414694*^9, 
   3.640956657458598*^9, {3.640964712550826*^9, 3.6409647211418133`*^9}, {
   3.640993195605362*^9, 3.6409932107178183`*^9}, {3.6410545089880657`*^9, 
   3.641054514538434*^9}, {3.641241003572548*^9, 3.641241014771098*^9}, {
   3.6429427969837027`*^9, 3.6429428069906273`*^9}, {3.642993682725779*^9, 
   3.642993698792001*^9}, {3.6429939923302717`*^9, 3.642993999388014*^9}, {
   3.6430171776603317`*^9, 3.6430172028153048`*^9}, {3.643044324488636*^9, 
   3.643044335744014*^9}, {3.643051971438998*^9, 3.643051976686528*^9}, {
   3.643052135903675*^9, 3.643052143558909*^9}, {3.643348365022581*^9, 
   3.643348392942012*^9}, {3.643348473098693*^9, 3.643348486300507*^9}, {
   3.64334856224571*^9, 3.643348574852208*^9}, {3.6475317579170513`*^9, 
   3.6475317855798883`*^9}, {3.6476768069750853`*^9, 3.647676827883218*^9}, 
   3.647762567995881*^9, {3.673799920161532*^9, 3.673799926223048*^9}}],

Cell[BoxData[{
 RowBox[{"pathRoot", " ", "=", " ", 
  "\"\</Volumes/Backup/BunnyData_MeleteMirror/feetdown_Hgrating/\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step1.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step2.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step3.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step4.mx\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"pathRoot", "<>", "\"\<Step5.mx\>\""}], "]"}]}], "Input",
 CellChangeTimes->{{3.671539394838141*^9, 3.671539398286655*^9}}],

Cell[CellGroupData[{

Cell["\<\
6-1 Read 0 to 180-\[CapitalDelta]\[Theta] absorption HDF5 and make \
allSinograms ; save *.bin \
\>", "Subsection",
 CellChangeTimes->{{3.4562833726280527`*^9, 3.456283385607916*^9}, {
   3.463555031609515*^9, 3.463555047770688*^9}, 3.463590933610998*^9, 
   3.463591573151423*^9, {3.463681205490497*^9, 3.463681218422361*^9}, {
   3.463723051179096*^9, 3.463723089887204*^9}, {3.463723208493277*^9, 
   3.463723230746255*^9}, {3.558538088340563*^9, 3.558538107308223*^9}, {
   3.559416317605693*^9, 3.559416321556931*^9}, {3.559416735103908*^9, 
   3.559416737301735*^9}, {3.575991868795988*^9, 3.5759918820811043`*^9}, {
   3.57712699811884*^9, 3.5771270074441013`*^9}, {3.5771271918954277`*^9, 
   3.5771271942145157`*^9}, 3.581180298038879*^9, 3.5811806549012957`*^9, 
   3.609715371231148*^9, 3.623084762335394*^9, {3.6231516500408773`*^9, 
   3.6231516524009857`*^9}, {3.647532322947112*^9, 3.647532347043497*^9}, {
   3.647639626567724*^9, 3.647639631641411*^9}, {3.6717032734776773`*^9, 
   3.671703295583366*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"filenamesProjection", " ", "=", " ", 
   RowBox[{"FileNames", "[", 
    RowBox[{
     RowBox[{"processedNameStr", "<>", "\"\<*.h5\>\""}], ",", "pathHDF5"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenamesProjection", " ", "=", 
   RowBox[{"Take", "[", 
    RowBox[{"filenamesProjection", " ", ",", 
     RowBox[{"Length", "[", "listProcessedAngles", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", "filenamesProjection", "]"}]}], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"firstDataAbsorption", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"filename", ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Datasets\>\"", ",", "\"\</absorption\>\""}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"numberSlices", ",", "numberColumns"}], "}"}], "=", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"NY", ",", "NX"}], "}"}], "=", 
   RowBox[{
   "Dimensions", "[", "firstDataAbsorption", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"NZ", " ", "=", " ", 
  RowBox[{"numberOfAngles", " ", "=", 
   RowBox[{
   "Length", "[", "listProcessedAngles", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"incrementAngle", " ", "=", " ", 
  RowBox[{
   RowBox[{"listProcessedAngles", "[", 
    RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", 
   RowBox[{"listProcessedAngles", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{{3.671703406100354*^9, 3.671703470578327*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"allSinograms", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"NY", ",", "NX", ",", "NZ"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Dimensions", "[", "allSinograms", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"MemoryInUse", "[", "]"}]}], "Input",
 CellChangeTimes->{{3.575900135907248*^9, 3.5759001691422663`*^9}, 
   3.575900624643045*^9, {3.575909319208671*^9, 3.575909319383954*^9}, {
   3.575910113669928*^9, 3.575910114260828*^9}, {3.575916517134323*^9, 
   3.5759165177572193`*^9}, {3.5759167364290867`*^9, 3.57591675400539*^9}, {
   3.581176092544074*^9, 3.5811760930146914`*^9}, {3.581176156658477*^9, 
   3.581176157010355*^9}, {3.58117700949398*^9, 3.581177013331911*^9}, {
   3.581178397781701*^9, 3.581178404664132*^9}, 3.581183903562525*^9, 
   3.5811841959202223`*^9, 3.6097142171621447`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"t0", "=", 
   RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"For", "[", 
   RowBox[{
    RowBox[{"indexProjection", " ", "=", "1"}], ",", 
    RowBox[{"indexProjection", "\[LessEqual]", " ", "NZ"}], ",", 
    RowBox[{"indexProjection", "++"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filename", " ", "=", " ", 
      RowBox[{"filenamesProjection", "[", 
       RowBox[{"[", "indexProjection", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"dataAbsorption", "=", 
      RowBox[{"Import", "[", 
       RowBox[{"filename", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<Datasets\>\"", ",", "\"\</absorption\>\""}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"angle", "=", 
      RowBox[{"ToExpression", "[", 
       RowBox[{"Last", "[", 
        RowBox[{"StringSplit", "[", 
         RowBox[{
          RowBox[{"Last", "[", 
           RowBox[{"FileNameSplit", "[", "filename", " ", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"\"\<_\>\"", ",", "\"\<.h5\>\""}], "}"}]}], "]"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"allSinograms", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", " ", "All", ",", " ", "indexProjection"}], "]"}], 
       "]"}], " ", "=", "  ", "dataAbsorption"}], ";"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Print", "[", 
      RowBox[{"{", 
       RowBox[{"indexProjection", ",", " ", "angle", ",", " ", 
        RowBox[{"filenamesProjection", "[", 
         RowBox[{"[", "indexProjection", "]"}], "]"}]}], "}"}], "]"}], ";"}], 
    " ", "*)"}], "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Dimensions", "[", "allSinograms", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"filename", " ", "=", " ", 
  RowBox[{
  "pathSino", "<>", "processedNameStr", "<>", 
   "\"\<_sino_all_temp.bin\>\""}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fid", " ", "=", " ", 
   RowBox[{"OpenWrite", "[", 
    RowBox[{"filename", ",", 
     RowBox[{"BinaryFormat", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BinaryWrite", "[", 
   RowBox[{"fid", ",", "allSinograms", ",", "\"\<Real32\>\"", ",", 
    RowBox[{"ByteOrdering", "\[Rule]", 
     RowBox[{"-", "1"}]}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Close", "[", "fid", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"t1", "=", 
   RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"DateDifference", "[", 
  RowBox[{"t0", ",", "t1", ",", "\"\<Minute\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "allSinograms", "]"}]}], "Input",
 CellChangeTimes->{{3.609714718329608*^9, 3.609714721679418*^9}, {
   3.6097148570733433`*^9, 3.609714858467401*^9}, {3.6097150525092487`*^9, 
   3.609715063363427*^9}, {3.616164312205102*^9, 3.616164316413302*^9}, {
   3.623085055286746*^9, 3.623085110555254*^9}, {3.62308519825554*^9, 
   3.623085225720808*^9}, 3.6476156995414143`*^9, {3.647669361412992*^9, 
   3.6476693938137503`*^9}, 3.647676729253763*^9, 3.6717009033332577`*^9, 
   3.6717035675313*^9}],

Cell[BoxData[{
 RowBox[{"filename", " ", "=", " ", 
  RowBox[{
  "pathSino", "<>", "processedNameStr", "<>", 
   "\"\<_sino_all_temp.bin\>\""}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allSinograms", "=", 
   RowBox[{"BinaryReadList", "[", 
    RowBox[{"filename", ",", "\"\<Real32\>\"", ",", 
     RowBox[{"ByteOrdering", "\[Rule]", 
      RowBox[{"-", "1"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "allSinograms", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allSinograms", "=", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"Partition", "[", 
      RowBox[{"allSinograms", ",", "NZ"}], "]"}], ",", "NX"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "allSinograms", "]"}]}], "Input",
 CellChangeTimes->{
  3.623085383148486*^9, {3.623085414342884*^9, 3.623085415905587*^9}, {
   3.64766939935254*^9, 3.647669399799347*^9}, 3.647676744243958*^9, 
   3.6717009041832323`*^9, 3.671703575107147*^9}],

Cell[BoxData[{
 RowBox[{"{", 
  RowBox[{
   RowBox[{"Min", "[", 
    RowBox[{"allSinograms", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"Round", "[", 
        RowBox[{"NY", "/", "2"}], "]"}], ",", "All", ",", "All"}], "]"}], 
     "]"}], "]"}], ",", 
   RowBox[{"Max", "[", 
    RowBox[{"allSinograms", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"Round", "[", 
        RowBox[{"NY", "/", "2"}], "]"}], ",", "All", ",", "All"}], "]"}], 
     "]"}], "]"}]}], "}"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sinogram", " ", "=", " ", 
   RowBox[{"allSinograms", "[", 
    RowBox[{"[", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{"NY", "/", "2"}], "]"}], ",", "All", ",", "All"}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"indexSlice", " ", "=", " ", 
   RowBox[{"Round", "[", 
    RowBox[{"0.5", "*", "rows"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lineProbe", " ", "=", 
   RowBox[{"allSinograms", "[", 
    RowBox[{"[", 
     RowBox[{"indexSlice", ",", 
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0.1", ",", "0.5"}], "}"}], "*", "columns"}], "]"}], ",", 
      "All"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gSino", "=", 
   RowBox[{"ArrayPlot", "[", " ", 
    RowBox[{"sinogram", ",", " ", "\[IndentingNewLine]", 
     RowBox[{"PlotRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"All", ",", "All", ",", "climAbs"}], "}"}]}], ",", 
     RowBox[{"ColorFunction", "\[Rule]", "\"\<GrayTones\>\""}], ",", 
     RowBox[{"ClippingStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Black", ",", "White"}], "}"}]}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
     RowBox[{"FrameTicks", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Automatic", ",", "None"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"Automatic", ",", "None"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<angle/deg\>\"", ",", "processedNameStr"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<rays (NY)\>\"", ",", "\"\<\>\""}], "}"}]}], "}"}]}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"DataRange", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Min", "[", "listProcessedAngles", "]"}], ",", 
          RowBox[{"Max", "[", "listProcessedAngles", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "NY"}], "}"}]}], "}"}]}], ",", 
     RowBox[{"PlotLegends", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"Placed", "[", 
        RowBox[{
         RowBox[{"BarLegend", "[", 
          RowBox[{"{", 
           RowBox[{"\"\<GrayTones\>\"", ",", "climAbs"}], "}"}], "]"}], ",", 
         "Right"}], "]"}], "}"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gLineProbe", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"listProcessedAngles", ",", 
          RowBox[{"lineProbe", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"listProcessedAngles", ",", 
          RowBox[{"lineProbe", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], ",", " ", 
     
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
     RowBox[{"AxesOrigin", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}]}], ",", 
     RowBox[{"PlotMarkers", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<o\>\"", ",", "\"\<x\>\""}], "}"}]}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<absorption\>\"", ",", "\"\<\>\""}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<angle/deg\>\"", ",", "processedNameStr"}], "}"}]}], 
       "}"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "300"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Grid", "[", 
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{"gSino", ",", "gLineProbe"}], "}"}], "}"}], "]"}]}], "Input",
 CellChangeTimes->{{3.459280374557766*^9, 3.459280410884424*^9}, {
   3.459280675395046*^9, 3.459280743320352*^9}, {3.459284168661813*^9, 
   3.459284195262405*^9}, {3.459284246841783*^9, 3.459284259639557*^9}, {
   3.459284329263711*^9, 3.459284332742413*^9}, {3.463723883550887*^9, 
   3.463723897895046*^9}, {3.463735054620751*^9, 3.4637350548186007`*^9}, {
   3.558534371026425*^9, 3.558534435980426*^9}, {3.558535891417568*^9, 
   3.5585359287133904`*^9}, 3.5585360029037037`*^9, {3.5585360373184843`*^9, 
   3.558536100648546*^9}, {3.558536132002379*^9, 3.558536270464951*^9}, {
   3.558536344445058*^9, 3.558536374309331*^9}, {3.5585371638772993`*^9, 
   3.558537192658821*^9}, 3.575910231710003*^9, 3.575916778749722*^9, {
   3.575917171375976*^9, 3.5759171857549067`*^9}, {3.57591724577223*^9, 
   3.575917258188506*^9}, {3.5759699509330673`*^9, 3.5759699521494217`*^9}, {
   3.577530259515296*^9, 3.5775302634272633`*^9}, {3.577530537949098*^9, 
   3.577530538939662*^9}, {3.609715303129408*^9, 3.609715303945096*^9}, {
   3.616164129257743*^9, 3.6161641297062683`*^9}, {3.616164212094927*^9, 
   3.616164212544297*^9}, {3.623085457678581*^9, 3.623085490998138*^9}, 
   3.647615948257091*^9, {3.64761602647022*^9, 3.647616031686049*^9}, {
   3.64762297392192*^9, 3.647623011534927*^9}, {3.647623537424407*^9, 
   3.6476235551413393`*^9}, {3.64762383203398*^9, 3.64762383933674*^9}, {
   3.647624133635519*^9, 3.647624134690086*^9}, {3.647624582940682*^9, 
   3.647624600713368*^9}, {3.647624635361794*^9, 3.647624670576129*^9}, {
   3.647629620299906*^9, 3.647629662564386*^9}, {3.6717009055628357`*^9, 
   3.671700906939329*^9}, 3.671703614848072*^9, {3.6717038413636017`*^9, 
   3.6717039135754213`*^9}}]
}, Open  ]],

Cell["Got to here Sunday AM (8 May).  Les", "Subsection",
 CellChangeTimes->{{3.4562833726280527`*^9, 3.456283385607916*^9}, {
   3.463555031609515*^9, 3.463555047770688*^9}, 3.463590933610998*^9, 
   3.463591573151423*^9, {3.463681205490497*^9, 3.463681218422361*^9}, {
   3.463723051179096*^9, 3.463723089887204*^9}, {3.463723208493277*^9, 
   3.463723230746255*^9}, {3.558538088340563*^9, 3.558538132773198*^9}, {
   3.558539022074757*^9, 3.5585390331694403`*^9}, {3.558539215068102*^9, 
   3.558539227817025*^9}, {3.5594168311336393`*^9, 3.5594168404577312`*^9}, {
   3.5811814038935738`*^9, 3.581181422068521*^9}, {3.5827330616584597`*^9, 
   3.582733070657469*^9}, {3.623151568193277*^9, 3.623151633528089*^9}, {
   3.62318246064427*^9, 3.623182463691791*^9}, {3.624905709698699*^9, 
   3.624905717479862*^9}, {3.6308681325335093`*^9, 3.630868136771448*^9}, {
   3.63087618890051*^9, 3.630876200192727*^9}, {3.63103816563335*^9, 
   3.6310381779200687`*^9}, {3.631038249124552*^9, 3.6310382543869247`*^9}, {
   3.6310392326400957`*^9, 3.631039233462412*^9}, {3.631045150799144*^9, 
   3.6310451516535397`*^9}, {3.631085845384988*^9, 3.631085853921031*^9}, {
   3.6310907338762817`*^9, 3.631090734953877*^9}, {3.631091891412485*^9, 
   3.631091897214678*^9}, {3.6310927986823597`*^9, 3.6310927993965683`*^9}, {
   3.631092873302371*^9, 3.6310928793759613`*^9}, {3.631093708230545*^9, 
   3.6310937141613827`*^9}, {3.631276392463382*^9, 3.631276395145904*^9}, {
   3.647641743216364*^9, 3.647641759708383*^9}, {3.64764184294744*^9, 
   3.6476418484701366`*^9}, {3.64766966229574*^9, 3.647669663481051*^9}, {
   3.647675038216468*^9, 3.647675069318674*^9}, 3.647676110962188*^9, {
   3.671704548054632*^9, 3.671704561418889*^9}}],

Cell[CellGroupData[{

Cell["\<\
Step 6.4  Absorption: shift the sinograms, and save as bin and HDF5.  
With larger field of view, remove streaks, apply air offset, \
\>", "Subsection",
 CellChangeTimes->{{3.4562833726280527`*^9, 3.456283385607916*^9}, {
   3.463555031609515*^9, 3.463555047770688*^9}, 3.463590933610998*^9, 
   3.463591573151423*^9, {3.463681205490497*^9, 3.463681218422361*^9}, {
   3.463723051179096*^9, 3.463723089887204*^9}, {3.463723208493277*^9, 
   3.463723230746255*^9}, {3.558538088340563*^9, 3.558538132773198*^9}, {
   3.558539022074757*^9, 3.5585390331694403`*^9}, {3.558539215068102*^9, 
   3.558539227817025*^9}, {3.5594168311336393`*^9, 3.5594168404577312`*^9}, {
   3.5811814038935738`*^9, 3.581181422068521*^9}, {3.5827330616584597`*^9, 
   3.582733070657469*^9}, {3.623151568193277*^9, 3.623151633528089*^9}, {
   3.62318246064427*^9, 3.623182463691791*^9}, {3.624905709698699*^9, 
   3.624905717479862*^9}, {3.6308681325335093`*^9, 3.630868136771448*^9}, {
   3.63087618890051*^9, 3.630876200192727*^9}, {3.63103816563335*^9, 
   3.6310381779200687`*^9}, {3.631038249124552*^9, 3.6310382543869247`*^9}, {
   3.6310392326400957`*^9, 3.631039233462412*^9}, {3.631045150799144*^9, 
   3.6310451516535397`*^9}, {3.631085845384988*^9, 3.631085853921031*^9}, {
   3.6310907338762817`*^9, 3.631090734953877*^9}, {3.631091891412485*^9, 
   3.631091897214678*^9}, {3.6310927986823597`*^9, 3.6310927993965683`*^9}, {
   3.631092873302371*^9, 3.6310928793759613`*^9}, {3.631093708230545*^9, 
   3.6310937141613827`*^9}, {3.631276392463382*^9, 3.631276395145904*^9}, {
   3.647641743216364*^9, 3.647641759708383*^9}, {3.64764184294744*^9, 
   3.6476418484701366`*^9}, {3.64766966229574*^9, 3.647669663481051*^9}, {
   3.647675038216468*^9, 3.647675069318674*^9}, 3.647676110962188*^9}],

Cell[BoxData["listSampleAngles"], "Input",
 CellChangeTimes->{{3.6476790924081087`*^9, 3.647679102630168*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "allSinograms", "]"}]], "Input",
 CellChangeTimes->{{3.576053951854053*^9, 3.576053963589764*^9}, {
  3.647669143749144*^9, 3.647669144037017*^9}, {3.647676123468319*^9, 
  3.647676124147291*^9}}],

Cell[BoxData[{
 RowBox[{"filename", " ", "=", " ", 
  RowBox[{
  "pathSino", "<>", "testNameStr", "<>", 
   "\"\<_sino_all_temp.bin\>\""}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allSinograms", "=", 
   RowBox[{"BinaryReadList", "[", 
    RowBox[{"filename", ",", "\"\<Real32\>\"", ",", 
     RowBox[{"ByteOrdering", "\[Rule]", 
      RowBox[{"-", "1"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "allSinograms", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allSinograms", "=", 
   RowBox[{"Partition", "[", 
    RowBox[{
     RowBox[{"Partition", "[", 
      RowBox[{"allSinograms", ",", "NZ"}], "]"}], ",", "NX"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "allSinograms", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"{", 
   RowBox[{"numberSlices", ",", "numberColumns", ",", "numberOfAngles"}], 
   "}"}], "=", 
  RowBox[{"Dimensions", "[", "allSinograms", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"indexSlice", " ", "=", "1"}], ",", " ", 
     RowBox[{"indexSlice", "\[LessEqual]", "numberSlices"}], ",", 
     RowBox[{"indexSlice", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinogram", "=", " ", 
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"sinogram", "=", 
         RowBox[{"funcUseAirRegionForOffset", "[", 
          RowBox[{"sinogram", ",", "10"}], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"sinogram", "=", 
         RowBox[{"funcStreakRemovalFFT", "[", 
          RowBox[{"sinogram", ",", "0.005"}], "]"}]}], ";"}], "  ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"sinogram", " ", "=", 
       RowBox[{"funcShiftSinogram", "[", 
        RowBox[{
        "sinogram", ",", "bestShift", " ", ",", "newNumberAngles", ",", 
         "newNumberRays"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}], "=", 
       "sinogram"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"filename", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
       "pathSino", "<>", "testNameStr", "<>", "\"\<_sino_all_abs.bin\>\""}], 
       "\[IndentingNewLine]", "fid"}], " ", "=", " ", 
      RowBox[{"OpenWrite", "[", 
       RowBox[{"filename", ",", 
        RowBox[{"BinaryFormat", "\[Rule]", "True"}]}], "]"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"BinaryWrite", "[", 
     RowBox[{"fid", ",", "allSinograms", ",", "\"\<Real32\>\"", ",", 
      RowBox[{"ByteOrdering", "\[Rule]", 
       RowBox[{"-", "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Close", "[", "fid", "]"}], ";"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenameHDF5", " ", "=", 
   RowBox[{
   "pathSino", "<>", "testNameStr", "<>", "\"\<_sino_all_abs.h5\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Export", "[", 
    RowBox[{"filenameHDF5", ",", 
     RowBox[{"{", 
      RowBox[{"allSinograms", ",", 
       RowBox[{"{", "testNameStr", "}"}], ",", 
       RowBox[{"{", "numberSlices", "}"}], ",", 
       RowBox[{"{", "numberColumns", "}"}], ",", 
       RowBox[{"{", "numberOfAngles", "}"}], ",", 
       RowBox[{"{", "gratingPeriodMicrons", "}"}], ",", 
       "listGratingStepsMicrons", ",", " ", 
       RowBox[{"{", "bestShift", "}"}], ",", "listSampleAngles"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Datasets\>\"", ",", 
       RowBox[{"{", 
        RowBox[{
        "\"\<allSinograms\>\"", ",", "\"\<testNameStr\>\"", ",", 
         "\"\<numberSlices\>\"", ",", "\"\<numberColumns\>\"", ",", 
         "\"\<numberOfAngles\>\"", ",", "\"\<gratingPeriodMicrons\>\"", ",", 
         "\"\<listGratingStepsMicrons\>\"", ",", "\"\<bestShift\>\"", ",", 
         "\"\<listSampleAngles\>\""}], "}"}]}], "}"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"listTimeAbsoluteAngle", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AbsoluteTime", "[", 
        RowBox[{"listTimeAngle", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], ",", 
       RowBox[{"AbsoluteTime", "[", 
        RowBox[{"listTimeAngle", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "[", "listTimeAngle", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenameHDF5", " ", "=", 
   RowBox[{
   "pathSino", "<>", "testNameStr", "<>", 
    "\"\<_sino_all_abs_parameters.h5\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"filenameHDF5", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "testNameStr", "}"}], ",", 
      RowBox[{"{", "numberSlices", "}"}], ",", 
      RowBox[{"{", "numberColumns", "}"}], ",", 
      RowBox[{"{", "numberOfAngles", "}"}], ",", 
      RowBox[{"{", "gratingPeriodMicrons", "}"}], ",", 
      "listGratingStepsMicrons", ",", " ", 
      RowBox[{"{", "bestShift", "}"}], ",", "listSampleAngles", ",", 
      "listTimeAbsoluteAngle"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"\"\<Datasets\>\"", ",", 
      RowBox[{"{", 
       RowBox[{
       "\"\<testNameStr\>\"", ",", "\"\<numberSlices\>\"", ",", 
        "\"\<numberColumns\>\"", ",", "\"\<numberOfAngles\>\"", ",", 
        "\"\<gratingPeriodMicrons\>\"", ",", 
        "\"\<listGratingStepsMicrons\>\"", ",", "\"\<bestShift\>\"", ",", 
        "\"\<listSampleAngles\>\"", ",", "\"\<listTimeAbsoluteAngle\>\""}], 
       "}"}]}], "}"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.558539234029317*^9, 3.558539250947794*^9}, 
   3.558539496637989*^9, {3.558539659341383*^9, 3.558539819437729*^9}, {
   3.5585398602593927`*^9, 3.55853991625235*^9}, 3.558540036818568*^9, {
   3.5760509983383293`*^9, 3.576050999057391*^9}, {3.576051136221808*^9, 
   3.576051188578609*^9}, {3.576051283052002*^9, 3.576051332883016*^9}, 
   3.576054048151244*^9, {3.5760541772342567`*^9, 3.5760541782508183`*^9}, {
   3.576321145755835*^9, 3.576321183080965*^9}, {3.576573388491762*^9, 
   3.5765733893047*^9}, {3.576573420308196*^9, 3.5765734662175617`*^9}, {
   3.576573604335704*^9, 3.576573659714858*^9}, 3.577004000756164*^9, {
   3.581180954603006*^9, 3.581180999562492*^9}, 3.60971706091964*^9, {
   3.609717818121685*^9, 3.6097178266006813`*^9}, {3.616163980422559*^9, 
   3.6161639815028477`*^9}, {3.623151690447753*^9, 3.623151729591969*^9}, {
   3.62315494106878*^9, 3.62315496754751*^9}, {3.6231824476474524`*^9, 
   3.6231824528332443`*^9}, {3.629730102093973*^9, 3.629730107426978*^9}, {
   3.647615268229292*^9, 3.6476152695970297`*^9}, 3.647669078337624*^9, {
   3.647669113514298*^9, 3.647669119300803*^9}, {3.647669431293874*^9, 
   3.647669473255352*^9}, {3.6476695174016247`*^9, 3.647669518458112*^9}, {
   3.647669608907301*^9, 3.6476696294001207`*^9}, {3.647672847140328*^9, 
   3.647672864398838*^9}, {3.647675095759942*^9, 3.647675136378961*^9}, {
   3.647676745895608*^9, 3.647676749811202*^9}, {3.647679133424314*^9, 
   3.647679141300373*^9}, 3.64767918658882*^9, {3.647679225124548*^9, 
   3.6476792538702803`*^9}, 3.647758660946149*^9, {3.671700913118657*^9, 
   3.671700930085806*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Step 6.5  Dark-Field: shift the sinograms, and save as bin and HDF5.  
With larger field of view, remove streaks, apply air offset, \
\>", "Subsection",
 CellChangeTimes->{{3.4562833726280527`*^9, 3.456283385607916*^9}, {
   3.463555031609515*^9, 3.463555047770688*^9}, 3.463590933610998*^9, 
   3.463591573151423*^9, {3.463681205490497*^9, 3.463681218422361*^9}, {
   3.463723051179096*^9, 3.463723089887204*^9}, {3.463723208493277*^9, 
   3.463723230746255*^9}, {3.558538088340563*^9, 3.558538132773198*^9}, {
   3.558539022074757*^9, 3.5585390331694403`*^9}, {3.558539215068102*^9, 
   3.558539227817025*^9}, {3.5594168311336393`*^9, 3.5594168404577312`*^9}, {
   3.5811814038935738`*^9, 3.581181422068521*^9}, {3.5827330616584597`*^9, 
   3.582733070657469*^9}, {3.623151568193277*^9, 3.623151633528089*^9}, {
   3.62318246064427*^9, 3.623182463691791*^9}, {3.624905709698699*^9, 
   3.624905717479862*^9}, {3.6308681325335093`*^9, 3.630868136771448*^9}, {
   3.63087618890051*^9, 3.630876200192727*^9}, {3.63103816563335*^9, 
   3.6310381779200687`*^9}, {3.631038249124552*^9, 3.6310382543869247`*^9}, {
   3.6310392326400957`*^9, 3.631039233462412*^9}, {3.631045150799144*^9, 
   3.6310451516535397`*^9}, {3.631085845384988*^9, 3.631085853921031*^9}, {
   3.6310907338762817`*^9, 3.631090734953877*^9}, {3.631091891412485*^9, 
   3.631091897214678*^9}, {3.6310927986823597`*^9, 3.6310927993965683`*^9}, {
   3.631092873302371*^9, 3.6310928793759613`*^9}, {3.631093708230545*^9, 
   3.6310937141613827`*^9}, {3.631276392463382*^9, 3.631276395145904*^9}, {
   3.647641743216364*^9, 3.647641759708383*^9}, {3.64764184294744*^9, 
   3.6476418484701366`*^9}, {3.64766966229574*^9, 3.647669663481051*^9}, {
   3.647675038216468*^9, 3.647675069318674*^9}, {3.647675865113885*^9, 
   3.647675879993948*^9}, 3.6476759216132402`*^9, {3.6476760829604588`*^9, 
   3.6476761149378242`*^9}, {3.647676309233157*^9, 3.647676310031351*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"allSinograms", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"NY", ",", "NX", ",", "NZ"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"indexProjection", " ", "=", "1"}], ",", 
     RowBox[{"indexProjection", "\[LessEqual]", " ", "NZ"}], ",", 
     RowBox[{"indexProjection", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"filename", " ", "=", " ", 
       RowBox[{"filenamesProjection", "[", 
        RowBox[{"[", "indexProjection", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"data", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"filename", ",", 
         RowBox[{"{", 
          RowBox[{"\"\<Datasets\>\"", ",", "\"\</darkfield\>\""}], "}"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "All", ",", " ", "indexProjection"}], "]"}],
         "]"}], " ", "=", "  ", "data"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"indexSlice", " ", "=", "1"}], ",", " ", 
     RowBox[{"indexSlice", "\[LessEqual]", "numberSlices"}], ",", 
     RowBox[{"indexSlice", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinogram", "=", " ", 
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"sinogram", "=", 
         RowBox[{"funcUseAirRegionForOffset", "[", 
          RowBox[{"sinogram", ",", "10"}], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"sinogram", "=", 
         RowBox[{"funcStreakRemovalFFT", "[", 
          RowBox[{"sinogram", ",", "0.005"}], "]"}]}], ";"}], "  ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"sinogram", " ", "=", 
       RowBox[{"funcShiftSinogram", "[", 
        RowBox[{
        "sinogram", ",", "bestShift", " ", ",", "newNumberAngles", ",", 
         "newNumberRays"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}], "=", 
       "sinogram"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"filename", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{
       "pathSino", "<>", "testNameStr", "<>", 
        "\"\<_sino_all_darkfield.bin\>\""}], "\[IndentingNewLine]", "fid"}], 
      " ", "=", " ", 
      RowBox[{"OpenWrite", "[", 
       RowBox[{"filename", ",", 
        RowBox[{"BinaryFormat", "\[Rule]", "True"}]}], "]"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"BinaryWrite", "[", 
     RowBox[{"fid", ",", "allSinograms", ",", "\"\<Real32\>\"", ",", 
      RowBox[{"ByteOrdering", "\[Rule]", 
       RowBox[{"-", "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Close", "[", "fid", "]"}], ";"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenameHDF5", " ", "=", 
   RowBox[{
   "pathSino", "<>", "testNameStr", "<>", 
    "\"\<_sino_all_darkfield.h5\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"filenameHDF5", ",", 
    RowBox[{"{", 
     RowBox[{"allSinograms", ",", 
      RowBox[{"{", "testNameStr", "}"}], ",", 
      RowBox[{"{", "numberSlices", "}"}], ",", 
      RowBox[{"{", "numberColumns", "}"}], ",", 
      RowBox[{"{", "numberOfAngles", "}"}], ",", 
      RowBox[{"{", "gratingPeriodMicrons", "}"}], ",", 
      "listGratingStepsMicrons", ",", " ", 
      RowBox[{"{", "bestShift", "}"}], ",", "listSampleAngles"}], "}"}], ",", 
    
    RowBox[{"{", 
     RowBox[{"\"\<Datasets\>\"", ",", 
      RowBox[{"{", 
       RowBox[{
       "\"\<allSinograms\>\"", ",", "\"\<testNameStr\>\"", ",", 
        "\"\<numberSlices\>\"", ",", "\"\<numberColumns\>\"", ",", 
        "\"\<numberOfAngles\>\"", ",", "\"\<gratingPeriodMicrons\>\"", ",", 
        "\"\<listGratingStepsMicrons\>\"", ",", "\"\<bestShift\>\"", ",", 
        "\"\<listSampleAngles\>\""}], "}"}]}], "}"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.6476759655373497`*^9, 3.647676004496402*^9}, {
   3.647676072051119*^9, 3.647676072764175*^9}, {3.6476767507392807`*^9, 
   3.647676751731389*^9}, 3.64767918791481*^9, {3.6476792260417423`*^9, 
   3.647679244628429*^9}, {3.671700931237339*^9, 3.6717009327246304`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Step 6.6  DPC: shift the sinograms, and save as bin and HDF5.  
With larger field of view, remove streaks, apply air offset, \
\>", "Subsection",
 CellChangeTimes->{{3.4562833726280527`*^9, 3.456283385607916*^9}, {
   3.463555031609515*^9, 3.463555047770688*^9}, 3.463590933610998*^9, 
   3.463591573151423*^9, {3.463681205490497*^9, 3.463681218422361*^9}, {
   3.463723051179096*^9, 3.463723089887204*^9}, {3.463723208493277*^9, 
   3.463723230746255*^9}, {3.558538088340563*^9, 3.558538132773198*^9}, {
   3.558539022074757*^9, 3.5585390331694403`*^9}, {3.558539215068102*^9, 
   3.558539227817025*^9}, {3.5594168311336393`*^9, 3.5594168404577312`*^9}, {
   3.5811814038935738`*^9, 3.581181422068521*^9}, {3.5827330616584597`*^9, 
   3.582733070657469*^9}, {3.623151568193277*^9, 3.623151633528089*^9}, {
   3.62318246064427*^9, 3.623182463691791*^9}, {3.624905709698699*^9, 
   3.624905717479862*^9}, {3.6308681325335093`*^9, 3.630868136771448*^9}, {
   3.63087618890051*^9, 3.630876200192727*^9}, {3.63103816563335*^9, 
   3.6310381779200687`*^9}, {3.631038249124552*^9, 3.6310382543869247`*^9}, {
   3.6310392326400957`*^9, 3.631039233462412*^9}, {3.631045150799144*^9, 
   3.6310451516535397`*^9}, {3.631085845384988*^9, 3.631085853921031*^9}, {
   3.6310907338762817`*^9, 3.631090734953877*^9}, {3.631091891412485*^9, 
   3.631091897214678*^9}, {3.6310927986823597`*^9, 3.6310927993965683`*^9}, {
   3.631092873302371*^9, 3.6310928793759613`*^9}, {3.631093708230545*^9, 
   3.6310937141613827`*^9}, {3.631276392463382*^9, 3.631276395145904*^9}, {
   3.647641743216364*^9, 3.647641759708383*^9}, {3.64764184294744*^9, 
   3.6476418484701366`*^9}, {3.64766966229574*^9, 3.647669663481051*^9}, {
   3.647675038216468*^9, 3.647675069318674*^9}, {3.647675865113885*^9, 
   3.647675879993948*^9}, 3.6476759216132402`*^9, {3.6476760829604588`*^9, 
   3.6476761149378242`*^9}, {3.647676309233157*^9, 3.64767632443711*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"allSinograms", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"NY", ",", "NX", ",", "NZ"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"indexProjection", " ", "=", "1"}], ",", 
     RowBox[{"indexProjection", "\[LessEqual]", " ", "NZ"}], ",", 
     RowBox[{"indexProjection", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"filename", " ", "=", " ", 
       RowBox[{"filenamesProjection", "[", 
        RowBox[{"[", "indexProjection", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"data", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"filename", ",", 
         RowBox[{"{", 
          RowBox[{"\"\<Datasets\>\"", ",", "\"\</dpc\>\""}], "}"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "All", ",", " ", "indexProjection"}], "]"}],
         "]"}], " ", "=", "  ", "data"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"indexSlice", " ", "=", "1"}], ",", " ", 
     RowBox[{"indexSlice", "\[LessEqual]", "numberSlices"}], ",", 
     RowBox[{"indexSlice", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinogram", "=", " ", 
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"sinogram", "=", 
         RowBox[{"funcUseAirRegionForOffset", "[", 
          RowBox[{"sinogram", ",", "10"}], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"sinogram", "=", 
         RowBox[{"funcStreakRemovalFFT", "[", 
          RowBox[{"sinogram", ",", "0.005"}], "]"}]}], ";"}], "  ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"sinogram", " ", "=", 
       RowBox[{"funcShiftSinogram", "[", 
        RowBox[{
        "sinogram", ",", "bestShift", " ", ",", "newNumberAngles", ",", 
         "newNumberRays"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}], "=", 
       "sinogram"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"filename", " ", "=", " ", 
     RowBox[{
     "pathSino", "<>", "testNameStr", "<>", "\"\<_sino_all_dpc.bin\>\""}]}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{"fid", " ", "=", " ", 
     RowBox[{"OpenWrite", "[", 
      RowBox[{"filename", ",", 
       RowBox[{"BinaryFormat", "\[Rule]", "True"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"BinaryWrite", "[", 
     RowBox[{"fid", ",", "allSinograms", ",", "\"\<Real32\>\"", ",", 
      RowBox[{"ByteOrdering", "\[Rule]", 
       RowBox[{"-", "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Close", "[", "fid", "]"}], ";"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenameHDF5", " ", "=", 
   RowBox[{
   "pathSino", "<>", "testNameStr", "<>", "\"\<_sino_all_dpc.h5\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"filenameHDF5", ",", 
    RowBox[{"{", 
     RowBox[{"allSinograms", ",", 
      RowBox[{"{", "testNameStr", "}"}], ",", 
      RowBox[{"{", "numberSlices", "}"}], ",", 
      RowBox[{"{", "numberColumns", "}"}], ",", 
      RowBox[{"{", "numberOfAngles", "}"}], ",", 
      RowBox[{"{", "gratingPeriodMicrons", "}"}], ",", 
      "listGratingStepsMicrons", ",", " ", 
      RowBox[{"{", "bestShift", "}"}], ",", "listSampleAngles"}], "}"}], ",", 
    
    RowBox[{"{", 
     RowBox[{"\"\<Datasets\>\"", ",", 
      RowBox[{"{", 
       RowBox[{
       "\"\<allSinograms\>\"", ",", "\"\<testNameStr\>\"", ",", 
        "\"\<numberSlices\>\"", ",", "\"\<numberColumns\>\"", ",", 
        "\"\<numberOfAngles\>\"", ",", "\"\<gratingPeriodMicrons\>\"", ",", 
        "\"\<listGratingStepsMicrons\>\"", ",", "\"\<bestShift\>\"", ",", 
        "\"\<listSampleAngles\>\""}], "}"}]}], "}"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.6476759655373497`*^9, 3.647676004496402*^9}, {
   3.647676072051119*^9, 3.647676072764175*^9}, {3.64767633153689*^9, 
   3.647676332513505*^9}, {3.647676395855228*^9, 3.6476763994622793`*^9}, 
   3.647676603620212*^9, {3.647676752659615*^9, 3.647676753667549*^9}, 
   3.647679189084651*^9, {3.647679226878518*^9, 3.647679238619385*^9}, {
   3.671700933724412*^9, 3.6717009347933207`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Step 6.7  DPC_Corr: shift the sinograms, and save as bin and HDF5.  
With larger field of view, remove streaks, apply air offset, \
\>", "Subsection",
 CellChangeTimes->{{3.4562833726280527`*^9, 3.456283385607916*^9}, {
   3.463555031609515*^9, 3.463555047770688*^9}, 3.463590933610998*^9, 
   3.463591573151423*^9, {3.463681205490497*^9, 3.463681218422361*^9}, {
   3.463723051179096*^9, 3.463723089887204*^9}, {3.463723208493277*^9, 
   3.463723230746255*^9}, {3.558538088340563*^9, 3.558538132773198*^9}, {
   3.558539022074757*^9, 3.5585390331694403`*^9}, {3.558539215068102*^9, 
   3.558539227817025*^9}, {3.5594168311336393`*^9, 3.5594168404577312`*^9}, {
   3.5811814038935738`*^9, 3.581181422068521*^9}, {3.5827330616584597`*^9, 
   3.582733070657469*^9}, {3.623151568193277*^9, 3.623151633528089*^9}, {
   3.62318246064427*^9, 3.623182463691791*^9}, {3.624905709698699*^9, 
   3.624905717479862*^9}, {3.6308681325335093`*^9, 3.630868136771448*^9}, {
   3.63087618890051*^9, 3.630876200192727*^9}, {3.63103816563335*^9, 
   3.6310381779200687`*^9}, {3.631038249124552*^9, 3.6310382543869247`*^9}, {
   3.6310392326400957`*^9, 3.631039233462412*^9}, {3.631045150799144*^9, 
   3.6310451516535397`*^9}, {3.631085845384988*^9, 3.631085853921031*^9}, {
   3.6310907338762817`*^9, 3.631090734953877*^9}, {3.631091891412485*^9, 
   3.631091897214678*^9}, {3.6310927986823597`*^9, 3.6310927993965683`*^9}, {
   3.631092873302371*^9, 3.6310928793759613`*^9}, {3.631093708230545*^9, 
   3.6310937141613827`*^9}, {3.631276392463382*^9, 3.631276395145904*^9}, {
   3.647641743216364*^9, 3.647641759708383*^9}, {3.64764184294744*^9, 
   3.6476418484701366`*^9}, {3.64766966229574*^9, 3.647669663481051*^9}, {
   3.647675038216468*^9, 3.647675069318674*^9}, {3.647675865113885*^9, 
   3.647675879993948*^9}, 3.6476759216132402`*^9, {3.6476760829604588`*^9, 
   3.6476761149378242`*^9}, {3.647676309233157*^9, 3.64767632443711*^9}, {
   3.6484047887679653`*^9, 3.648404790703088*^9}, {3.648404870482815*^9, 
   3.648404872234571*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"allSinograms", " ", "=", " ", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0.0", ",", 
     RowBox[{"{", 
      RowBox[{"NY", ",", "NX", ",", "NZ"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"indexProjection", " ", "=", "1"}], ",", 
     RowBox[{"indexProjection", "\[LessEqual]", " ", "NZ"}], ",", 
     RowBox[{"indexProjection", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"filename", " ", "=", " ", 
       RowBox[{"filenamesProjection", "[", 
        RowBox[{"[", "indexProjection", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"data", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"filename", ",", 
         RowBox[{"{", 
          RowBox[{"\"\<Datasets\>\"", ",", "\"\</dpcCorr\>\""}], "}"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "All", ",", " ", "indexProjection"}], "]"}],
         "]"}], " ", "=", "  ", "data"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"For", "[", 
    RowBox[{
     RowBox[{"indexSlice", " ", "=", "1"}], ",", " ", 
     RowBox[{"indexSlice", "\[LessEqual]", "numberSlices"}], ",", 
     RowBox[{"indexSlice", "++"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sinogram", "=", " ", 
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"sinogram", "=", 
         RowBox[{"funcUseAirRegionForOffset", "[", 
          RowBox[{"sinogram", ",", "10"}], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"sinogram", "=", 
         RowBox[{"funcStreakRemovalFFT", "[", 
          RowBox[{"sinogram", ",", "0.005"}], "]"}]}], ";"}], "  ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"sinogram", " ", "=", 
       RowBox[{"funcShiftSinogram", "[", 
        RowBox[{
        "sinogram", ",", "bestShift", " ", ",", "newNumberAngles", ",", 
         "newNumberRays"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"allSinograms", "[", 
        RowBox[{"[", 
         RowBox[{"indexSlice", ",", "All", ",", "All"}], "]"}], "]"}], "=", 
       "sinogram"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"filename", " ", "=", " ", 
     RowBox[{
     "pathSino", "<>", "testNameStr", "<>", 
      "\"\<_sino_all_dpcCorr.bin\>\""}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"fid", " ", "=", " ", 
     RowBox[{"OpenWrite", "[", 
      RowBox[{"filename", ",", 
       RowBox[{"BinaryFormat", "\[Rule]", "True"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"BinaryWrite", "[", 
     RowBox[{"fid", ",", "allSinograms", ",", "\"\<Real32\>\"", ",", 
      RowBox[{"ByteOrdering", "\[Rule]", 
       RowBox[{"-", "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Close", "[", "fid", "]"}], ";"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"filenameHDF5", " ", "=", 
   RowBox[{
   "pathSino", "<>", "testNameStr", "<>", "\"\<_sino_all_dpcCorr.h5\>\""}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"filenameHDF5", ",", 
    RowBox[{"{", 
     RowBox[{"allSinograms", ",", 
      RowBox[{"{", "testNameStr", "}"}], ",", 
      RowBox[{"{", "numberSlices", "}"}], ",", 
      RowBox[{"{", "numberColumns", "}"}], ",", 
      RowBox[{"{", "numberOfAngles", "}"}], ",", 
      RowBox[{"{", "gratingPeriodMicrons", "}"}], ",", 
      "listGratingStepsMicrons", ",", " ", 
      RowBox[{"{", "bestShift", "}"}], ",", "listSampleAngles"}], "}"}], ",", 
    
    RowBox[{"{", 
     RowBox[{"\"\<Datasets\>\"", ",", 
      RowBox[{"{", 
       RowBox[{
       "\"\<allSinograms\>\"", ",", "\"\<testNameStr\>\"", ",", 
        "\"\<numberSlices\>\"", ",", "\"\<numberColumns\>\"", ",", 
        "\"\<numberOfAngles\>\"", ",", "\"\<gratingPeriodMicrons\>\"", ",", 
        "\"\<listGratingStepsMicrons\>\"", ",", "\"\<bestShift\>\"", ",", 
        "\"\<listSampleAngles\>\""}], "}"}]}], "}"}]}], "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.6476759655373497`*^9, 3.647676004496402*^9}, {
   3.647676072051119*^9, 3.647676072764175*^9}, {3.64767633153689*^9, 
   3.647676332513505*^9}, {3.647676395855228*^9, 3.6476763994622793`*^9}, 
   3.647676603620212*^9, {3.647676752659615*^9, 3.647676753667549*^9}, 
   3.647679189084651*^9, {3.647679226878518*^9, 3.647679238619385*^9}, {
   3.6484048281794157`*^9, 3.6484048581699867`*^9}, {3.6525375793202868`*^9, 
   3.6525375969361973`*^9}, {3.6717009356112947`*^9, 3.67170093644833*^9}}]
}, Closed]]
}, Closed]],

Cell["Step 7:  InverseRadon", "Section",
 CellChangeTimes->{{3.5033167061859503`*^9, 3.503316719635662*^9}, {
   3.50331674973533*^9, 3.503316754268928*^9}, {3.5033374747215557`*^9, 
   3.503337480080407*^9}, {3.503339142667317*^9, 3.5033391448651657`*^9}, {
   3.504730372452002*^9, 3.504730377984919*^9}, {3.507715381523715*^9, 
   3.507715399273287*^9}, {3.640111094694233*^9, 3.640111100667691*^9}, {
   3.640111518458076*^9, 3.640111535919319*^9}, 3.6402196556029873`*^9, {
   3.640219727445634*^9, 3.640219746025066*^9}, 3.6407127833693037`*^9, {
   3.640877835712092*^9, 3.640877845007203*^9}, 3.640941766414694*^9, 
   3.640956657458598*^9, {3.640964712550826*^9, 3.6409647211418133`*^9}, {
   3.640993195605362*^9, 3.6409932107178183`*^9}, {3.6410545089880657`*^9, 
   3.641054514538434*^9}, {3.641241003572548*^9, 3.641241014771098*^9}, {
   3.6429427969837027`*^9, 3.6429428069906273`*^9}, {3.642993682725779*^9, 
   3.642993698792001*^9}, {3.6429939923302717`*^9, 3.642993999388014*^9}, {
   3.6430171776603317`*^9, 3.6430172028153048`*^9}, {3.643044324488636*^9, 
   3.643044335744014*^9}, {3.643051971438998*^9, 3.643051976686528*^9}, {
   3.643052135903675*^9, 3.643052143558909*^9}, {3.643348365022581*^9, 
   3.643348392942012*^9}, {3.643348473098693*^9, 3.643348486300507*^9}, {
   3.64334856224571*^9, 3.643348592310884*^9}, {3.647531730308894*^9, 
   3.647531745035528*^9}, 3.647729549884424*^9, {3.673799902570899*^9, 
   3.673799940479494*^9}}],

Cell[CellGroupData[{

Cell["Step 8:  Volume: customize for the sample", "Section",
 CellChangeTimes->{{3.5033167061859503`*^9, 3.503316719635662*^9}, {
   3.50331674973533*^9, 3.503316754268928*^9}, {3.5033374747215557`*^9, 
   3.503337480080407*^9}, {3.503339142667317*^9, 3.5033391448651657`*^9}, {
   3.504730372452002*^9, 3.504730377984919*^9}, {3.507715381523715*^9, 
   3.507715399273287*^9}, {3.640111094694233*^9, 3.640111100667691*^9}, {
   3.640111518458076*^9, 3.640111535919319*^9}, 3.6402196556029873`*^9, {
   3.640219727445634*^9, 3.640219746025066*^9}, 3.6407127833693037`*^9, {
   3.640877835712092*^9, 3.640877845007203*^9}, 3.640941766414694*^9, 
   3.640956657458598*^9, {3.640964712550826*^9, 3.6409647211418133`*^9}, {
   3.640993195605362*^9, 3.6409932107178183`*^9}, {3.6410545089880657`*^9, 
   3.641054514538434*^9}, {3.641241003572548*^9, 3.641241014771098*^9}, {
   3.6429427969837027`*^9, 3.6429428069906273`*^9}, {3.642993682725779*^9, 
   3.642993698792001*^9}, {3.6429939923302717`*^9, 3.642993999388014*^9}, {
   3.6430171776603317`*^9, 3.6430172028153048`*^9}, {3.643044324488636*^9, 
   3.643044335744014*^9}, {3.643051971438998*^9, 3.643051976686528*^9}, {
   3.643052135903675*^9, 3.643052143558909*^9}, {3.643348365022581*^9, 
   3.643348392942012*^9}, {3.643348473098693*^9, 3.643348486300507*^9}, {
   3.64334856224571*^9, 3.643348592310884*^9}, {3.647531730308894*^9, 
   3.647531745035528*^9}, 3.647729549884424*^9, 3.673799902570899*^9, {
   3.6737999369914494`*^9, 3.673799943463333*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"imageSize", "=", "500"}], ";"}]], "Input",
 CellChangeTimes->{{3.647729808825408*^9, 3.647729810691165*^9}}],

Cell[CellGroupData[{

Cell["Absorption", "Subsection",
 CellChangeTimes->{{3.643351165958143*^9, 3.64335118089995*^9}}],

Cell[BoxData[{
 RowBox[{"filename", " ", "=", " ", 
  RowBox[{
   RowBox[{"FileNames", "[", 
    RowBox[{"\"\<*_abs.h5\>\"", ",", "pathVolumes"}], "]"}], "//", 
   "First"}]}], "\[IndentingNewLine]", 
 RowBox[{"Import", "[", "filename", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"volumeABS", " ", "=", " ", 
   RowBox[{"Import", "[", 
    RowBox[{"filename", ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Datasets\>\"", ",", "\"\</absorption\>\""}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "volumeABS", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"volumeABS", " ", "=", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"Image3D", "[", 
     RowBox[{"volumeABS", ",", "\"\<Real\>\""}], "]"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.647729573108735*^9, 3.647729603727902*^9}, {
  3.647729652347196*^9, 3.647729726718266*^9}, {3.647729766591831*^9, 
  3.647729815827673*^9}, {3.647729871309924*^9, 3.647729873972207*^9}}],

Cell[BoxData[{
 RowBox[{"GraphicsRow", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"volumeABS", ",", " ", 
     RowBox[{"ImageHistogram", "[", "volumeABS", "]"}]}], "}"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "imageSize"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"ImageDimensions", "[", "volumeABS", "]"}]}], "Input",
 CellChangeTimes->{{3.643349028376865*^9, 3.643349052273542*^9}, {
   3.6433490924486923`*^9, 3.643349161505978*^9}, {3.643349249164647*^9, 
   3.643349320359344*^9}, {3.6433515594822807`*^9, 3.643351561007772*^9}, {
   3.643351603806797*^9, 3.6433516044311247`*^9}, 3.643352122783945*^9, {
   3.6433523388228083`*^9, 3.643352339122957*^9}, {3.643352804884873*^9, 
   3.643352806926392*^9}, 3.643352931104043*^9, 3.643399297198188*^9, 
   3.643399332331972*^9, {3.6436461005626383`*^9, 3.6436461070245247`*^9}, {
   3.64364615732959*^9, 3.643646213221856*^9}, {3.643646255897818*^9, 
   3.643646288439651*^9}, {3.643652896348428*^9, 3.643652947713846*^9}, {
   3.643879381112585*^9, 3.643879424192772*^9}, 3.6477297561855907`*^9, {
   3.6477297927574177`*^9, 3.64772990407159*^9}, {3.647729997726385*^9, 
   3.647730009299712*^9}, {3.647730106513927*^9, 3.647730109691759*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"volumeABS", "=", 
     RowBox[{"RemoveBackground", "[", 
      RowBox[{"volumeABS", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Background\>\"", ",", " ", "\"\<Dark\>\""}], "}"}]}], 
      "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"volumeABSbinary", " ", "=", 
     RowBox[{"MorphologicalBinarize", "[", 
      RowBox[{"volumeABS", ",", 
       RowBox[{"{", 
        RowBox[{"0.47", ",", "0.6"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"volumeABSbinary", "=", 
    RowBox[{"Dilation", "[", 
     RowBox[{
      RowBox[{"DeleteSmallComponents", "[", "volumeABSbinary", "]"}], ",", 
      "1"}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.643600809711648*^9, 3.643600827204589*^9}, {
  3.647730047783729*^9, 3.647730093842276*^9}, {3.652540065416959*^9, 
  3.652540085630227*^9}}],

Cell[BoxData[
 RowBox[{"volumeABS", " ", "=", " ", 
  RowBox[{"ImageMultiply", "[", 
   RowBox[{"volumeABS", ",", "volumeABSbinary"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.64335209652456*^9, 3.6433521167520523`*^9}, {
   3.6433521873603888`*^9, 3.643352209971835*^9}, {3.643352280355776*^9, 
   3.6433522834453993`*^9}, {3.643352325908375*^9, 3.6433523277779217`*^9}, 
   3.643352396589093*^9, 3.643352484059525*^9, {3.6433525700403433`*^9, 
   3.643352575342368*^9}, 3.64360062398984*^9, {3.643600819223983*^9, 
   3.6436008215923*^9}}],

Cell[BoxData[
 RowBox[{"gAbsorption", "=", 
  RowBox[{"Image3D", "[", 
   RowBox[{
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"volumeABS", ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0.1", ",", "0.5"}], "}"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
    RowBox[{"Boxed", "\[Rule]", "True"}], ",", 
    RowBox[{"BoxRatios", "\[Rule]", "Automatic"}], ",", 
    RowBox[{"BoxStyle", "\[Rule]", 
     RowBox[{"Directive", "[", "White", "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<rows\>\"", ",", "\"\<columns\>\"", ",", "\"\<slices\>\""}],
       "}"}]}], ",", 
    RowBox[{"AxesStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"White", ",", "14"}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"ColorFunction", "\[Rule]", "\"\<XRay\>\""}], ",", 
    RowBox[{"Background", "\[Rule]", "Black"}], ",", "\[IndentingNewLine]", 
    RowBox[{"ViewVertical", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", 
    RowBox[{"ViewPoint", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "5.3"}], ",", " ", 
       RowBox[{"-", "1.0"}], ",", " ", "1.0"}], "}"}]}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "imageSize"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.643350179138762*^9, 3.643350204174089*^9}, {
   3.643350248441349*^9, 3.643350254001834*^9}, {3.643350309748658*^9, 
   3.643350390650262*^9}, {3.643350657598605*^9, 3.643350719722217*^9}, {
   3.6433508207652483`*^9, 3.643350844992228*^9}, 3.643350880901085*^9, {
   3.643350950556074*^9, 3.643351003628396*^9}, {3.643351037206768*^9, 
   3.643351124109816*^9}, {3.643351191755349*^9, 3.6433511955240097`*^9}, {
   3.643352048408746*^9, 3.6433520562159433`*^9}, {3.643352636849227*^9, 
   3.643352706769334*^9}, {3.6433561636678143`*^9, 3.643356172793808*^9}, {
   3.643593869333165*^9, 3.643593899113782*^9}, {3.643884513960423*^9, 
   3.643884520536083*^9}}],

Cell[BoxData[
 RowBox[{"gAbsorptionBinary", "=", 
  RowBox[{"Image3D", "[", 
   RowBox[{"volumeABSbinary", ",", 
    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
    RowBox[{"Boxed", "\[Rule]", "True"}], ",", 
    RowBox[{"BoxRatios", "\[Rule]", "Automatic"}], ",", 
    RowBox[{"BoxStyle", "\[Rule]", 
     RowBox[{"Directive", "[", "White", "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<rows\>\"", ",", "\"\<columns\>\"", ",", "\"\<slices\>\""}],
       "}"}]}], ",", 
    RowBox[{"AxesStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"White", ",", "14"}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"ColorFunction", "\[Rule]", "\"\<XRay\>\""}], ",", 
    RowBox[{"Background", "\[Rule]", "Black"}], ",", "\[IndentingNewLine]", 
    RowBox[{"ViewVertical", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", 
    RowBox[{"ViewPoint", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "5.3"}], ",", " ", 
       RowBox[{"-", "1.0"}], ",", " ", "1.0"}], "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.643351638054262*^9, 3.643351668400112*^9}, 
   3.643352615813038*^9, 3.643593925627925*^9}],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathFigures", "<>", "\"\<volume_absorption.png\>\""}], ",", 
   "gAbsorption", ",", "\"\<PNG\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.6433560718218946`*^9, 3.643356082269554*^9}}],

Cell[BoxData[{
 RowBox[{"ImageQ", "[", "volumeABS", "]"}], "\[IndentingNewLine]", 
 RowBox[{"NumberQ", "[", "volumeABS", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dataVolumeABS", " ", "=", " ", 
   RowBox[{"ImageData", "[", 
    RowBox[{"volumeABS", ",", "\"\<Real\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ImageQ", "[", "dataVolumeABS", "]"}], "\[IndentingNewLine]", 
 RowBox[{"NumberQ", "[", 
  RowBox[{"dataVolumeABS", "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathFigures", "<>", "\"\<volume_absorption.h5\>\""}], ",", 
   "dataVolumeABS", ",", 
   RowBox[{"{", 
    RowBox[{"\"\<Datasets\>\"", ",", "\"\<absorption\>\""}], "}"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.643474491978603*^9, 3.643474561514687*^9}, {
   3.643474605900916*^9, 3.643474663780389*^9}, 3.6435939453788443`*^9, {
   3.6438941164558067`*^9, 3.643894119599433*^9}, {3.6438941522009974`*^9, 
   3.643894195415586*^9}, {3.64773024066931*^9, 3.6477302408150454`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dataVolumeABSbinary", " ", "=", " ", 
   RowBox[{"ImageData", "[", 
    RowBox[{"volumeABSbinary", ",", "\"\<Bit\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathFigures", "<>", "\"\<volume_absorption_binary.h5\>\""}], ",", 
   "dataVolumeABSbinary", ",", 
   RowBox[{"{", 
    RowBox[{"\"\<Datasets\>\"", ",", "\"\<absorption_binary\>\""}], "}"}]}], 
  "]"}]}], "Input"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "volumeABS", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "dataVolumeABS", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "volumeABSbinary", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "dataVolumeABSbinary", "]"}]}], "Input",
 CellChangeTimes->{{3.643594994640993*^9, 3.643595004493183*^9}, 
   3.643884581256226*^9, {3.643884634580152*^9, 3.643884667288302*^9}, 
   3.6438940767611713`*^9, {3.64389420530658*^9, 3.643894213168517*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Dark-Field", "Subsection",
 CellChangeTimes->{{3.643351165958143*^9, 3.64335118089995*^9}, {
  3.64335123603518*^9, 3.643351238860856*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dataVolumeABSbinary", " ", "=", "\[IndentingNewLine]", 
   RowBox[{"Import", "[", 
    RowBox[{
     RowBox[{"pathFigures", "<>", "\"\<volume_absorption_binary.h5\>\""}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Datasets\>\"", ",", "\"\</absorption_binary\>\""}], 
      "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"volumeABSbinary", "=", 
   RowBox[{"Image3D", "[", 
    RowBox[{"dataVolumeABSbinary", ",", "\"\<Bit\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "dataVolumeABSbinary", 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.643895382485052*^9, 3.643895453883711*^9}}],

Cell[BoxData["volumeABSbinary"], "Input"],

Cell[BoxData[{
 RowBox[{"filename", " ", "=", " ", 
  RowBox[{
   RowBox[{"FileNames", "[", 
    RowBox[{"\"\<*_darkfield.h5\>\"", ",", "pathVolumes"}], "]"}], "//", 
   "First"}]}], "\[IndentingNewLine]", 
 RowBox[{"Import", "[", "filename", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"volumeDarkField", " ", "=", " ", 
   RowBox[{"Import", "[", 
    RowBox[{"filename", ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Datasets\>\"", ",", "\"\</darkfield\>\""}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "volumeDarkField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"volumeDarkField", " ", "=", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"Image3D", "[", 
     RowBox[{"volumeDarkField", ",", "\"\<Real\>\""}], "]"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.647729573108735*^9, 3.647729603727902*^9}, {
  3.647729652347196*^9, 3.647729726718266*^9}, {3.647729766591831*^9, 
  3.647729815827673*^9}, {3.647729871309924*^9, 3.647729873972207*^9}, {
  3.647730315917719*^9, 3.647730375576604*^9}}],

Cell[BoxData["volumeDarkField"], "Input"],

Cell[BoxData[
 RowBox[{"volumeDarkField", "=", 
  RowBox[{"ImageMultiply", "[", 
   RowBox[{"volumeDarkField", ",", "volumeABSbinary"}], "]"}]}]], "Input",
 CellChangeTimes->{
  3.643349312104642*^9, {3.643349646781517*^9, 3.643349703349592*^9}, {
   3.6433499189694977`*^9, 3.643349921264515*^9}, {3.643351379918647*^9, 
   3.6433513815077257`*^9}, {3.643351730959797*^9, 3.643351747978578*^9}, {
   3.643601752752433*^9, 3.6436017559466963`*^9}, {3.643653124395627*^9, 
   3.643653131362611*^9}, 3.643879459824008*^9, {3.64773043608869*^9, 
   3.647730437290773*^9}}],

Cell[BoxData[
 RowBox[{"ImageHistogram", "[", "volumeDarkField", "]"}]], "Input",
 CellChangeTimes->{{3.643351888994522*^9, 3.643351945713472*^9}, {
  3.6433536970963173`*^9, 3.643353705068232*^9}}],

Cell["\<\
Useful colorfunctions are:
\[OpenCurlyDoubleQuote]XRay\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]\
HighRange\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]LowRange\
\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]WhiteBlackOpacity\
\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]SunsetColorsOpacity\
\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]RainbowOpacity\
\[CloseCurlyDoubleQuote]
(GrayLevel[#,.005]&)\
\>", "Text",
 CellChangeTimes->{{3.643883979630493*^9, 3.643884012876328*^9}, 
   3.643884051782721*^9, {3.6438840863525476`*^9, 3.643884086892614*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"gDarkField", "=", 
   RowBox[{"Image3D", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ImageAdjust", "[", 
      RowBox[{
       RowBox[{"ImageMultiply", "[", 
        RowBox[{"volumeDarkField", ",", 
         RowBox[{"Erosion", "[", 
          RowBox[{"volumeABSbinary", ",", "1"}], "]"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0.0", ",", "0.08"}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Axes", "\[Rule]", "True"}], ",", 
     RowBox[{"Boxed", "\[Rule]", "True"}], ",", 
     RowBox[{"BoxRatios", "\[Rule]", "Automatic"}], ",", 
     RowBox[{"BoxStyle", "\[Rule]", 
      RowBox[{"Directive", "[", "White", "]"}]}], ",", "\[IndentingNewLine]", 
     
     RowBox[{"Axes", "\[Rule]", "True"}], ",", 
     RowBox[{"AxesLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
       "\"\<rows\>\"", ",", "\"\<columns\>\"", ",", "\"\<slices\>\""}], 
       "}"}]}], ",", 
     RowBox[{"AxesStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"White", ",", "14"}], "]"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"ColorFunction", "\[Rule]", "\"\<SunsetColorsOpacity\>\""}], ",", 
     RowBox[{"Background", "\[Rule]", "Black"}], ",", "\[IndentingNewLine]", 
     RowBox[{"ViewVertical", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", 
     RowBox[{"ViewPoint", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"-", "5.3"}], ",", " ", 
        RowBox[{"-", "1.0"}], ",", " ", "1.0"}], "}"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "imageSize"}]}], "]"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.643350179138762*^9, 3.643350204174089*^9}, {
   3.643350248441349*^9, 3.643350254001834*^9}, {3.643350309748658*^9, 
   3.643350390650262*^9}, {3.643350657598605*^9, 3.643350719722217*^9}, {
   3.6433508207652483`*^9, 3.643350844992228*^9}, 3.643350880901085*^9, {
   3.643350950556074*^9, 3.643351003628396*^9}, {3.643351037206768*^9, 
   3.643351124109816*^9}, {3.643351191755349*^9, 3.6433511955240097`*^9}, 
   3.643351397806732*^9, {3.643351756864723*^9, 3.6433517616628838`*^9}, 
   3.6433519992184057`*^9, {3.643353684249454*^9, 3.643353694462316*^9}, 
   3.643356185786545*^9, {3.643399555849834*^9, 3.643399556000012*^9}, {
   3.643477839215097*^9, 3.6434778638564663`*^9}, 3.643593916497596*^9, {
   3.64360097550947*^9, 3.643600989556669*^9}, {3.643601776654779*^9, 
   3.6436018432365417`*^9}, {3.6436018782782383`*^9, 
   3.6436019330624437`*^9}, {3.643879667903899*^9, 3.643879668649291*^9}, 
   3.643880693670807*^9, {3.643883708340461*^9, 3.643883720491558*^9}, {
   3.64388385986018*^9, 3.643883869665304*^9}, {3.6438839330717278`*^9, 
   3.643883964553158*^9}, {3.64388401781919*^9, 3.6438840465579443`*^9}, {
   3.643884094177165*^9, 3.643884116543103*^9}, {3.643884417905178*^9, 
   3.643884454967023*^9}, {3.643884485465416*^9, 3.6438844876380587`*^9}, {
   3.644481540706791*^9, 3.6444815624377823`*^9}, {3.6444818926210823`*^9, 
   3.644481904990597*^9}, {3.652541032229998*^9, 3.652541033021863*^9}, 
   3.652541089075245*^9}],

Cell[BoxData[
 RowBox[{"gDarkField", "=", 
  RowBox[{"Image3D", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"volumeDarkField", ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0.0", ",", "0.08"}], "}"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
    RowBox[{"Boxed", "\[Rule]", "True"}], ",", 
    RowBox[{"BoxRatios", "\[Rule]", "Automatic"}], ",", 
    RowBox[{"BoxStyle", "\[Rule]", 
     RowBox[{"Directive", "[", "White", "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<rows\>\"", ",", "\"\<columns\>\"", ",", "\"\<slices\>\""}],
       "}"}]}], ",", 
    RowBox[{"AxesStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"White", ",", "14"}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"ColorFunction", "\[Rule]", "\"\<SunsetColorsOpacity\>\""}], ",", 
    
    RowBox[{"Background", "\[Rule]", "Black"}], ",", "\[IndentingNewLine]", 
    RowBox[{"ViewVertical", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", 
    RowBox[{"ViewPoint", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "5.3"}], ",", " ", 
       RowBox[{"-", "1.0"}], ",", " ", "1.0"}], "}"}]}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "imageSize"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.652540976992944*^9, 3.652540984959363*^9}, {
  3.652541018559264*^9, 3.6525410194304037`*^9}}],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathFigures", "<>", "\"\<volume_dark-field.png\>\""}], ",", 
   "gDarkField", ",", "\"\<PNG\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.643356009797423*^9, 3.643356044442189*^9}}],

Cell[BoxData[{
 RowBox[{"ImageQ", "[", "volumeDarkField", "]"}], "\[IndentingNewLine]", 
 RowBox[{"NumberQ", "[", "volumeDarkField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dataVolumeDarkField", " ", "=", " ", 
   RowBox[{"ImageData", "[", 
    RowBox[{"volumeDarkField", ",", "\"\<Real\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ImageQ", "[", "dataVolumeDarkField", "]"}], "\[IndentingNewLine]", 
 RowBox[{"NumberQ", "[", 
  RowBox[{"dataVolumeDarkField", "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathFigures", "<>", "\"\<volume_darkfield.h5\>\""}], ",", 
   "dataVolumeDarkField", ",", 
   RowBox[{"{", 
    RowBox[{"\"\<Datasets\>\"", ",", "\"\<darkfield\>\""}], "}"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.643475461499693*^9, 3.6434754963177423`*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "volumeDarkField", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "dataVolumeDarkField", "]"}]}], "Input",
 CellChangeTimes->{{3.643594994640993*^9, 3.643595004493183*^9}, {
   3.643884581256226*^9, 3.643884604591834*^9}, {3.643884648677023*^9, 
   3.643884673315832*^9}, 3.643894053650547*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Plotting Correlation between Absorption and Dark-Field: All data\
\>", "Subsection",
 CellChangeTimes->{{3.643351165958143*^9, 3.64335118089995*^9}, {
  3.64335123603518*^9, 3.643351238860856*^9}, {3.643884688462865*^9, 
  3.643884693220991*^9}, {3.644224814465108*^9, 3.6442248204392567`*^9}, {
  3.6442249052459097`*^9, 3.6442249122606087`*^9}}],

Cell["\<\
The exploration here is this.  Is there a correlation between the absorption \
and dark-field values?
The result is yes, but it is confusing.\
\>", "Text",
 CellChangeTimes->{{3.644226273738084*^9, 3.644226308378051*^9}, {
  3.644226350782852*^9, 3.644226407516345*^9}, {3.644226576779352*^9, 
  3.644226578363064*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dataVolumeABS", "=", 
   RowBox[{"Import", "[", 
    RowBox[{
     RowBox[{"pathFigures", "<>", "\"\<volume_absorption.h5\>\""}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Datasets\>\"", ",", "\"\</absorption\>\""}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "dataVolumeABS", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dataVolumeDarkField", "=", 
   RowBox[{"Import", "[", 
    RowBox[{
     RowBox[{"pathFigures", "<>", "\"\<volume_darkfield.h5\>\""}], ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Datasets\>\"", ",", "\"\</darkfield\>\""}], "}"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "dataVolumeDarkField", "]"}]}], "Input",
 CellChangeTimes->{{3.643893835453169*^9, 3.64389389075826*^9}, {
  3.6438939242659273`*^9, 3.643893990228929*^9}, {3.6438942436436033`*^9, 
  3.643894327355702*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"index", " ", "=", " ", 
   RowBox[{"Position", "[", 
    RowBox[{"dataVolumeABS", ",", 
     RowBox[{"p_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#", ">", "0"}], " ", "&"}], ")"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", "index", "]"}], "\[IndentingNewLine]", 
 RowBox[{"First", "[", "index", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"listAbsNoneZeroValues", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"r", ",", "c", ",", "s"}], "}"}], "=", 
       RowBox[{"index", "[", 
        RowBox[{"[", "i", "]"}], "]"}]}], ";", " ", 
      RowBox[{"dataVolumeABS", "[", 
       RowBox[{"[", 
        RowBox[{"r", ",", "c", ",", "s"}], "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "[", "index", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", "listAbsNoneZeroValues", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"listDarkFieldValues", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"r", ",", "c", ",", "s"}], "}"}], "=", 
       RowBox[{"index", "[", 
        RowBox[{"[", "i", "]"}], "]"}]}], ";", " ", 
      RowBox[{"dataVolumeDarkField", "[", 
       RowBox[{"[", 
        RowBox[{"r", ",", "c", ",", "s"}], "]"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", 
       RowBox[{"Length", "[", "index", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", "listDarkFieldValues", "]"}], "\[IndentingNewLine]", 
 RowBox[{"correlation", " ", "=", " ", 
  RowBox[{"Correlation", "[", 
   RowBox[{"listAbsNoneZeroValues", ",", "listDarkFieldValues"}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.6442054628281393`*^9, 3.644205504679443*^9}, {
  3.644205549155115*^9, 3.644205564155381*^9}, {3.644205615154356*^9, 
  3.644205736075756*^9}, {3.644205790886013*^9, 3.644205791388212*^9}, {
  3.644205903313057*^9, 3.644205921442772*^9}, {3.644206288228084*^9, 
  3.644206291211623*^9}, {3.644224147453608*^9, 3.6442241528317537`*^9}, {
  3.6442246395734367`*^9, 3.644224644095387*^9}}],

Cell[BoxData[
 RowBox[{"gHistAll", " ", "=", 
  RowBox[{"Histogram3D", "[", 
   RowBox[{
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{"listAbsNoneZeroValues", ",", "listDarkFieldValues"}], "}"}], 
     "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0.7", ",", "0.02"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0.02"}], "}"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<abs\>\"", ",", "\"\<(1-DF)\>\"", ",", "\"\<counts\>\""}], 
      "}"}]}], ",", 
    RowBox[{"AxesStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"Black", ",", "20"}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"PlotLabel", "\[Rule]", 
     RowBox[{"\"\<correlation = \>\"", "<>", 
      RowBox[{"ToString", "[", " ", "correlation", "]"}]}]}], ",", 
    RowBox[{"LabelStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"Black", ",", "20"}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.644205832780015*^9, 3.644205858569146*^9}, {
  3.644205948747437*^9, 3.644205997344913*^9}, {3.6442060837519083`*^9, 
  3.6442061609956417`*^9}, {3.6442063972657547`*^9, 3.6442064437951097`*^9}, {
  3.644207199386064*^9, 3.6442072437546263`*^9}, {3.644207280403997*^9, 
  3.644207302230309*^9}, {3.644223912915491*^9, 3.644223966596435*^9}, {
  3.644224115214705*^9, 3.644224164009256*^9}, {3.644224223363832*^9, 
  3.644224231177822*^9}, {3.6442246495012913`*^9, 3.644224651357196*^9}, {
  3.644264654142519*^9, 3.644264658281815*^9}, {3.644264720517684*^9, 
  3.644264723930407*^9}, {3.6444880399170237`*^9, 3.644488171418056*^9}}],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{
   "pathFigures", "<>", "\"\<bivariate_histogram_correlation.png\>\""}], ",", 
   "gHistAll", ",", "\"\<PNG\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.644253477690425*^9, 3.644253492171714*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["DPC", "Subsection",
 CellChangeTimes->{{3.643351165958143*^9, 3.64335118089995*^9}, {
  3.64335123603518*^9, 3.643351238860856*^9}, {3.647730555866733*^9, 
  3.647730557570149*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dataVolumeABSbinary", " ", "=", "\[IndentingNewLine]", 
   RowBox[{"Import", "[", 
    RowBox[{
     RowBox[{"pathFigures", "<>", "\"\<volume_absorption_binary.h5\>\""}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Datasets\>\"", ",", "\"\</absorption_binary\>\""}], 
      "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"volumeABSbinary", "=", 
   RowBox[{"Image3D", "[", 
    RowBox[{"dataVolumeABSbinary", ",", "\"\<Bit\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "dataVolumeABSbinary", 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.643895382485052*^9, 3.643895453883711*^9}}],

Cell[BoxData[{
 RowBox[{"filename", " ", "=", " ", 
  RowBox[{
   RowBox[{"FileNames", "[", 
    RowBox[{"\"\<*_dpc.h5\>\"", ",", "pathVolumes"}], "]"}], "//", 
   "First"}]}], "\[IndentingNewLine]", 
 RowBox[{"Import", "[", "filename", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"volumeDPC", " ", "=", " ", 
   RowBox[{"Import", "[", 
    RowBox[{"filename", ",", 
     RowBox[{"{", 
      RowBox[{"\"\<Datasets\>\"", ",", "\"\</dpc\>\""}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "volumeDPC", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"volumeDPC", " ", "=", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{"Image3D", "[", 
     RowBox[{"volumeDPC", ",", "\"\<Real\>\""}], "]"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.647729573108735*^9, 3.647729603727902*^9}, {
  3.647729652347196*^9, 3.647729726718266*^9}, {3.647729766591831*^9, 
  3.647729815827673*^9}, {3.647729871309924*^9, 3.647729873972207*^9}, {
  3.647730315917719*^9, 3.647730375576604*^9}, {3.6477305644314137`*^9, 
  3.6477305812470303`*^9}}],

Cell[BoxData[
 RowBox[{"volumeDPC", "=", 
  RowBox[{"ImageMultiply", "[", 
   RowBox[{"volumeDPC", ",", "volumeABSbinary"}], "]"}]}]], "Input",
 CellChangeTimes->{
  3.643349312104642*^9, {3.643349646781517*^9, 3.643349703349592*^9}, {
   3.6433499189694977`*^9, 3.643349921264515*^9}, {3.643351379918647*^9, 
   3.6433513815077257`*^9}, {3.643351730959797*^9, 3.643351747978578*^9}, {
   3.643601752752433*^9, 3.6436017559466963`*^9}, {3.643653124395627*^9, 
   3.643653131362611*^9}, 3.643879459824008*^9, {3.64773043608869*^9, 
   3.647730437290773*^9}, {3.647730595090939*^9, 3.647730601749625*^9}}],

Cell[BoxData[
 RowBox[{"ImageHistogram", "[", "volumeDPC", "]"}]], "Input",
 CellChangeTimes->{{3.643351888994522*^9, 3.643351945713472*^9}, {
   3.6433536970963173`*^9, 3.643353705068232*^9}, 3.647730621668006*^9}],

Cell["\<\
Useful colorfunctions are:
\[OpenCurlyDoubleQuote]XRay\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]\
HighRange\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]LowRange\
\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]WhiteBlackOpacity\
\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]SunsetColorsOpacity\
\[CloseCurlyDoubleQuote],\[CloseCurlyDoubleQuote]RainbowOpacity\
\[CloseCurlyDoubleQuote]
(GrayLevel[#,.005]&)\
\>", "Text",
 CellChangeTimes->{{3.643883979630493*^9, 3.643884012876328*^9}, 
   3.643884051782721*^9, {3.6438840863525476`*^9, 3.643884086892614*^9}}],

Cell[BoxData[
 RowBox[{"gDPC", "=", 
  RowBox[{"Image3D", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ImageAdjust", "[", 
     RowBox[{
      RowBox[{"ImageMultiply", "[", 
       RowBox[{"volumeDPC", ",", 
        RowBox[{"Erosion", "[", 
         RowBox[{"volumeABSbinary", ",", "1"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0.0", ",", "1.0"}], "}"}]}], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
    RowBox[{"Boxed", "\[Rule]", "True"}], ",", 
    RowBox[{"BoxRatios", "\[Rule]", "Automatic"}], ",", 
    RowBox[{"BoxStyle", "\[Rule]", 
     RowBox[{"Directive", "[", "White", "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"Axes", "\[Rule]", "True"}], ",", 
    RowBox[{"AxesLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<rows\>\"", ",", "\"\<columns\>\"", ",", "\"\<slices\>\""}],
       "}"}]}], ",", 
    RowBox[{"AxesStyle", "\[Rule]", 
     RowBox[{"Directive", "[", 
      RowBox[{"White", ",", "14"}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"ColorFunction", "\[Rule]", "\"\<SunsetColorsOpacity\>\""}], ",", 
    
    RowBox[{"Background", "\[Rule]", "Black"}], ",", "\[IndentingNewLine]", 
    RowBox[{"ViewVertical", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], ",", 
    RowBox[{"ViewPoint", "->", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "5.3"}], ",", " ", 
       RowBox[{"-", "1.0"}], ",", " ", "1.0"}], "}"}]}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "imageSize"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.643350179138762*^9, 3.643350204174089*^9}, {
   3.643350248441349*^9, 3.643350254001834*^9}, {3.643350309748658*^9, 
   3.643350390650262*^9}, {3.643350657598605*^9, 3.643350719722217*^9}, {
   3.6433508207652483`*^9, 3.643350844992228*^9}, 3.643350880901085*^9, {
   3.643350950556074*^9, 3.643351003628396*^9}, {3.643351037206768*^9, 
   3.643351124109816*^9}, {3.643351191755349*^9, 3.6433511955240097`*^9}, 
   3.643351397806732*^9, {3.643351756864723*^9, 3.6433517616628838`*^9}, 
   3.6433519992184057`*^9, {3.643353684249454*^9, 3.643353694462316*^9}, 
   3.643356185786545*^9, {3.643399555849834*^9, 3.643399556000012*^9}, {
   3.643477839215097*^9, 3.6434778638564663`*^9}, 3.643593916497596*^9, {
   3.64360097550947*^9, 3.643600989556669*^9}, {3.643601776654779*^9, 
   3.6436018432365417`*^9}, {3.6436018782782383`*^9, 
   3.6436019330624437`*^9}, {3.643879667903899*^9, 3.643879668649291*^9}, 
   3.643880693670807*^9, {3.643883708340461*^9, 3.643883720491558*^9}, {
   3.64388385986018*^9, 3.643883869665304*^9}, {3.6438839330717278`*^9, 
   3.643883964553158*^9}, {3.64388401781919*^9, 3.6438840465579443`*^9}, {
   3.643884094177165*^9, 3.643884116543103*^9}, {3.643884417905178*^9, 
   3.643884454967023*^9}, {3.643884485465416*^9, 3.6438844876380587`*^9}, {
   3.644481540706791*^9, 3.6444815624377823`*^9}, {3.6444818926210823`*^9, 
   3.644481904990597*^9}, {3.647730629419894*^9, 3.6477306436815567`*^9}}],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathFigures", "<>", "\"\<volume_DPC.png\>\""}], ",", "gDPC", ",", 
   "\"\<PNG\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.643356009797423*^9, 3.643356044442189*^9}, {
   3.647730636235167*^9, 3.6477306370745993`*^9}, 3.6477306685365562`*^9}],

Cell[BoxData[{
 RowBox[{"ImageQ", "[", "volumeDPC", "]"}], "\[IndentingNewLine]", 
 RowBox[{"NumberQ", "[", "volumeDPC", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dataVolumeDPC", " ", "=", " ", 
   RowBox[{"ImageData", "[", 
    RowBox[{"volumeDPC", ",", "\"\<Real\>\""}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ImageQ", "[", "dataVolumeDPC", "]"}], "\[IndentingNewLine]", 
 RowBox[{"NumberQ", "[", 
  RowBox[{"dataVolumeDPC", "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"pathFigures", "<>", "\"\<volume_DPC.h5\>\""}], ",", 
   "dataVolumeDPC", ",", 
   RowBox[{"{", 
    RowBox[{"\"\<Datasets\>\"", ",", "\"\<DPC\>\""}], "}"}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.643475461499693*^9, 3.6434754963177423`*^9}, {
  3.6477306742096357`*^9, 3.6477307088589067`*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "volumeDPC", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "dataVolumeDPC", "]"}]}], "Input",
 CellChangeTimes->{{3.643594994640993*^9, 3.643595004493183*^9}, {
   3.643884581256226*^9, 3.643884604591834*^9}, {3.643884648677023*^9, 
   3.643884673315832*^9}, 3.643894053650547*^9, {3.647730722571507*^9, 
   3.6477307276342697`*^9}}]
}, Closed]]
}, Closed]]
},
WindowSize->{1184, 812},
WindowMargins->{{-1632, Automatic}, {Automatic, 43}},
Magnification:>1.25 Inherited,
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 25, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
<<<<<<< HEAD
Cell[CellGroupData[{
Cell[422, 15, 1937, 26, 80, "Section"],
Cell[2362, 43, 211, 5, 61, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2610, 53, 1001, 13, 80, "Section"],
Cell[3614, 68, 408, 7, 57, "Input"],
Cell[CellGroupData[{
Cell[4047, 79, 288, 6, 54, "Subsection"],
Cell[4338, 87, 943, 17, 156, "Text"],
Cell[5284, 106, 3386, 83, 351, "Input"],
Cell[8673, 191, 3326, 76, 309, "Input"],
Cell[12002, 269, 2238, 52, 246, "Input"],
Cell[14243, 323, 2228, 55, 204, "Input"],
Cell[16474, 380, 4788, 114, 414, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[21299, 499, 266, 3, 43, "Subsection"],
Cell[21568, 504, 2975, 70, 315, "Input"],
Cell[24546, 576, 2835, 71, 395, "Input"],
Cell[27384, 649, 2043, 48, 275, "Input"],
Cell[29430, 699, 1873, 44, 437, "Input"],
Cell[31306, 745, 2708, 64, 353, "Input"],
Cell[34017, 811, 2833, 68, 597, "Input"],
Cell[36853, 881, 4113, 100, 883, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[41003, 986, 354, 6, 43, "Subsection"],
Cell[41360, 994, 2584, 62, 395, "Input"],
Cell[43947, 1058, 2695, 57, 437, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[46679, 1120, 374, 5, 43, "Subsection"],
Cell[47056, 1127, 11956, 270, 1043, "Input"],
Cell[59015, 1399, 12423, 297, 981, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[71475, 1701, 405, 5, 43, "Subsection"],
Cell[71883, 1708, 2298, 55, 397, "Input"],
Cell[74184, 1765, 3574, 88, 602, "Input"],
Cell[77761, 1855, 2826, 72, 562, "Input"],
Cell[80590, 1929, 1065, 28, 275, "Input"],
Cell[81658, 1959, 2441, 57, 438, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[84136, 2021, 248, 3, 43, "Subsection"],
Cell[84387, 2026, 1805, 31, 437, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[86241, 2063, 1088, 16, 80, "Section"],
Cell[87332, 2081, 450, 8, 57, "Input"],
Cell[87785, 2091, 2029, 40, 162, "Input"],
Cell[89817, 2133, 3061, 71, 162, "Input"],
Cell[92881, 2206, 3615, 78, 351, "Input"],
Cell[96499, 2286, 399, 9, 57, "Input"],
Cell[CellGroupData[{
Cell[96923, 2299, 299, 4, 54, "Subsection"],
Cell[97225, 2305, 1099, 20, 141, "Input"],
Cell[98327, 2327, 142, 2, 35, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[98518, 2335, 1253, 18, 62, "Section"],
Cell[99774, 2355, 484, 10, 78, "Input"],
Cell[CellGroupData[{
Cell[100283, 2369, 187, 2, 54, "Subsection"],
Cell[100473, 2373, 1040, 19, 78, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[101550, 2397, 197, 3, 43, "Subsection"],
Cell[101750, 2402, 533, 13, 99, "Input"],
Cell[102286, 2417, 1823, 28, 78, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[104146, 2450, 221, 4, 43, "Subsection"],
Cell[104370, 2456, 2149, 53, 246, "Input"],
Cell[106522, 2511, 1783, 47, 246, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[108342, 2563, 341, 6, 43, "Subsection"],
Cell[108686, 2571, 2066, 61, 246, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[110789, 2637, 216, 4, 43, "Subsection"],
Cell[111008, 2643, 1496, 39, 141, "Input"],
Cell[112507, 2684, 146, 2, 36, "Input"],
Cell[112656, 2688, 497, 9, 57, "Input"],
Cell[113156, 2699, 316, 6, 36, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[113509, 2710, 401, 7, 54, "Subsection"],
Cell[113913, 2719, 598, 15, 83, "Input"],
Cell[114514, 2736, 1000, 24, 99, "Input"],
Cell[115517, 2762, 535, 13, 87, "Input"],
Cell[116055, 2777, 684, 21, 57, "Input"],
Cell[116742, 2800, 727, 20, 150, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[117506, 2825, 332, 6, 54, "Subsection"],
Cell[117841, 2833, 1021, 25, 78, "Input"],
Cell[118865, 2860, 339, 7, 36, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[119241, 2872, 304, 4, 54, "Subsection"],
Cell[119548, 2878, 1992, 50, 315, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[121577, 2933, 299, 4, 43, "Subsection"],
Cell[121879, 2939, 914, 18, 141, "Input"]
=======
Cell[400, 13, 1996, 29, 169, "Section"],
Cell[CellGroupData[{
Cell[2421, 46, 1001, 13, 62, "Section"],
Cell[3425, 61, 408, 7, 88, "Input"],
Cell[CellGroupData[{
Cell[3858, 72, 288, 6, 83, "Subsection"],
Cell[4149, 80, 943, 17, 243, "Text"],
Cell[5095, 99, 3386, 83, 547, "Input"],
Cell[8484, 184, 3326, 76, 482, "Input"],
Cell[11813, 262, 2238, 52, 383, "Input"],
Cell[14054, 316, 2228, 55, 318, "Input"],
Cell[16285, 373, 4788, 114, 613, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[21110, 492, 266, 3, 83, "Subsection"],
Cell[21379, 497, 2975, 70, 252, "Input"],
Cell[24357, 569, 2835, 71, 316, "Input"],
Cell[27195, 642, 2043, 48, 220, "Input"],
Cell[29241, 692, 1873, 44, 350, "Input"],
Cell[31117, 738, 2708, 64, 283, "Input"],
Cell[33828, 804, 2833, 68, 478, "Input"],
Cell[36664, 874, 4113, 100, 707, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[40814, 979, 354, 6, 66, "Subsection"],
Cell[41171, 987, 2584, 62, 316, "Input"],
Cell[43758, 1051, 2695, 57, 350, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[46490, 1113, 374, 5, 66, "Subsection"],
Cell[46867, 1120, 9949, 225, 1260, "Input"],
Cell[56819, 1347, 12423, 297, 1456, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[69279, 1649, 405, 5, 66, "Subsection"],
Cell[69687, 1656, 2298, 55, 318, "Input"],
Cell[71988, 1713, 3574, 88, 482, "Input"],
Cell[75565, 1803, 2826, 72, 450, "Input"],
Cell[78394, 1877, 1065, 28, 220, "Input"],
Cell[79462, 1907, 2441, 57, 351, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[81940, 1969, 248, 3, 66, "Subsection"],
Cell[82191, 1974, 1805, 31, 350, "Input"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[84045, 2011, 1088, 16, 107, "Section"],
Cell[85136, 2029, 450, 8, 71, "Input"],
Cell[85589, 2039, 2029, 40, 202, "Input"],
Cell[87621, 2081, 3015, 71, 202, "Input"],
Cell[90639, 2154, 3615, 78, 438, "Input"],
Cell[94257, 2234, 399, 9, 71, "Input"],
Cell[CellGroupData[{
Cell[94681, 2247, 299, 4, 67, "Subsection"],
Cell[94983, 2253, 1099, 20, 176, "Input"],
Cell[96085, 2275, 142, 2, 43, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[96276, 2283, 1253, 18, 62, "Section"],
Cell[97532, 2303, 484, 10, 97, "Input"],
Cell[CellGroupData[{
Cell[98041, 2317, 187, 2, 67, "Subsection"],
Cell[98231, 2321, 1040, 19, 97, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[99308, 2345, 197, 3, 67, "Subsection"],
Cell[99508, 2350, 533, 13, 123, "Input"],
Cell[100044, 2365, 1823, 28, 97, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[101904, 2398, 221, 4, 67, "Subsection"],
Cell[102128, 2404, 2149, 53, 307, "Input"],
Cell[104280, 2459, 1783, 47, 307, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[106100, 2511, 341, 6, 83, "Subsection"],
Cell[106444, 2519, 2066, 61, 383, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[108547, 2585, 216, 4, 67, "Subsection"],
Cell[108766, 2591, 1496, 39, 176, "Input"],
Cell[110265, 2632, 146, 2, 45, "Input"],
Cell[110414, 2636, 497, 9, 71, "Input"],
Cell[110914, 2647, 316, 6, 45, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[111267, 2658, 318, 5, 67, "Subsection"],
Cell[111588, 2665, 598, 15, 103, "Input"],
Cell[112189, 2682, 1000, 24, 123, "Input"],
Cell[113192, 2708, 535, 13, 108, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[113764, 2726, 263, 5, 67, "Subsection"],
Cell[114030, 2733, 1001, 25, 97, "Input"],
Cell[115034, 2760, 339, 7, 45, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[115410, 2772, 304, 4, 67, "Subsection"],
Cell[115717, 2778, 1992, 50, 252, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[117746, 2833, 299, 4, 53, "Subsection"],
Cell[118048, 2839, 914, 18, 176, "Input"]
>>>>>>> origin/master
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
<<<<<<< HEAD
Cell[122842, 2963, 1329, 17, 80, "Section"],
Cell[124174, 2982, 644, 14, 99, "Input"],
Cell[CellGroupData[{
Cell[124843, 3000, 187, 2, 54, "Subsection"],
Cell[125033, 3004, 1040, 19, 78, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[126110, 3028, 347, 6, 85, "Subsection"],
Cell[126460, 3036, 576, 15, 99, "Input"],
Cell[127039, 3053, 42, 0, 36, "Input"],
Cell[127084, 3055, 12056, 243, 1278, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[139177, 3303, 321, 4, 54, "Subsection"],
Cell[139501, 3309, 437, 9, 57, "Input"]
=======
Cell[119011, 2863, 1329, 17, 62, "Section"],
Cell[120343, 2882, 644, 14, 123, "Input"],
Cell[CellGroupData[{
Cell[121012, 2900, 187, 2, 67, "Subsection"],
Cell[121202, 2904, 1040, 19, 97, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[122279, 2928, 347, 6, 106, "Subsection"],
Cell[122629, 2936, 550, 13, 123, "Input"],
Cell[123182, 2951, 42, 0, 45, "Input"],
Cell[123227, 2953, 12056, 243, 1545, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[135320, 3201, 321, 4, 67, "Subsection"],
Cell[135644, 3207, 437, 9, 71, "Input"]
>>>>>>> origin/master
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[139987, 3324, 1515, 20, 80, "Section"],
Cell[141505, 3346, 1073, 25, 141, "Input"],
Cell[CellGroupData[{
Cell[142603, 3375, 783, 11, 54, "Subsection"],
Cell[143389, 3388, 2161, 48, 120, "Input"],
Cell[145553, 3438, 1063, 26, 162, "Input"],
Cell[146619, 3466, 2192, 52, 183, "Input"],
Cell[148814, 3520, 4315, 98, 515, "Input"]
}, Open  ]],
Cell[CellGroupData[{
<<<<<<< HEAD
Cell[153166, 3623, 710, 9, 83, "Subsection"],
Cell[153879, 3634, 1792, 45, 233, "Input"],
Cell[155674, 3681, 2443, 57, 395, "Input"]
=======
Cell[150987, 3557, 710, 9, 54, "Subsection"],
Cell[151700, 3568, 1792, 45, 187, "Input"],
Cell[153495, 3615, 2443, 57, 316, "Input"]
>>>>>>> origin/master
}, Closed]],
Cell[CellGroupData[{
Cell[158154, 3743, 761, 10, 66, "Subsection"],
Cell[158918, 3755, 196, 5, 56, "Input"],
Cell[159117, 3762, 1129, 25, 220, "Input"],
Cell[160249, 3789, 2835, 64, 351, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[163121, 3858, 349, 5, 83, "Subsection"],
Cell[163473, 3865, 650, 13, 121, "Input"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
<<<<<<< HEAD
Cell[164172, 3884, 1534, 22, 195, "Section"],
Cell[165709, 3908, 730, 18, 220, "Input"],
Cell[CellGroupData[{
Cell[166464, 3930, 1032, 16, 83, "Subsection"],
Cell[167499, 3948, 530, 13, 121, "Input"],
Cell[168032, 3963, 972, 26, 153, "Input"],
Cell[169007, 3991, 943, 19, 121, "Input"],
Cell[169953, 4012, 3318, 80, 613, "Input"],
Cell[173274, 4094, 983, 23, 233, "Input"],
Cell[174260, 4119, 6169, 148, 683, "Input"]
}, Open  ]],
Cell[180444, 4270, 1732, 23, 103, "Subsection"],
Cell[CellGroupData[{
Cell[182201, 4297, 1787, 25, 143, "Subsection"],
Cell[183991, 4324, 110, 1, 70, "Input"],
Cell[184104, 4327, 233, 4, 70, "Input"],
Cell[184340, 4333, 7737, 175, 1546, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[192114, 4513, 1939, 27, 143, "Subsection"],
Cell[194056, 4542, 4806, 118, 1135, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[198899, 4665, 1931, 27, 143, "Subsection"],
Cell[200833, 4694, 4873, 118, 1135, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[205743, 4817, 2038, 29, 143, "Subsection"],
Cell[207784, 4848, 4992, 119, 1135, "Input"]
=======
Cell[161993, 3818, 1549, 20, 62, "Section"],
Cell[163545, 3840, 730, 18, 141, "Input"],
Cell[CellGroupData[{
Cell[164300, 3862, 1032, 16, 54, "Subsection"],
Cell[165335, 3880, 530, 13, 78, "Input"],
Cell[165868, 3895, 972, 26, 99, "Input"],
Cell[166843, 3923, 943, 19, 78, "Input"],
Cell[167789, 3944, 3318, 80, 393, "Input"],
Cell[171110, 4026, 983, 23, 120, "Input"],
Cell[172096, 4051, 6169, 148, 351, "Input"]
}, Open  ]],
Cell[178280, 4202, 1732, 23, 54, "Subsection"],
Cell[CellGroupData[{
Cell[180037, 4229, 1787, 25, 74, "Subsection"],
Cell[181827, 4256, 110, 1, 56, "Input"],
Cell[181940, 4259, 233, 4, 56, "Input"],
Cell[182176, 4265, 7737, 175, 1237, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[189950, 4445, 1939, 27, 74, "Subsection"],
Cell[191892, 4474, 4806, 118, 908, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[196735, 4597, 1931, 27, 74, "Subsection"],
Cell[198669, 4626, 4873, 118, 908, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[203579, 4749, 2038, 29, 74, "Subsection"],
Cell[205620, 4780, 4992, 119, 908, "Input"]
>>>>>>> origin/master
}, Closed]]
}, Closed]],
Cell[210639, 4903, 1466, 20, 62, "Section"],
Cell[CellGroupData[{
<<<<<<< HEAD
Cell[212825, 4973, 1436, 19, 156, "Section"],
Cell[214264, 4994, 143, 3, 363, "Input"],
Cell[CellGroupData[{
Cell[214432, 5001, 97, 1, 557, "Subsection"],
Cell[214532, 5004, 983, 23, 1338, "Input"],
Cell[215518, 5029, 1207, 20, 613, "Input"],
Cell[216728, 5051, 916, 25, 853, "Input"],
Cell[217647, 5078, 541, 9, 363, "Input"],
Cell[218191, 5089, 2122, 44, 1331, "Input"],
Cell[220316, 5135, 1279, 28, 1331, "Input"],
Cell[221598, 5165, 247, 5, 382, "Input"],
Cell[221848, 5172, 1093, 24, 1581, "Input"],
Cell[222944, 5198, 461, 12, 625, "Input"],
Cell[223408, 5212, 500, 7, 1088, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[223945, 5224, 145, 2, 1187, "Subsection"],
Cell[224093, 5228, 693, 17, 2666, "Input"],
Cell[224789, 5247, 41, 0, 790, "Input"],
Cell[224833, 5249, 1061, 24, 2666, "Input"],
Cell[225897, 5275, 41, 0, 790, "Input"],
Cell[225941, 5277, 569, 10, 790, "Input"],
Cell[226513, 5289, 198, 3, 790, "Input"],
Cell[226714, 5294, 585, 11, 1932, "Text"],
Cell[227302, 5307, 3190, 63, 3118, "Input"],
Cell[230495, 5372, 1604, 37, 3118, "Input"],
Cell[232102, 5411, 244, 5, 812, "Input"],
Cell[232349, 5418, 910, 21, 3118, "Input"],
Cell[233262, 5441, 339, 5, 1265, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[233638, 5451, 357, 6, 1187, "Subsection"],
Cell[233998, 5459, 329, 7, 226918, "Text"],
Cell[234330, 5468, 918, 21, 366072, "Input"],
Cell[235251, 5491, 2254, 57, 684175, "Input"],
Cell[237508, 5550, 1775, 37, 366072, "Input"],
Cell[239286, 5589, 260, 6, 134252, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[239583, 5600, 187, 3, 937, "Subsection"],
Cell[239773, 5605, 693, 17, 448606, "Input"],
Cell[240469, 5624, 1076, 25, 448606, "Input"],
Cell[241548, 5651, 603, 10, 134252, "Input"],
Cell[242154, 5663, 215, 3, 134252, "Input"],
Cell[242372, 5668, 585, 11, 316700, "Text"],
Cell[242960, 5681, 3079, 59, 528441, "Input"],
Cell[246042, 5742, 307, 6, 134252, "Input"],
Cell[246352, 5750, 909, 22, 528441, "Input"],
Cell[247264, 5774, 379, 6, 211133, "Input"]
=======
Cell[212130, 4927, 1510, 20, 62, "Section"],
Cell[213643, 4949, 143, 3, 291, "Input"],
Cell[CellGroupData[{
Cell[213811, 4956, 97, 1, 446, "Subsection"],
Cell[213911, 4959, 983, 23, 1071, "Input"],
Cell[214897, 4984, 1207, 20, 491, "Input"],
Cell[216107, 5006, 916, 25, 683, "Input"],
Cell[217026, 5033, 541, 9, 291, "Input"],
Cell[217570, 5044, 2122, 44, 1065, "Input"],
Cell[219695, 5090, 1279, 28, 1065, "Input"],
Cell[220977, 5120, 247, 5, 306, "Input"],
Cell[221227, 5127, 1093, 24, 1265, "Input"],
Cell[222323, 5153, 461, 12, 500, "Input"],
Cell[222787, 5167, 500, 7, 871, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[223324, 5179, 145, 2, 950, "Subsection"],
Cell[223472, 5183, 693, 17, 2133, "Input"],
Cell[224168, 5202, 41, 0, 632, "Input"],
Cell[224212, 5204, 1061, 24, 2133, "Input"],
Cell[225276, 5230, 41, 0, 632, "Input"],
Cell[225320, 5232, 569, 10, 632, "Input"],
Cell[225892, 5244, 198, 3, 632, "Input"],
Cell[226093, 5249, 585, 11, 1546, "Text"],
Cell[226681, 5262, 3190, 63, 2495, "Input"],
Cell[229874, 5327, 1604, 37, 2495, "Input"],
Cell[231481, 5366, 244, 5, 650, "Input"],
Cell[231728, 5373, 910, 21, 2495, "Input"],
Cell[232641, 5396, 339, 5, 1012, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[233017, 5406, 357, 6, 950, "Subsection"],
Cell[233377, 5414, 329, 7, 181535, "Text"],
Cell[233709, 5423, 918, 21, 292858, "Input"],
Cell[234630, 5446, 2254, 57, 547340, "Input"],
Cell[236887, 5505, 1775, 37, 292858, "Input"],
Cell[238665, 5544, 260, 6, 107402, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[238962, 5555, 187, 3, 750, "Subsection"],
Cell[239152, 5560, 693, 17, 358885, "Input"],
Cell[239848, 5579, 1076, 25, 358885, "Input"],
Cell[240927, 5606, 603, 10, 107402, "Input"],
Cell[241533, 5618, 215, 3, 107402, "Input"],
Cell[241751, 5623, 585, 11, 253360, "Text"],
Cell[242339, 5636, 3079, 59, 422753, "Input"],
Cell[245421, 5697, 307, 6, 107402, "Input"],
Cell[245731, 5705, 909, 22, 422753, "Input"],
Cell[246643, 5729, 379, 6, 168907, "Input"]
>>>>>>> origin/master
}, Closed]]
}, Closed]]
}
]
*)

